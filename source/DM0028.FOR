         SUBROUTINE DM0028 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                         MSWALL, RMSWAL, ADRMSW )
CXXX----KOMèãEKC "MS1" --> BEPCàü 1.1  (OT ÑEKAÅPü 1987 É.)------------
C   èOÑèPOÉPAMMA:  DM0028 ( MSW, RMSW, YALL, JALL, LOGYTR,
C   ------------             TOKN, TOKN1, VALLN, VALLN1, KOD,
C    *                         MSWALL, RMSWAL, ADRMSW )
C
C   HAáHAóEHàE:    B áABàCàMOCTà OT áHAóEHàü îãAÉA ZAPROS [MASPRT(28)]:
C   -----------    BõèOãHüET CãEÑìûôàE îìHKñàà:
C
C                  A) ZAPROS = 1
C                     ----------
C                  îOPMàPOBAHàE BKãAÑOB B YALL MATPàñì èPOBOÑàMOCTEâ à
C                  JALL - BEKTOP àCTOóHàKOB TOKA áHAóEHàâ èAPAMETPOB
C                  ùKBàBAãEHTHõX  G - J BETBEâ  MOÑEãà ùãEMEHTOB ñEèà:
C                +-----+--------------------------------------------+
C                I Tàè I              àMü MOÑEãà                    I
C                I-----I--------------------------------------------I
C                I 15  I   ìèPABãüEMõâ HAèPüÜEHàEM àCTOóHàK TOKA    I
C                I-----I--------------------------------------------I
C                I 16  I   ìèPABãüEMõâ HAèPüÜEHàEM àCTOóHàK HAèPü-  I
C                I     I   ÜEHàü                                    I
C                I-----I--------------------------------------------I
C                I 200 I   àÑEAãúHõâ OèEPAñàOHHõâ ìCàãàTEãú         I
C                I-----I--------------------------------------------I
C                  ***************************************************
C                  B) ZAPROS = 2
C                     ----------
C                  BõóàCãEHàE áHAóEHàâ TOKOB B BETBüX B T(N+1) MOMEHT
C                  BPEMEHà   àCXOÑü àá G à J èAPAMETPOB à áHAóEHàü
C                  ìáãOBõX HAèPüÜEHàâ HA ùãEMEHTE PACóàTAHHõX Ñãü T(N+1)
C                    à áAèàCú (îàKCAñàü) ùTàX áHAóEHàâ B "TOK T(N+1)";
C
C                  C) ZAPROS = 3
C                     **********
C                     HE èOÑÑEPÜàBAETCü ( PEáEPB );
C
C                  D) ZAPROS = 4
C                     **********
C                     HE èOÑÑEPÜàBAETCü;
C
C   METOÑ:         ÑàCKPETàáAñàü ìPABHEHàâ COCTOüHàü MOÑEãà ÑAHHOÉO
C   -----          TàèA HA OCHOBE METOÑA ãàHàÑÜEPA BàOãìÉÅà:
C                  Y(N+1) = Y(N) + H1*F(N+1) + H2*F(N).
C
C   èAPAMETPõ:     MSW, RMSW - ìèPABãüûôEE CãOBO COCTOüHàü MAKPOMOÑEãà
C   ---------      ( "OTPEáOK" MACCàBõ MSWALL -> C.M. è/è GETMSW );
C                  YALL - MATPàñA èP0BOÑàMOCTà AHAãàáàPìEMOâ ñEèà;
C                  JALL - BEKTOP àCTOóHàKOB TOKA AHAãàáàPìEMOâ ñEèà;
C                  VALLN - BEKTOP ìáãOBõX HAèPüÜEHàâ AHAãàáàPìEMOâ ñEèà:
C                          èPà  T  =  TN;
C                  VALLN1- BEKTOP ìáãOBõX HAèPüÜEHàâ AHAãàáàPìEMOâ ñEèà:
C                           èPà  T  =  TN  + H0;
C                  TOKN  à  TOKN1 - BEKTOPA èEPEMEHHõX "COCTOüHàü"
C                                   ùãEMEHTA èPà  TN  à  TN + H0;
C                                   PAáMEPHOCTà CM. MASPRT(46)=NNTOK;
C                  LOGYTR - BEKTOP èPàáHAKOB K.á. ìáãOB:
C                  àCèOãúáìETCü B MAKPOMOÑEãüX C èPàáHAKOM TàèA = 5;
C                  PAáMEPHOCà MACCàBOB ÉPìèèõ "ALL" OèPEÑEãüûTCü:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKìôAü_PAáMEPHOCTú ---> NSYS = MASPRT(26)
C                  KOD - èAPAMETP OÅPATHOâ CBüáà C MOHàTOPOM DM....
C                   ( àCèOãúáìETCü Ñãü MAKPOMOÑEãEâ "àÑEAãúHõX" KãûóEâ)
C
C
C
C   èOÑèPOÉPAMMõ:  1. COMMON PROF1, PROF2, PROF3;
C   ------------             DEPOST;
C
C   èPàMEóAHàE:  1.CTPìKTìPì MSW CãOBA MAKPOMOÑEãà ÑAHHOÉO TàèA CM. HàÜE
C   ----------   2. èPà ZAPROS ^=   1  àãà 2 - COOÅôEHàE à ìXOÑ;
C
C
C               "èOCTOüHHAü" óACTú MSW TàèA # 15,16,200
C                --------------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I  èPàá. I KOãà I KOã. IAÑP.   IPE I
C  I ùãEME I TàèA   I è/è    I  TàèA  I óECT I BõB. IáHAó.  IáE I
C  I HTA   I MOÑEãà I PACóETAI  MOÑEãàI BO   I áHAó I"TOKN" IPB I
C  I       I        I DM.....I        I ìáãOBI EHàâ.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I   7   I 8 I
C  +-------+--------+--------+--------+------+------+-----------+
C
C
C
C                  RMSW Tàè # 15 [ àTìH ]
C                  ----------------------
C
C             ++--------+---------+---------++
C             II        I         I         II
C             II   ì1   I   ì2    I    G    II
C             II        I         I         II
C             ++--------+---------+---------++       LM = 3
C             II   1    I    2    I     3   II       ******
C             ++--------+---------+---------++
C             II  11    I   12    I    13   II
C             ++--------+---------+---------++
C
C
C                  RMSW Tàè # 16 [ àHìH ]
C                  ----------------------
C
C      ++--------+---------+---------+---------+----------+
C      II        I         I         I         I          I
C      II   ì1   I   ì2    I   GBH   I    K    I G=GBH*K  I
C      II        I         I         I         I          I
C      ++--------+---------+---------+---------+----------+    LM = 5
C      II   1    I    2    I     3   I    4    I    5     I    ******
C      ++--------+---------+---------+---------+----------+
C      II  11    I   12    I    13   I   14    I   15     I
C      ++--------+---------+---------+---------+----------+
C
C
C                  RMSW Tàè # 200 [ àÑEAãúHõâ OèEPAñàOHHõâ ìCàãàTEãú ]
C                  ----------------------
C
C             ++--------+---------+---------++
C             II        I         I         II
C             II   K    I   GBX   I  GBõX   II
C             II        I         I         II
C             ++--------+---------+---------++       LM = 3
C             II   1    I    2    I     3   II       ******
C             ++--------+---------+---------++
C             II  13    I   14    I    15   II
C             ++--------+---------+---------++
C
C
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         REAL JALL
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( NDALL,  MASPRT(23) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( FKOM,   MASPRT(34) )
         EQUIVALENCE ( TXG,    MASPRT(35) )
         EQUIVALENCE ( NTXG,   MASPRT(36) )
         EQUIVALENCE ( EPSKOM, MASPRT(39) )
         DIMENSION MSWALL(*), RMSWAL(*)
         INTEGER ADRMSW
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         INTEGER FKOM, ZAPROS, TIP
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
C===>    BCTPOEHHAü îìHKñàü OÅCãìÜàBAHàü ÑBìXMEPHõX MACCàBOB:
         ID(I,J) = NDALL * (J-1)  +  I
C--->  KOHTPOãú TàèA
         TIP = MSW(2)
         IF ( TIP .NE. 15 .AND. TIP .NE. 16 .AND. TIP.NE.200)GO TO 9999
C---> BõÅOP PEÜàMA:
         GO TO ( 667, 666                 ), ZAPROS
C===> àHAóE OòàÅKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHàTOP #', I4, ' áAèPOC OÅCãìÜàBAHàü OòàÅOóEH
     = ***'/ ' *** ZAPROS = ', I5, ' - àÉHOPàPìETCü ***')
         RETURN
667      CONTINUE
C---------ZAPROS = 1---------------------------------------------------
C---> óTO áA Tàè?
         IF ( TIP .EQ. 16 ) GO TO 20
         IF ( TIP .EQ. 200) GO TO 30
C######################################################################
C---> ìèPABãüEMõâ HAèPüÜEHàEM àCTOóHàK TOKA
C--->   èOùãEMEHTHõâ BKãAÑ:
C==> CBOà  ìáãõ.
         K = MSW(9)
         L = MSW(10)
C==> ìáãõ ìèPABãüûôEÉO HAèPüÜEHàü
         M = MSW(11)
         N = MSW(12)
C===> KOùîîàñàEHT CBüáà
         G = RMSW(13)
C======================================================================
         KOD = 0
C---->
         CALL DEPOSN( K, L, M, N, G, YALL )
C---->
         RETURN
C######################################################################
20      CONTINUE
C---> ìèPABãüEMõâ HAèPüÜEHàEM àCTOóHàK HAèPüÜEHàü
C--->   èOùãEMEHTHõâ BKãAÑ:
C==> CBOà  ìáãõ.
         K = MSW(9)
         L = MSW(10)
C==> ìáãõ ìèPABãüûôEÉO HAèPüÜEHàü
         M = MSW(11)
         N = MSW(12)
C===> BHìTPEHHEE COèPOTàBãEHàE à KOùîîàñàEHT CBüáà
         GBH = RMSW(13)
         G   = RMSW(15)
C======================================================================
C-->   BKãAÑõBAEM...
         KOD = 0
C---->
         CALL DEPOSN( K, L, M, N, G, YALL )
C---->
         CALL DEPOST( K, L, GBH, 0.0, YALL, JALL )
C
         RETURN
C######################################################################
30      CONTINUE
C---> àÑEAãúHõâ OèEPAñàOHHõâ ìCàãàTEãú
C--->   èOùãEMEHTHõâ BKãAÑ:
C==> BXOÑHõE  ìáãõ.
         M = MSW(9)
         N = MSW(10)
C==> BõXOÑHõE  ìáãõ.
         K = MSW(11)
         L = MSW(12)
C===> KOùîîàñàEHT ìCàãEHàü, BXOÑHAü à BõXOÑHAü èPOBOÑàMOCTú.
         AK  = RMSW(13)
         GBX = RMSW(14)
         GBIX= RMSW(15)
C======================================================================
         KOD = 0
C-->  BãOÜàM BXOÑHìû ñEèú
         CALL DEPOST( M, N, GBX, 0.0, YALL, JALL )
C---> BãOÜàM BõXOÑHìû ñEèú
         G = AK * GBIX
         CALL DEPOSN( K, L, M, N, G, YALL )
C---->
         CALL DEPOST( K, L, GBIX, 0.0, YALL, JALL )
         RETURN
C======================================================================
666      CONTINUE
C$$$$$$$$$$$$$$$$$$$ZAPROS = 2$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C---> óTO áA Tàè?
         IF ( TIP .EQ. 16 ) GO TO 40
         IF ( TIP .EQ. 200) GO TO 50
C######################################################################
C---> ìèPABãüEMõâ HAèPüÜEHàEM àCTOóHàK TOKA
C==> ìáãõ ìèPABãüûôEÉO HAèPüÜEHàü
         M = MSW(11)
         N = MSW(12)
C--->  HOBõâ TOK:
         VM = 0.0
         IF ( M .NE. 0 ) VM = VALLN1(M)
         VN = 0.0
         IF ( N .NE. 0 ) VN = VALLN1(N)
         UN1 = VM - VN
         TOKT = RMSW(13) * UN1
C--->     áAèàCú TOKOB
         ITOK = MSW(7)
         TOKN1( ITOK ) = TOKT
         KOD = 0
         RETURN
C######################################################################
40       CONTINUE
C---> ìèPABãüEMõâ HAèPüÜEHàEM àCTOóHàK HAèPüÜEHàü
C==> ìáãõ ìèPABãüûôEÉO HAèPüÜEHàü
         M = MSW(11)
         N = MSW(12)
C--->CBOà ìáãõ.
         K = MSW(9)
         L = MSW(10)
C--->  HOBOE ìèPABãüûôEE HAèPüÜEHàE
         VM = 0.0
         IF ( M .NE. 0 ) VM = VALLN1(M)
         VN = 0.0
         IF ( N .NE. 0 ) VN = VALLN1(N)
         UBX = VM - VN
C--->  HOBOE BõXOÑHOE HAèPüÜEHàE
         VK = 0.0
         IF ( K .NE. 0 ) VK = VALLN1(K)
         VL = 0.0
         IF ( L .NE. 0 ) VL = VALLN1(L)
         UBIX = VK - VL
C---> HOBõâ TOK
         TOKT = ( RMSW(14) * UBX + UBIX ) * RMSW(13)
C---> áAèàCú TOKA
         ITOK = MSW(7)
         TOKN1( ITOK ) = TOKT
         KOD = 0
         RETURN
C######################################################################
50       CONTINUE
C---> àÑEAãúHõâ OèEPAñàOHHõâ ìCàãàTEãú
C==> ìáãõ BXOÑHOÉO HAèPüÜEHàü
         M = MSW(9)
         N = MSW(10)
C--->ìáãõ BõXOÑHOÉO HAèPüÜEHàü
         K = MSW(11)
         L = MSW(12)
C--->  HOBOE BXOÑHOE HAèPüÜEHàE
         VM = 0.0
         IF ( M .NE. 0 ) VM = VALLN1(M)
         VN = 0.0
         IF ( N .NE. 0 ) VN = VALLN1(N)
         UBX = VM - VN
C--->  HOBOE BõXOÑHOE HAèPüÜEHàE
         VK = 0.0
         IF ( K .NE. 0 ) VK = VALLN1(K)
         VL = 0.0
         IF ( L .NE. 0 ) VL = VALLN1(L)
         UBIX = VK - VL
C---> HOBõâ TOK
         TOKBX = UBX * RMSW(14)
         TOKBIX= ( RMSW(13) * UBX + UBIX ) * RMSW(15)
C---> áAèàCú TOKA
         ITOK = MSW(7)
         TOKN1( ITOK ) = TOKBX
         TOKN1( ITOK + 1 ) = TOKBIX
         KOD = 0
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** ãOÉ. CÅOâ B DM0028 - áAèPOC HA OÅCãìÜàBAHàE óìÜOÉ
     =O TàèA ***'/
     =    ' *** ùãEMEHT # ', I10, ' Tàè MOÑEãà # ', I10, ' ***'//)
         CALL SUBERR(0)
         END
