       SUBROUTINE APFRUN ( POST , RPOST , KPOST , INDEX ,
     *                   DATAR , KINDEX , RESULT , KODFUN , KF , KKK )
CXXX**-1KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)*************
C*                                                                     *
C*  OPOPAMMA :  APFRUN ( POST , RPOST , KPOST , INDEX ,            *
C*  ------------          DATAR , KINDEX , RESULT , KODFUN , KF , KKK )*
C*                                                                     *
C*  HAHAEHE :    BCEHE APMETECKOO BPAEH B OCTKCHO *
C*  ----------      OPME. BPAEHE COCTOT  OCEOBATEHOCT     *
C*                  S(1),S(2),...,S(N),N>=1, E S(I) - O KOHCTOHTA,*
C*                  O EHTKATOP, O BXMECTHA APMETEC-  *
C*                  KA OEPA ( + , - , * , / , ** ), O HK. *
C*                                                                     *
C*  METO :         AOPTM PAOTAET TA OCTKCHOE BPAEHE      *
C*  -----           CEBA HAPABO. EC CTAHHOE BPAEHE S(I) -     *
C*                  EHTKATOP  CO, TO OMEAEM EO B CTEK.   *
C*                  HAE : OEHBAEM OBPAEHE  BOHEM OEPA-  *
C*                  , COOTBETCTBA EM. EC MEEM BXMECTHE   *
C*                  APMETECKE OEPA ( + , - , * , / , ** ), TO *
C*                  B OEPA ACTBT BA BEPXHX EMEHTA CTEKA.   *
C*                  T BA EMEHTA ATC  CTEKA, A PETAT   *
C*                  OMEAETC HA BEPX CTEKA. EC MEEM HK       *
C*                  (OHOMECTH), TO ECTBE POBOM HA OCE-  *
C*                  HM EMEHTOM CTEKA, TA E EM PETAT.      *
C*                  OCE OKOHAH BCEH PETAT ET HAXO-   *
C*                  TC B EPBOM (CAMOM HHEM) EMEHTE CTEKA.      *
C*                                                                     *
C*  APAMETP :     POST - MACCB OCTKCHO AC                   *
C*  ---------       RPOST - TO E TO  POST, HO REAL*4                *
C*                  KPOST - KOECTBO EMEHTOB B OCTKCHO AC  *
C*                  INDEX - MACCB MEH EHTKATOPOB                *
C*                  DATAR - MACCB CEHHX HAEH EHTKATOPOB  *
C*                  KINDEX - PAMEP MACCBOB INDEX  DATAR             *
C*                  RESULT - PETAT BCEH POST-AC          *
C*                  KODFUN - MACCB MEH HK                       *
C*                  KF - KOECTBO HK                            *
C*                  KKK - KO BOBEEH B CTEEH '**'                *
C*                                                                     *
C*  OPOPAMM :  APFSEE , APFFUN , ( SUBERR(1) , COMMON : PRINTN )  *
C*  ------------                                                       *
C*                                                                     *
C*  PMEAHE :  1) AOPTM PEOAAET, TO BXOHA OCEOBATE- *
C*  ----------       HOCT BETC PABHM POST-BPAEHEM.        *
C*                2) AOPTM HKOA HE HAPET CTEK HM    *
C*                    HE AOHET CTEK HM OCE TOO, KAK        *
C*                   HAEH  COOBAH. TO CTOO  EAT  *
C*                    CTETECKX COOPAEH, HO HE OATEHO.   *
C*                3) HAEHE HK BCTC P OPAEH K      *
C*                   OPOPAMME  APFFUN.                             *
C*                4) COBE HAEH EHTKATOPOB OPEETC    *
C*                   P OPAEH K OPOPAMME  APFSEE. P TOM    *
C*                   EHTKATOP OH T OTCOPTPOBAH O       *
C*                   BOPACTAH.                                      *
C*                                                                     *
CZZZ********************************************************************
C*
       COMMON / PRINTN / NW6
C!!--------------------------------------------------------------------
       DIMENSION STEK(51) , ZH(7) , ZN(7)
       DIMENSION POST(1) , DATAR(1) , INDEX(1) , RPOST(1) , KODFUN(1)
       INTEGER POST , ZH  , ZN
       DATA ZN / '*' , '/' , '+' , '-' , ' ',' ',' ' /
C!!!-------------------------------------------------------------------
C*  EPEKOPOBKA  ZH   OPMATM "A" B OPMAT "F"
       CALL APFTRT ( 1 , 4 , ZN , ZH )
       DO 100 I=1,4
 100   ZH(I) = -ZH(I)
C*  ZH(5) = KKK  -  KO "BOBEEH B CTEEH"
       ZH(5) = KKK
C*----------------------------------------------------------------------
C*  HAAHE COB
C*  I - HEKC POST-AC
       I = 1
C*  J - HEKC CTEKA
       J = 0
C*---------------------------------------------------------------------
C*  OPAOTKA  POST-AC
 11    CONTINUE
C*   HAC EHTKATOP ?
       IF ( POST(I) .GT. 0 ) GO TO 1
C*   HAC CO ?
       IF ( POST(I) .EQ. 0   ) GO TO 2
C*   HAC HAK OEPA ( + , - , * , / , ** ) ?
       IF ( POST(I) .LT.   0  .AND.  POST(I) .GT. -100 ) GO TO 3
C*   HAC HK ?
       IPS = POST(I)
       CALL APFAAA ( KODFUN , KF , IPS , NOMER )
       RSTEK = STEK(J)
C*  BBAEM APFFUN - OPOPAMM BCEH HAEH HK.
       CALL APFFUN ( RSTEK , RSTEK , NOMER )
       STEK(J) = RSTEK
       GO TO 10
C*---------------------------------------------------------------------
C*  MEEM EHTKATOP
 1     IPOST = POST(I)
C*  BOB OPOPAMM, OPEEE ECEHHOE HAEHE HTKATOPA.
       CALL APFSEE ( IPOST , RSTEK , INDEX , DATAR , KINDEX )
       J = J + 1
       STEK(J) = RSTEK
       GO TO 10
C*---------------------------------------------------------------------
C*  MEEM CO. CPA E EM EO B CTEK.
 2     J = J + 1
       I = I + 1
       STEK(J) = RPOST(I)
       GO TO 10
C*---------------------------------------------------------------------
C*  MEEM HAK OEPA ( * , / , + , - , ** ). KAKO ?
 3     CONTINUE
C*  MHOEHE ?
       IF ( POST(I) .EQ. ZH(1) ) GO TO 4
C*  EEHE ?
       IF ( POST(I) .EQ. ZH(2) ) GO TO 5
C*  COEHE ?
       IF ( POST(I) .EQ. ZH(3) ) GO TO 6
C*  BTAHE ?
       IF ( POST(I) .EQ. ZH(4) ) GO TO 7
C*.....................................................................
C*  BOBEEHE B CTEEH ?
       IF ( POST(I) .EQ. ZH(5) ) GO TO 888
C!!!-------------------------------------------------------------------
       WRITE(NW6,1000)
 1000  FORMAT(1X,'***** CO B PAOTE APFRUN,HEOOHAHH HAK.')
       CALL SUBERR(1)
C!!!-------------------------------------------------------------------
 888   J = J - 1
       STEK(J) = STEK(J) ** STEK(J+1)
       GO TO 10
C*.....................................................................
C*  MEEM MHOEHE.
 4     J = J - 1
       STEK(J) = STEK(J) * STEK(J+1)
       GO TO 10
C*.....................................................................
C*  MEEM EEHE.
 5     J = J - 1
       STEK(J) = STEK(J) / STEK(J+1)
       GO TO 10
C*.....................................................................
C*  MEEM COEHE.
 6     J = J - 1
       STEK(J) = STEK(J) + STEK(J+1)
       GO TO 10
C*.....................................................................
C*  MMEM BTAHE.
 7     J = J - 1
       STEK(J) = STEK(J) - STEK(J+1)
       GO TO 10
C*---------------------------------------------------------------------
 10    CONTINUE
       I = I + 1
C*  POST-AC CEPAHA ?
       IF ( I .LE. KPOST ) GO TO 11
C*  COXPAHEM PETAT  BOBPAAEMC.
       RESULT = STEK(1)
       RETURN
       END
