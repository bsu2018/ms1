       SUBROUTINE PSUB5( NEL, URMAS, STMAS, DGMAS, INTMAS )
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT APE  1988 .)------------
C   OPOPAMMA: PSUB5( NEL, URMAS, STMAS, DGMAS, INTMAS )
C   -------------
C   HAHAEHE:  / OOBATE  MOEPOBAH
C   ----------   AKOHOB PABEH TPEXAHM KOMEHCATOPOM
C                MOHOCT CKAEH  HECMMETP
C                  ( MOE #18 - J3 P.)
C   BAPAHT:    BOMOH BA BAPAHTA MOE:
C   ---------  1.PHAK MOE = 0, MOE HEHA,
C                O BEHAM, EPEABAEMM OOBATEEM 
C                HAEHM TOKOB  HAPEH EMEHTOB CXEM
C                O MOMEHTA BPEMEH TN BKTEHO B OPOPAMME
C                OPEETC HAEH G,J-APAMETPOB MOE  T=TN+1
C              2.PHAK MOE = 1, MOE TEPAOHHA,
C                O BEHAM, EPEABAEMM OOBATEEM 
C                HAEHM TOKOB  HAPEH EMEHTOB CXEM
C                O MOMEHTA BPEMEH TN+1 BKTEHO B OPOPAMME
C                OPEETC HAEH G,J-APAMETPOB B MOMEHT TN+1
C                TEPAOHHM COCOOM
C   METO:     OEBEH.
C   -----
C  APAMETP:   NEL - HOMEP EMEHTA,  KOTOPOO PSUB PAOTAET;
C  ---------    URMAS - MACCB AHHX OOBATE:
C                       1-E COBO - KOECTBO APAMETPOB B CCKE
C                       ( ACAHO EM COM B BEECTBEHH MACCB);
C                       2-E COBO - PHAK MOE ( CM.BAPAHT );
C                       3-E COBO - MOMEHT BKEH MOE  T0;
C                       4-E COBO - KO AKOHA PABEH ( K );
C                       5-E COBO - EPO BCEH HTEPAHX
C                                   BEH;
C                       6-E COBO - KOECTBO TOKOB CXEM;
C                       7-E COBO - KOECTBO HAPOK;
C                       8-E COBO - TOHOCT OPEEEH CTAHOBB-
C                                   EOC PEMA;
C                       9-E COBO - <0 - PACET BEETC O CTAHOB.
C                                   PEMA, B P.CAE - BBO HTEP.
C                                   BEH EPE KA EPO O
C                                   OKOHAH MOEPOBAH;
C----------------------------------------------------------------------
C              STMAS - MACCB AHHX, EPEABAEMX B PSUB:
C
C      COBO           OOHAEHE   -   HAEHE
C      1               TN - BPEM N - O AA PACETA;
C      2               H0 - A HTEPPOBAH;
C      3               IKA - HAEHE TOKA A  A  KOMEHCATOPA,
C                            ATPEOBAHHOE OOBATEEM
C                             MOMEHTA BPEMEH TN;
C      4               IKB - HAEHE TOKA A  B  KOMEHCATOPA,
C      5               IKC - HAEHE TOKA A  C  KOMEHCATOPA,
C      6               IHA - HAEHE TOKA A  A  HAPK,
C      7               IHB - HAEHE TOKA A  B  HAPK,
C      8               IHC - HAEHE TOKA A  C  HAPK,
C      9               UKA - HAPEHE A A KOMEHCATOPA,
C     10               UKB - HAPEHE A B KOMEHCATOPA,
C     11               UKC - HAPEHE A C KOMEHCATOPA,
C     12               UHA - HAPEHE A A HAPK,
C     13               UHB - HAPEHE A B HAPK,
C     14               UHC - HAPEHE A C HAPK,
C
C----------------------------------------------------------------------
C         DGMAS(1) - PXOT HOMEP APOCA,
C                    EC DGMAS(1)=1, TO TO EPB BXO B
C                    OPOPAMM PSUB HA AHHOM AE,
C                    EC DGMAS(1)=2, TO TO HE EPBA TEPA
C                    BXOT PHAK MOE
C         DGMAS(2) - PXOT HAEHE TOKA  IKA  A  A   MOE B
C                    MOMEHT TN+1, EC HOMEP APOCA = 1 ( DGMAS(1) ),
C                    TO HAEHE TOKA, BCEHHOE HA PEEM AE,
C                    EC HOMEP APOCA = 2 ( DGMAS(1) ), TO  TO
C                    HAEHE TOKA, BCEHHOE HA PEE TEPA
C                    AHHOO AA, AEE AHAOHO,
C         DGMAS(3) - AHAOHO  IKB,
C         DGMAS(4) - AHAOHO  IKC,
C         DGMAS(5) - AHAOHO  IK0,
C         DGMAS(6) - TOK CTOHKA CHTETECKO CXEM AMEEH  J12,
C         DGMAS(7) - TOK CTOHKA CHTETECKO CXEM AMEEH  J13,
C         DGMAS(8) - TOK CTOHKA CHTETECKO CXEM AMEEH  J23,
C         DGMAS(9) - TOK CTOHKA CHTETECKO CXEM AMEEH  J14,
C         DGMAS(10)- TOK CTOHKA CHTETECKO CXEM AMEEH  J24,
C         DGMAS(11)- TOK CTOHKA CHTETECKO CXEM AMEEH  J34,
C         DGMAS(12)- POBOMOCT  CHTETECKO CXEM AMEEH  G12,
C         DGMAS(13)- POBOMOCT  CHTETECKO CXEM AMEEH  G13,
C         DGMAS(14)- POBOMOCT  CHTETECKO CXEM AMEEH  G23,
C         DGMAS(15)- POBOMOCT  CHTETECKO CXEM AMEEH  G14,
C         DGMAS(16)- POBOMOCT  CHTETECKO CXEM AMEEH  G24,
C         DGMAS(17)- POBOMOCT  CHTETECKO CXEM AMEEH  G34,
C         DGMAS(18)-
C         DGMAS(19)-
C         DGMAS(20)-           P  E    E  P  B
C         DGMAS(21)-
C         DGMAS(22)-
C----------------------------------------------------------------------
C              INTMAS - MACCB  BXCOT (200) EMEHTOB,COETC
C                       B OPOPAMME  AOMHAH PETATOB
C                       POMETOHX BCEH.
C----------------------------------------------------------------------
C
C   OPOPAMM: HET
C   -------------
C
C   PMEAHE: CMMA KOECTBA TPEEMX TOKOB  HAPEH
C   ----------  HE OHA PEBAT 48.
C               ( KOHTPO HE POBOTC )
C----------------------------------------------------------------------
       DIMENSION URMAS(*), STMAS(*), DGMAS(*), INTMAS(*)
       COMMON /PROF1/ MASPRT(200)
       EQUIVALENCE ( NWTR ,MASPRT(13) )
       EQUIVALENCE ( NWTRE,MASPRT(14) )
       EQUIVALENCE ( TMAX ,MASPRT(43) )
C
C
C
C
C
C
C
C
       REAL INTMAS
C----------------------------------------------------------------------
       TN = STMAS(1)
       H0 = STMAS(2)
       T0 = URMAS(3)
       IF(URMAS(2).EQ.0.AND.DGMAS(1).NE.1) RETURN
       DGMAS(1) = URMAS(2)
C----------------------------------------------------------------------
       K=URMAS(4)
C      K - HOMEP AKOHA PABEH
C======================================================================
C--> K=1    IKA = - IHA + PH / ( UKA**2 + UKB**2 + UKC**2 ) * UKA(T)
C           IKB = - IHB + PH / ( UKA**2 + UKB**2 + UKC**2 ) * UKB(T)
C           IKC = - IHC + PH / ( UKA**2 + UKB**2 + UKC**2 ) * UKC(T)
C======================================================================
C
C    B CCKE APAMETPOB PSUB  OCE CTAHAPTHX APAMETPOB CET:
C    T - EPO BCEH APAMETPOB AKOHA;
C    NTOKOB - KOECTBO BBOMX TOKOB;
C    NNAGR - KOECTBO HAPOK B . E.
C    EPS - OKA OPEEEH CTAHOBBEOC PEMA
C    M -  BAPAHT BBOA HTEPAHX APAMETPOB (< 0   > = 0 )
C         PMEAH: 1. KOECTBO BBOMX HAPEH OHO T
C         -----------    PABHO KOECTB BBOMX TOKOB;
C                     2. OPOK BBOA  TOKOB EMEHTOB  X HA-
C                        PEH EH;
C                     3. EC HAPKA COEHEHA TPEOHKOM,
C                        BBOTC HEHE TOK  HAPEH COOTBET-
C                                 ========
C                        CTBE PACET PH  METOOM BX BATTMETPOB
C
C         COEPAHE  STMAS
C         -----------------
C    ------------------------------------------------------------------
C    HOMEP EMEHTA                     HAEHE
C    ------------------------------------------------------------------
C    1                                  CTAHAPTHE APAMETP PSUB5
C    2                                         =  "  =  "  =
C    2+I           ( I OT 1 O NTOKOB)  HAEH TOKOB EMEHTOB
C    2+NTOKOB+I    ( I OT 1 O NTOKOB)  HAEH HAPEH EMEHTOB
C    ------------------------------------------------------------------
C
C         COEPAHE INTMAS
C         -----------------
C    ------------------------------------------------------------------
C    HOMEP EMEHTA                     HAEHE
C    1                                  MOMEHT BPEMEH PEEO AA
C                                       ( TN-1 ) ;
C    2                                  EOE KOECTBO EPOOB, PO-
C                                       EX C MOMEHTA BKEH KOM-
C                                       EHCATOPA ( PER ) ;
C    3                                  HEP, OTAHHA ( PHTA )
C                                       KOMEHCATOPOM C HAAA AHHOO
C                                       EPOA ( TEKEE DW ) ;
C    4                                  HEP OTAHHA ( PHTA )
C                                       KOMEHCATOPOM C MOMEHTA BKE-
C                                       H  ( T0 ) A EOE CO PO-
C                                       EX EPOOB ;
C    5                                  TEKEE HAEHE HTEPAHO
C                                       CMM   BCEH  PH
C                                       ( APAMETPA AKOHA PABEH);
C    6                                  PH - HAEHE APAMETPA AKOHA,
C                                       COEMOE HA AHHOM AE ;
C    7                                  UKA**2 + UKB**2 + UKC**2
C                                       CMMA KBAPATOB ECTBX
C                                       HAEH HAPEH KOMEHCATO-
C                                       PA ( APAMETP AKOHA PABEH
C                                       COEM HA AHHOM AE ) ;
C    8                                  P E  E P B
C
C
C    9                                  EC INTMAS(9) = 1, TO POECC
C                                       CTAHOBBC
C   10 - 20                             P E  E P B
C
C    20 +I          (I OT 1 O NTOKOB)  TEKE HAEH HTEPAHX
C                                       CMM  BCEH ECTBX
C                                       HAEH TOKOB ;
C    20+NTOKOB+I    (I OT 1 O NTOKOB)  TO E  HAPEH ;
C    20+2*NTOKOB+I  (I OT 1 O NTOKOB)  TO E  AKTBHX MOHOCTE ;
C    ------------------------------------------------------------------
C
C-->  NMOD - OCTMOE KOECTBO MOEE AHHOO TA B CXEME
      NMOD = 2
C-->  POBOTC PACPEEEHE MACCBA  INTMAS  
C     MOEE AHHOO TA  -  PAHX EMEHTOB CXEM
C-----------------------------------------------------------------------
 124  DO 122 I=1,NMOD
      II = I
      NEL1 = IFIX(INTMAS(I))
      IF(NEL.EQ.NEL1) GO TO 123
 122  CONTINUE
 127  DO 125 I=1,NMOD
      III=I+1
      NNEL = IFIX(INTMAS(NMOD+1))
      IF(NNEL.EQ.I) GO TO 126
 125  CONTINUE
      INTMAS(NMOD+1) = 1.
      II = 1
      INTMAS(1) = FLOAT(NEL)
      GO TO 123
 126  INTMAS(III) = FLOAT(NEL)
      INTMAS(NMOD+1) = INTMAS(NMOD+1) + 1
      NNEL = IFIX(INTMAS(NMOD+1))
      IF(NNEL.GT.NMOD) GO TO 128
      GO TO 124
 128  WRITE(NWTRE,170) NMOD
      TMAX = TN
      RETURN
 123  NJ = (II - 1) *  98 + NMOD + 1
C----------------------------------------------------------------------
      IF(TN.LE.T0) GO TO 103
 104  IF(TN.LT.T0) RETURN
      NTOKOB = URMAS(6)
      IF(DGMAS(1).EQ.2) GO TO 102
      T=URMAS(5)
      EPS = URMAS(8)
      NNAGR=URMAS(7)
      PI=3.141593
      DT=TN-INTMAS(NJ+1)
      PER=AINT((TN-T0)/T)
      IF(PER.GT.INTMAS(NJ+2)) GO TO 105
C----------------------------------------------------------------------
C-->  BCEHE HTEPAHO CMM  PH
 106  INTMAS(NJ+5) = INTMAS(NJ+5) + ( STMAS(6) * STMAS(2+NTOKOB+4) +
     *STMAS(7) * STMAS(2+NTOKOB+5) + STMAS(8) * STMAS(2+NTOKOB+6)) * DT
C-->  BCEHE HTEPAHX CMM AHX HAPEH UKA,UKB,UKC
      DO 101 I=1,3
 101  INTMAS(NJ+20+NTOKOB+I) = INTMAS(NJ+20+NTOKOB+I) +
     * STMAS(2+NTOKOB+I)**2 * DT
C-->  BCEHE HTEPAHO CMM  HEP KOMEHCATOPA
      INTMAS(NJ+3) = INTMAS(NJ+3) + ( STMAS(3) * STMAS(2+NTOKOB+1) +
     *STMAS(4) * STMAS(2+NTOKOB+2) + STMAS(5) * STMAS(2+NTOKOB+3)) * DT
C----------------------------------------------------------------------
 116  IF(PER.GT.INTMAS(NJ+2)) GO TO 107
C-->  AOMHM BPEM TOO AA HA EE
      INTMAS(NJ+1)=INTMAS(NJ+1)+DT
C======================================================================
C     ABHA OPMA TEPA, BCEHE J,G-APAMETPOB KOMEHCATOPA
 102  GO TO (1),K
C----------------------------------------------------------------------
   1  IF(INTMAS(NJ+7)) 138,131,129
 131  DO 136 I = 6,17
 136  DGMAS(I) = 0.
C     DGMAS(12) = 1.E-3
C     DGMAS(13) = 1.E-3
C     DGMAS(14) = 1.E-3                O  T    A    K  A
      DGMAS(15) = 1.E-6
      DGMAS(16) = 1.E-6
      DGMAS(17) = 1.E-6
      GO TO 132
 129  DGMAS(6) = 0.
      DGMAS(7) = 0.
      DGMAS(8) = 0.
      DGMAS(9) = - STMAS(6)
      DGMAS(10)= - STMAS(7)
      DGMAS(11)= - STMAS(8)
      DGMAS(12)= 0.
      DGMAS(13)= 0.
      DGMAS(14)= 0.
      DGMAS(15)= INTMAS(NJ+6) / INTMAS(NJ+7)
      DGMAS(16)= INTMAS(NJ+6) / INTMAS(NJ+7)
      DGMAS(17)= INTMAS(NJ+6) / INTMAS(NJ+7)
      GO TO 132
 138  WRITE(NWTRE,180)
      TMAX = TN
      RETURN
C----------------------------------------------------------------------
 132  DGMAS(18) = INTMAS(NJ+6)
      DGMAS(19) = 0.
      DGMAS(20) = 0.
      DGMAS(21) = 0.
      DGMAS(22) = 0.
      RETURN
 103  IH = NJ + 1
      IB = NJ+98
      DO 114 I=IH,IB
 114  INTMAS(I) = 0.
      INTMAS(NJ+1) =T0
      DO 135 I = 6,22
 135  DGMAS(I) = 0.
C     DGMAS(12) = 1.E-3
C     DGMAS(13) = 1.E-3
C     DGMAS(14) = 1.E-3         O  T    A    K  A
      DGMAS(15) = 1.E-6
      DGMAS(16) = 1.E-6
      DGMAS(17) = 1.E-6
      GO TO 104
C-->  AKOHM BCEH  PEEO EPOA
 105  DT1=T0+PER*T-INTMAS(NJ+1)
      DT2=DT-DT1
      DT=DT1
      GO TO 106
 107  INTMAS(NJ+2)=PER
      INTMAS(NJ+4) = INTMAS(NJ+4) + INTMAS(NJ+3)
C----------------------------------------------------------------------
C-->  POBEPKA HA CTAHOBBC PEM
      PNOB = INTMAS(NJ+5)/T
      UNOB = (INTMAS(NJ+20+NTOKOB+1) + INTMAS(NJ+20+NTOKOB+2)
     * + INTMAS(NJ+20+NTOKOB+3)) / T
      IF(PNOB.LE.1.E-32.OR.UNOB.LE.1.E-32) GO TO 111
      EPS1 = ABS(INTMAS(NJ+4) - INTMAS(NJ+3))
      IF(EPS1.GT.EPS) GO TO 108
      EPS2 = ABS((PNOB - INTMAS(NJ+6))/PNOB)
      IF(EPS2.GT.EPS) GO TO 108
      EPS3 = ABS((UNOB - INTMAS(NJ+7))/UNOB)
      IF(EPS3.GT.EPS) GO TO 108
C----------------------------------------------------------------------
C-->  CTAHOBBC PEM
      INTMAS(NJ+9) = 1.
 133  WRITE(NWTR,160)
      WRITE(NWTR,130)PER,STMAS(1),INTMAS(NJ+4)
      IF(URMAS(9).GE.0.) GO TO 134
      TMAX = TN
      RETURN
 111  WRITE(NWTRE,110)
C----------------------------------------------------------------------
C-->  POECC HE CTAHOBC
C     AEM HOBE HAEH APAMETPOB AKOHA PABEH
 108  IF(URMAS(9).GE.0.) GO TO 133
 134  INTMAS(NJ+6) = PNOB
      INTMAS(NJ+7) = UNOB
C-->  HAHEM HAKOEHE HTEPAHX CMM C HAAA
      INTMAS(NJ+5) = ( STMAS(6) * STMAS(2+NTOKOB+4) + STMAS(7) *
     *STMAS(2+NTOKOB+5) + STMAS(8) * STMAS(2+NTOKOB+6)) * DT2
      DO 137 I = 1,3
 137  INTMAS(NJ+20+NTOKOB+I) = STMAS(2+NTOKOB+I)**2 * DT2
      INTMAS(NJ+3) = ( STMAS(3) * STMAS(2+NTOKOB+1) + STMAS(4) *
     *STMAS(2+NTOKOB+2) + STMAS(5) * STMAS(2+NTOKOB+3)) * DT2
      GO TO 102
 110  FORMAT(1X,'BOMOHO KOPOTKOE AMKAHE HAPK')
 130  FORMAT(1X,E12.5,20X,E12.5,20X,E12.5)
 160  FORMAT(1X,'BPEM EPEX. PEMA KM (EPO)',5X,'BPEM AA BBO
     *A TN',5X,'HEP,PHTA KOMEHCATOPOM')
 170  FORMAT(1X,'KOECTBO MOEE TA 17  18 PEBCO OCTMOE
     *( ',I2 ,' )')
 180  FORMAT(1X,'APAMETP  (UKA**2+UKB**2+UKC**2) < 0  ')
      END
