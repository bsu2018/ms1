         SUBROUTINE GETNEW( MSWALL, TOKN, TOKN1, VALLN, VALLN1,
     *          YALL, JALL, LOGYTR, WORKX, IRC, YALLHP, WORKY )
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)------------
C   OPOPAMMA:  GETNEW( MSWALL, TOKN, TOKN1, VALLN, VALLN1,
C   ------------    YALL, JALL, LOGYTR, WORKX, IRC, YALLHP, WORKY )
C
C   HAHAEHE:    - BCEHE OEPEHO TOK "COCTOH" E:
C   -----------    ***  T = TN + HXG OPEETC TOKN1  VALLN1 ***
C
C              == P IPOL = 0 --> OHA HTEPO, HEHA;
C                 P IPOL = 1 --> CEAHA,  METOA H.-BO.;
C ***ETO 1987********** BOEBOE PEEHE: P DX<ZEROCP, DX=0.0 *****
C
C                      - P APOCE (FRUN0 = 1) ---> BOHETC
C                        TECT PHE, P TOM OCKAETC
C                        HE OEE NRUNG "POEH" H0DATA;
C                         HXMIN "POTC" CHXPOHHO;
C                      - B CAE, H0 > H0_OLD -> TECT POBOTC BHE
C                        ABCMOCT OT FRUN0;
C
C                      - P PONRUN = 1 (CM. MASPRT) BBOTC CEEE
C                        TN  <CTAPTOBA TOKA>
C                        TN1 <"CTAPA" TOKA P TN+H0>
C                        TNX1 <HOBA TOKA  P TN+H0/2>
C                        TNX2 <HOBA TOKA  P TN+H0/2+H0/2>
C
C
C                      *** P FRUNGE = 0 TECT H KOA HE POBOTC **
C                      *** P FRUNGE = 2 TECT POBOTC HA KAOM   **
C                                               AE                ****
C
C
C              == P KODSYS = 1 --> PEEHE CA E TEPA;
C
C              == P KODSYS = 2 --> PEEHE CA C   TEPAM;
C                                    EPSSYS--> TOHOCT;
C                      ( "KCOK" -->  "C@CA@" );
C
C
C                  - CMEHA COCTOH BEHTHX EMEHTOB, BOEHE
C                    AA FKOM B CAE HA KOMMTA BEHTE...
C                    [ P OBTOPE PACETA C TOK TN, HEOXOMO HE
C                      MEH HAEH FKOM, HXG  HX B MSWALL MOEE
C                      "BEPHT" BEHT B COCTOHE P T = TN,
C                       EO BOCOOBATC / RESETX..].
C
C                  - P HEOXOMOCT B TN = T0 ( CM. MASPRT )
C                    POBEEHE POCECCA "OPEEEH CXOHOO
C                    COCTOH BEHTHX EMEHTOB", A TAKE B CAE
C                    TXG == TN, T.E. P HXG = 0.0 ==> POBOTC
C                    SEQTIM BOBPATOB B "CTAPTOBY" TOKY TN PACETA:
C                    P TOM -> BBO HOPMAOHHOO COOEH;
C                   ( C..K. SEQTIM - KOHTPO "AKBAH" );
C                    T CTA BOMOH P HXMIN = 0.0;
C
C                  - P BPOEH CCTEM - POCXOT 10-
C                    KPATHA OTKA ABTC OT TO CTA;
C                    TO BOMOHO P BKEH AA SEQTRX  P
C                    COB HE PABEHCTBA 0.0 POBOMOCT GVENT6;
C                    BHE ABCMOCT OT AA SEQTRX, P PACETE TOK
C                    T = T0, KOHTPO BPOEHHOCT CCTEM BKAETC;
C
C                  - P APOCAX OT DM... MOHTOPOB TEPAOHHX
C                    TOHEH EPEMEHHX COCTOH [ TOKN1 ],
C                    BOHETC HE OEE MITER TEPA;
C
C                - KA DM MOHTOP .TA 2 & 3 P ZAPROS=2 BOHET
C                  CPABHEHE PECKAAHHOO HAEH BEKTOPA "TOK"
C                  (XPAHTC B "TOKN1") C BCEHHM CXO 
C                  HAEH VALLN1;
C                B CAE, KOA EPS=ABS(TOK_ - TOKN1)/MAX(TOK_,TOKN1)
C                  > EITER --> KOD=1  P MAXITR<EPS -->
C                 KCPETC HOBOE HAEHE MAXITR=EPS  NLITER=N_-TA
C
C                - **** TOHEHE COCTOH ***: TO-->
C                  BOEHE AA FITER, TO TPEET OT DM MOHTOPOB
C                  .TA 2 & 3 P BCEH G-J APAMETPOB CPO-
C                  OBAT HE PECKAAHHE HAEH "TOK", A HAEH
C                  "TOK", XPAHEC B MACCBE "TOKN1";
C
C                - P MITER = 0  -->  KOHTPO HA KOD ^=0 HET !!!!!!!!!
C
C
C   METO:         - CKPETA PABHEH COCTOH MAKPOMOEE
C   -----            HA OCHOBE METOA HEPA-BO (H2^=0) 
C                    HE BHOO METOA EPA (H2=0), COCTABEHE CCTEM
C                    HEHX AE. P-  X PEEHE;
C                    PABEHE COCTOHEM BEHTHX EMEHTOB HA
C                    OCHOBE HOPMA  TN  TN+H0 MOMEHTA BPEMEH;
C                    HTEPO P HEOXOMOCT TOKOB  HAPEH;
C
C                 - P POBEEH TECTA PHE -> COETC
C                   PAO A HA KAHAE NFILER; CTEK 
C                   BX TOEK PEEH P T = TN   T = TN1;
C                   KOHTPO OK. OK - O BEKTOPAM . HAPEH;
C
C
C                  - "BBO" BEHTE B HAAHOE COCTOHE
C                    OCECTBETC B TOM CAE, KOA PEM AHA-
C                    PEMO E, AAHH OOBATEEM, HE COOTBET-
C                    CTBET "HAAHOM" COCTOH BEHTE.
C                    ( T.E. EC HA AE OT "TN=T0" O "TN+H0"
C                      HEKOTOPE BEHT MEHT CBOE COCTOHE
C                      TAK, TO TX (BPEM BOMOHO KOMMTA) = T0,
C                      TO BOHETC "HACTPOKA" TX BEHTHX
C                      EMEHTOB, KOTOPA AKAETC B CMEHE X
C                      COCTOH; ATEM TOKA TN+H0 PACTBAETC
C                      AHOBO. TA POEPA BOHETC HE     OH
C                      PA, HO TOKO B TOKE T = T0 ).
C
C          ==     B ABCMOCT OT METVET[MASPRT(107)] HXG OPEEETC:
C              =0 - HTEPO K TXG ME "TN"    "TN1 =TN+H0";
C              =1 - EPECET K TXG OT TN C H0=HXG;
C                   P TOM HXMIN - MIN BOMOH A;
C              =2 - "CAHE" "TN1" C "TXG",
C                   P TOM CMEHA COCTOH BEHTE C
C                    EPSKOM = TN1 - TXG
C              >2 - TO E, TO  =2, HO EPSKOM HE MOPETC;
C
C          ==  P METVET=1  HXMIN=0 --> PACET KAK  METVET=0  ===
C
C
C   APAMETP:     MSWALL - COPMPOBAHH CCOK COB COCTOH
C   ---------               MOEE EMEHTOB E;
C                  VALLN, TOKN - HAPEH  "TOK" E P
C                                T = T0, T.E. B HAAH MOMEHT BPEMEH
C                                B OCECTB - B TEK "CTAPTOB"
C                                MOMEHT BPEMEH T.E. B T = TN;
C                  VALLN1  TOKN1 - TO E   TN = TN + HXG  ( H0 );
C                  YALL - MATP OBX POBOMOCTE;
C                  JALL - BEKTOP CTOHKOB TOKA;
C                  LOGYTR - MACCB PHAKOB K.. OB;
C                           (  MAKPOMOEE EAHX BEHTE );
C                 WORKX - PA. MACCB, PAMEPHOCT HE MEHEE NSYS;
C                  IRC = 1 TOKA PACTAHHA, P FKOM = 1 COCTOH
C                          BEHTE MEHEH;
C                      = 2  MOEE C .TOM #2 / #3 A MITER
C                          TEPA HE OCTHTA TOHOCT EITER;
C                          ( TA CTA B V.M=2.0 HOPPETC )
C                      = 3 - TECT PHE HE BOHEH, TOHOCT HE
C                            OCTHTA AE OCE NRUNGE
C                            PA "POEH" H0DATA;
C
C                      P KODSYS = 2 HEOXOMO:
C                      WORKY --> PAMEPHOCT  <= NSYS;
C                      YALLHP --> PAMEPHOCT NDALL * NDALL;
C
C
C   OPOPAMM:  1. COMMON PROF1, PROF2, PROF3;
C   -------------  2. GETSYS,   MODVAL,  DECOM0+SOLVE0
C                  3. PRINT4, RSLMC, FACTR;
C   PMEAHE:
C   ----------
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(1)
         COMMON /PROF3/ FUNTAB(1)
         DIMENSION MSWALL(1), TOKN(1), TOKN1(1), VALLN(1), VALLN1(1)
         DIMENSION YALL(1), JALL(1), LOGYTR(1)
         REAL JALL, MU
         INTEGER FEND, FKOM, ZAPROS, T5MSW, T6MSW, PON, FLOG
         EQUIVALENCE ( MASPRT(29), TN ),
     =               ( MASPRT(30), H0 ),
     =               ( MASPRT(31), MU ),
     =               ( MASPRT(32), H1 ),
     =               ( MASPRT(33), H2 ),
     =               ( MASPRT(50), ZEROCP ),
     =               ( MASPRT(13), NWTR ),
     =               ( MASPRT(14), NWTRE ),
     =               ( MASPRT(35), TXG ),
     =               ( MASPRT(23), NDALL ),
     =               ( MASPRT(37), FLOG ),
     =               ( MASPRT(26), NSYS ),
     =               ( MASPRT(34), FKOM ),
     =               ( MASPRT(41), T5MSW ),
     =               ( MASPRT(49), T6MSW ),
     =               ( MASPRT(46), NNTOK ),
     =               ( MASPRT(56), PON   ),
     =               ( MASPRT(42), T0    ),
     =               ( MASPRT(28), ZAPROS )
         EQUIVALENCE ( HXG, MASPRT(61) )
         EQUIVALENCE ( GVENT6, MASPRT(59) )
         EQUIVALENCE ( EITER,  MASPRT(67) )
         EQUIVALENCE ( FITER,  MASPRT(65) )
         EQUIVALENCE ( MITER,  MASPRT(66) )
         INTEGER FITER, SEQTRX
         EQUIVALENCE ( SEQTRX, MASPRT(64) )
         EQUIVALENCE ( SEQTIM, MASPRT(71) )
         EQUIVALENCE ( NDIVH0, MASPRT(84) )
         EQUIVALENCE ( NFILER, MASPRT(83) )
         EQUIVALENCE ( FRUN0,  MASPRT(82) )
         EQUIVALENCE ( NRUNGE, MASPRT(70) )
         EQUIVALENCE ( ERUNGE, MASPRT(69) )
         EQUIVALENCE ( H0OLD,  MASPRT(81) )
         EQUIVALENCE ( NLITER, MASPRT(79) )
         EQUIVALENCE ( MAXITR, MASPRT(80) )
         EQUIVALENCE ( FRUNGE, MASPRT(68) )
         EQUIVALENCE ( H0DATA, MASPRT(40) )
         EQUIVALENCE ( PONRUN, MASPRT(86) )
         EQUIVALENCE ( NSITER, MASPRT(88) )
         EQUIVALENCE ( PPVENT, MASPRT(106) )
         EQUIVALENCE ( EPSKOM, MASPRT(39)  )
         EQUIVALENCE ( HXMIN,  MASPRT(62)  )
         EQUIVALENCE ( METVET, MASPRT(107)  )
         EQUIVALENCE ( IPOL,   MASPRT(108)  )
         EQUIVALENCE ( KODSYS, MASPRT(109)  )
         EQUIVALENCE ( EPSSYS, MASPRT(110)  )
         EQUIVALENCE ( KODMU,  MASPRT(113)  )
         EQUIVALENCE ( KODMUM,  MASPRT(114)  )
         INTEGER PPVENT
         DIMENSION WORKX(1), WORKY(1), YALLHP(1)
         REAL MAXITR
         INTEGER CASE, FRUN0, FRUNGE, PONRUN, CASE1
         INTEGER SEQTIM
C
C--->  P SEQTRX = 1  -  BKAETC KOHTPO HA BPOEHHOCT;
C
         ID(I,J) = NDALL * (J-1) + I
C====>
         DATA IHELPV/ 0 /, IHELP6/0/, K10/10/
         MAXITR = 0.0
         NLITER = 0
        CASE = 0
        CASE1 = 0
        FKOM = 0
C       ********
100    CONTINUE
         IHELP6 = 0
         IHELPV = 0
C--->  KOHTPO BKM:
         COND = 0.0
C-->  P SEQTRX = 0, BKM:
         IF ( SEQTRX .EQ. 0 ) COND = -1.0
C--> P TN = T0, KOHTPO BKM PHTEHO...
         IF ( T0 .EQ. TN ) COND = 0.0
C---> NITER - C..K. TEPA, FITER - A TEPA....
         NITER = 0
         FITER = 0
         IRC = 1
C======================================================================
C--->   AKCPEM BBEEHHOE HAEHE GVENT6.......
         HELP6 = GVENT6
         GVENT6 = 0.0
52       CONTINUE
C----------------------------------------------------------------------
C==>  COPMPOBAT CCTEM
         CALL GETSYS( MSWALL, YALL, JALL, LOGYTR,
     =                TOKN, TOKN1, VALLN, VALLN1 )
C
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C--->>>   C  A   <<<-------------------------------------------------
C --  METKA  201  --> TEP. METO.
       GO TO ( 200, 201 ), KODSYS
       CALL SUBERR(KODSYS)
200    CONTINUE
C
C   PET CCTEM < DECOM0 + SOLVE0 >
C===> IPVT  <==> VALLN1
C===> WORK  <==> WORKX
         CALL DECOM0( NDALL, NSYS, YALL, COND, VALLN1, WORKX  )
C
         IF ( COND .NE. COND+1. ) GO TO 1
C--->>  ABAP....
202    CONTINUE
C---> EC MOEM - TO EO TAEMC CPABT....
         IF ( HELP6 .EQ. 0.0 ) GO TO 15
C---->  EC EAHX BEHTE HET, TO  CPABT HEEO.....
         IF ( FLOG .EQ. 0 ) GO TO 15
C---> "BKHEM"
         T1HELP = TN + H0
         WRITE(NWTRE, 16 )         TN, H0,  T1HELP
16       FORMAT(' *** B TOKE: TN = ', G12.5, ' H0 = ', G12.5,
     =           ' TN1 = ', G12.5, '     ***'/
     =' ***  CCTEMA [Y] * [V] = [J] B__P_O___E_H_A ',24X,  ' ***')
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
         IF ( IHELP6 .GT. K10 ) GO TO 15
         IHELP6 = IHELP6 + 1
         RHELP6 = IHELP6
         GVENT6 = RHELP6 * HELP6
         WRITE(NWTRE,14) GVENT6
14       FORMAT(' *** POBOMOCT AKPTX BEHTE PHMATC PABHM
     =', E12.5, ' [CM]***' )
         GO TO 52
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
15       CONTINUE
C!!!-------------------------------------------------------------------
C  CCTEMA BPOEHA ATAHO...............
         WRITE(NWTRE,10) TN, H0
         WRITE(NWTR ,10) TN, H0
10       FORMAT(//' *** CCTEMA BPOEHA  _A_T_A___H_O   ***'/
     =          ' *** TN = ', E12.5, '  H0 = ', G12.5, ' ***')
C-->
C----------------------------------------------------------------------
C==>  COPMPOBAT CCTEM   EAT....
         CALL GETSYS( MSWALL, YALL, JALL, LOGYTR,
     =                TOKN, TOKN1, VALLN, VALLN1 )
C----------------------------------------------------------------------
C-->
       CALL PRINT4( YALL, JALL, LOGYTR )
C-->
C!!!-------------------------------------------------------------------
         CALL SUBERR(1)
1        CONTINUE
C===> PET CCTEM
         CALL SOLVE0( NDALL, NSYS, YALL, JALL, VALLN1, IRC )
C---> IRC - OKA HE AHAPEM.....
C===> PEEHE B VALLN1.....
         DO 20 I=1,NSYS
           VALLN1(I) = JALL(I)
20       CONTINUE
C
C--->> CA PEEH.........
203    CONTINUE
C--->  BOCTAHOBT CTAPOE GVENT6
         GVENT6 = HELP6
C===> BEH  AAPAT FLOG ?
         IF ( FLOG .EQ. 0 ) GO TO 60
C---> OPEET TOK OTKPTX BEHTE... ( B TOKN1 )
         KF = 3
         ZAPROS = 20
         CALL CALLDM(KF, MSWALL, YALL, JALL, LOGYTR,
     =               TOKN, TOKN1, VALLN, VALLN1, KODMD )
C--->
C===> MOPEM PEEHE COACHO LOGYTR.......
         CALL MODVAL( VALLN1, LOGYTR )
60       CONTINUE
C==> OPEEM HOBE TOK HA EMEHTAX "OCTOHHO" CTPKTP.....
         ZAPROS = 2
C===> OPOC BCEX DM...., KPOME EAHX BEHTE
         KF = 5
         CALL CALLDM(KF, MSWALL, YALL, JALL, LOGYTR,
     =               TOKN, TOKN1, VALLN, VALLN1, KODMD )
C
C--->  P MITER = 0, KOHTPO HET !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
       IF ( MITER .EQ. 0 ) GO TO 61
C--->
C---> ECT  APOC HA "TEPA"
         IF ( KODMD . EQ. 0 ) GO TO 61
C---> POCT TEPA.....
C======================================================================
C    MAKPOMOE .TA #2 / #3   APOC OABOHE
C              TEPA  TOHEH PECKAAHHX HAEH "TOK"
C              B TOM CAE KODMD ^= 0
C
C        HEOXOMO:
C OPOCT DM... MOHTOP C ZAPROS = 1 P BOEH FITER = 1 AA;
C DM... MOHTOP B TOM CAE OH COOBAT HE PECKAAHHE
C M HAEH "TOK", A HAEH  MACCBA "TOKN1"
C
C --->  BKAEM FITER
         FITER = 1
C--->  KCPEM TEPA
         NITER = NITER + 1
C--->  OBTOPEM, EC TO BOMOHO....
         IF ( NITER .LE.  MITER ) GO TO 52
C--> PEXA.....
         WRITE(NWTRE, 62 ) MITER, EITER, TN, H0
62     FORMAT(' *** B MOEX .TA 2 / 3 A ', I3,' TEPA ',
     =     25X, '***'/
     =' *** TOHOCT ', G12.5, ' HE OCTHTA ( TN=', G10.5,
     = ' H0=',G12.5, ' ***')
       WRITE(NWTRE,63) MAXITR, NLITER, NSITER
63     FORMAT(' *** MAX. OPEHOCT ', G12.5,' BHOCT EMEHT # ',
     =  I5, ' (CM.#', I3, ') ', 5X, '***' )
C--->  TO OKA HOPPEM....!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
         IRC = 2
C---> DIGITA - MOET OBTOPT PACET P MEHEM H0..........
C
C======================================================================
C
61       CONTINUE
C--->  AEK, TO CPOCM...
         FITER = 0
C
C===> TOKN   TOKN1 OPEEEH  BCEX EMEHTOB...P T => TN I TN1
C      VALLN    VALLN1 BECTH.....
CTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT
CTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT
CTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT
C   T_E_C_T_____P__H__E
C
700    CONTINUE
       GO TO ( 701, 704 ), CASE
C-->  HEH  TECT?
C
C***>  P FRUNGE = 2 --->  TECTPOBAHE HA KAOM AE !!!!!!!!!!!!!!!
C
C
       IF ( FRUNGE .EQ. 0 ) GO TO 799
       IF ( FRUNGE .EQ. 2 ) GO TO 710
C-->  P FRUN0 = 1  P H0 > H0OLD  TECTPEM....
       IF ( FRUN0 .EQ. 0  .AND.  H0 .LE. H0OLD ) GO TO 799
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
710    CONTINUE
C-->  KC. EPEMEHHE
       H0OLD = H0
       H1OLD = H1
       H2OLD = H2
       TNOLD = TN
       TN1OLD = TN + H0
C----------------------------------------------------------------------
        KAKA5=5
       IF ( PONRUN .EQ. 1  .AND.  PON .EQ. 1 )
     =                      CALL DRPR01(KAKA5,  TNOLD, TOKN, VALLN )
       IF ( PONRUN .EQ. 1  .AND.  PON .EQ. 1 )
     =                      CALL DRPR01(KAKA5,  TN1OLD, TOKN1, VALLN1 )
C----------------------------------------------------------------------
C-->  KC. TOK B CTEKE HA KAHAE NFILER...
       REWIND NFILER
       WRITE(NFILER) TN1OLD, ( VALLN1(I), I=1,NSYS)
       WRITE(NFILER) TN1OLD, ( TOKN1(I), I=1,NNTOK)
       WRITE(NFILER) TNOLD, ( VALLN(I), I=1,NSYS)
       WRITE(NFILER) TNOLD, (  TOKN(I), I=1,NNTOK)
       END FILE NFILER
C-->  MEHEM A
C-->
       H0 = H0OLD / 2.0
       H1 = H1OLD / 2.0
       H2 = H2OLD / 2.0
C-->  CET HOBO TOK   TN + H0/2, KCA B VALLN1  TOKN1...
       CASE = 1
       GO TO 100
701    CONTINUE
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C--->  TOKA  T = TN + H0/2  ---> B VALLN1  TOKN1
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C-->  KCPEM
       TN = TN + H0
       DO 702 I = 1, NSYS
702    VALLN(I) = VALLN1(I)
       DO 703 I = 1, NNTOK
703    TOKN(I) = TOKN1(I)
C----------------------------------------------------------------------
       IF ( PONRUN .EQ. 1  .AND. PON .EQ. 1 )
     =                      CALL DRPR01(KAKA5, TN,      TOKN, VALLN )
C----------------------------------------------------------------------
C-->  PACET  T = TN + H0/2 + H0/2  "HOB" BPAHT..
       CASE = 2
       GO TO 100
704    CONTINUE
        CASE = 0
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C   TOKA    T = TN +H0/2 +H0/2  -->  B VALLN1  TOKN1
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
        TN1X = TN + H0
C----------------------------------------------------------------------
       IF ( PONRUN .EQ. 1  .AND. PON .EQ. 1 )
     =                      CALL DRPR01(KAKA5,   TN1X,  TOKN1, VALLN1 )
C----------------------------------------------------------------------
C--->  BCM OPEHOCT...
        REWIND NFILER
C-->  TAEM B JALL  CTAPOE VALLN1...
       READ(NFILER) TXX, ( JALL(I), I=1,NSYS)
C-->  CPABHEH
       EPSMAX = 0.0
       IMAX = 0
       DO 714 I = 1, NSYS
       X1 = ABS( VALLN1(I) )
       X2 = ABS( JALL  (I) )
       IF ( X1 .LE. ZEPOCP  .OR.  X2 .LE. ZEROCP ) GO TO 780
       XZ = AMAX1( X1, X2 )
       EPS = ABS(X1 - X2) / XZ
       GO TO 781
780    CONTINUE
C-->  OHO  CE KO K H.....
       EPS = ABS( X1 - X2 )
781    CONTINUE
       IF ( EPS .LT. EPSMAX ) GO TO 714
C-->  KCPEM...
       IMAX = I
       EPSMAX = EPS
714    CONTINUE
C-->           TOOB KOHTPO....
       IF (  EPSMAX .LE. ERUNGE ) GO TO 705
C-->  TECT HE POE.....
       WRITE( NWTRE, 706 ) TNOLD, TN1OLD, IMAX, EPSMAX, ERUNGE
706    FORMAT(' *** HA [', G12.5, ' -:- ', G12.5, ' ]   A # ',
     =  I5, ' ***'/
     = ' *** OK. OPEHOCT ', G10.5, ' OE AAHHO ', G10.5,
     =  ' ***' )
C-->CMEHA AA  TOK, MAKET HOBO TOK  T = TN(CTAPOE) + H0OLD/2
C-->
       DO 707 I=1,NSYS
707    VALLN1(I) = VALLN(I)
       DO 708 I=1, NNTOK
708    TOKN1(I) = TOKN(I)
C-->  BOCTAHOBM "CTAPE" TOKN  VALLN  NFILER_A
C-->  POCTM AC O TOKN1
       READ(NFILER)
C-->  BOCTAHABBAEM...
       READ(NFILER) TXX, (VALLN(I), I=1, NSYS )
       READ(NFILER) TXX, (TOKN(I), I=1, NNTOK )
       TN = TNOLD
C--> OPEPM "C" BPEMEH....
       HXG = H0
       TXG = TN + H0
C-->  MEHM H0DATA....
       H0DATA = H0DATA / 2.0
       HXMIN = HXMIN / 2.0
C--> H1, H0, H2 --> E MEHEH..
       XX = H0DATA * 1.8E+4
       WRITE(NWTRE, 709 ) H0DATA, XX
709    FORMAT(' *** AAHH A H0DATA MEHEH HA ', G12.5,
     = ' (',G10.5,' ) ***')
C-->  KOHTPO AK.
       NDIVH0 = NDIVH0 + 1
       IF ( NDIVH0 .LE. NRUNGE ) GO TO 710
C-->  PEXA.....
       WRITE(NWTRE, 711) NRUNGE, H0DATA
711    FORMAT( /' *** PEBEHO O. KO-BO "POEH" AA H0DATA ',
     = I5, ' ***'/
     = ' *** "TECT PHE" OTKAETC, PACET BEETC C H0DATA = ',
     = G12.5, ' ***'/)
       WRITE(NWTR, 711) NRUNGE, H0DATA
       FRUNGE = 0
       IRC = 3
C-->  MAKET -->  TECT POE....
       GO TO 705
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
705    CONTINUE
C-->  TECT POE....
C-->  BOCTAHOBEHE "OAHOE"
       REWIND NFILER
       READ(NFILER) XX, ( VALLN1(I), I=1,NSYS)
       READ(NFILER) XX, ( TOKN1 (I), I=1,NNTOK)
       READ(NFILER) XX, ( VALLN (I), I=1,NSYS)
       READ(NFILER) XX, ( TOKN  (I), I=1,NNTOK)
C-->
       TN = TNOLD
       H0 = H0OLD
       H1 = H1 OLD
       H2 = H2 OLD
       HXG = H0
       TXG = TN + H0
C-->  BCE....
799    CONTINUE
CTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT
CTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT
CTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT
C==> A  KOMMTA?( EC T5MSW  T6MSW = 0, TO HET HEOXOMOCT )
C    EPEOPEET TX_G BPEM PEAHOO AA...)
C
         IF ( T5MSW .EQ. 0  .AND. T6MSW .EQ. 0 ) GO TO 3
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       FKOM = 0
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C===> TX_G  HAT...
C--->  EM KOM-...
         ZAPROS = 3
         KF = 2
         CALL CALLDM( KF, MSWALL, YALL, JALL, LOGYTR,
     =                TOKN, TOKN1, VALLN, VALLN1, KODMD )
3        CONTINUE
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       GO TO ( 851 ), CASE1
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C
C====>  A    K O M  T A    ?????
         IF ( FKOM .EQ. 0 ) GO TO 40
C######################################################################
C  O  P A  O T K A   K O M  T A    ..............................
C######################################################################
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C  OT 21.10.86.
       IF ( METVET .EQ. 0 ) GO TO 820
       IF ( METVET .EQ. 1 ) GO TO 850
       IF ( METVET .EQ. 2 ) GO TO 880
C@@@ HAE KAK  = 2, HO E MO. EPSKOM @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       GO TO 890
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
820    CONTINUE
C*****  H T E P  O        **************************************
C===>  MEHT COCTOHE BEHTE...
         ZAPROS = 4
         KF = 2
         CALL CALLDM( KF, MSWALL, YALL, JALL, LOGYTR,
     =                TOKN, TOKN1, VALLN, VALLN1, KODMD )
C
C******> CTAHOBT "HEBH EP", T.K. B TOM CAE FKOM = 1
C  P COB KODMU=0 ...........
         IF ( KODMU .EQ. 1 ) GO TO 54321
         H1 = H0
         H2 = 0.0
54321    CONTINUE
C
C
C
C
C**********************************************************************
C**********************************************************************
C====> "HACTPOKA" BEHTE====>  TOKO  AA T0 <===> T0+H0
C====>  EC TX = T0, TO OTKA PACETA E  OT CTAPO
C====> "CTAPTOBO" TOK, P TOM COCTOH BEHTE E MEHEH;
C====>  TA OEPA BOHETC #HE CTPOO# OH PA  TN = T0 
C====>  BCEO SEQTIM PA  TN ^= T0:
C######################################################################
C######################################################################
         IF ( ABS(TXG-T0) .GT. ZEROCP ) GO TO 50
C===>   #OMOAEM#   OBTOPEM, EC TO P T  = TN
         TXG = T0 + H0
         HXG = H0
         GO TO 52
50       CONTINUE
C!!!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
         IF ( HXG .NE. 0.0 ) GO TO 55
C---> "PKCOBBAHE" !!!COOEHE OKPOBAHO (13.01.87)!!!
         TN1 = TN + H0
C        WRITE(NWTRE, 56 ) TN1,     TN
56       FORMAT(            ' *** P TN1=', G12.5, ' "CPOC" B "CTAPTOB
     =" TOK TN=',G12.5,' ***')
         IHELPV = IHELPV + 1
         TXG = TN + H0
         HXG = H0
         IF ( IHELPV .LE. SEQTIM ) GO TO 52
C-@@@@@@@
         WRITE(NWTRE, 57) SEQTIM, TN, METVET
         WRITE(NWTR,  57) SEQTIM, TN, METVET
57    FORMAT(//' *** BOHEHO ', I5,' "CPOCOB" PACETA B "CTAPTOB"',
     =  ' TOK TN=', G12.5, ' ***'/
     = ' *** PACET PEPBAETC -> METVET=', I3, '     ***'///)
         CALL SUBERR(0)
55       CONTINUE
C!!!@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C**********************************************************************
C@@@@
       IF ( METVET .GE. 2 ) GO TO 856
C          @@@@@@@@@@@@@@@
C----------------------------------------------------------------------
C**********************************************************************
C===>   HTEPO [TOKN]  <=> [TOKN1]  B  [TOKN1]
C===>   HTEPO [VALLN] <=> [VALLN1] B  [VALLN1]
C
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       IF ( IPOL .EQ. 0 ) GO TO 900
C-->> CE. HTEPO.  TN <-> TN1 B TXG ( XPAHT B "N1" )
       D1X = (H1 - HXG) / H0
       D2X = (H2 - HXG) / H0
       DO 901 I = 1, NSYS
       VN1 = VALLN1(I)
       VN  = VALLN (I)
       VALLN1(I) = D1X * VN1 + D2X * VN  - HXG * ( VN1 - VN )
901    CONTINUE
C---
       DO 902 I=1, NNTOK
       TTN1 = TOKN1(I)
       TTN  = TOKN (I)
       TOKN1(I) = D1X * TTN1 + D2X * TTN - HXG * ( TTN1 - TTN )
902    CONTINUE
       GO TO 903
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
900    CONTINUE
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C  KOHTPO HTEPO ...
       IF ( HXG .GT. H0 ) GO TO 800
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C*******>DTX = (TX - TN ) / H0
         DTX = HXG / H0
         DO 4 I = 1, NSYS
         VN = VALLN(I)
         DVN1 = VALLN1(I) - VN
C******** BOEBOE PEEHE:
         IF ( ABS(DVN1) .LT. ZEROCP ) DVN1 = 0.0
         VALLN1(I) = VN + DVN1 * DTX
4        CONTINUE
C----------------------------------------------------------------------
         DO 5 I=1,NNTOK
         TTN = TOKN(I)
         DTN1 = TOKN1(I) - TTN
C******** BOEBOE PEEHE:
         IF ( ABS(DTN1) .LT. ZEROCP ) DTN1 = 0.0
         TOKN1(I) = TTN + DTN1 * DTX
5        CONTINUE
C*******BCE********
903    CONTINUE
802    CONTINUE
C!!!-------------------------------------------------------------------
         TN1 = TN + HXG
         IF ( PON .EQ. 1  .AND. PPVENT .EQ. 1 )
     =                     CALL DRPR01( 4, TN1, TOKN1, VALLN1 )
C!!!-------------------------------------------------------------------
         RETURN
40       CONTINUE
C===> KOMTA HE O....
C     TOKN1     VALLN1    T  =  TN + HXG  OPEEEH
         RETURN
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
800    CONTINUE
       TXG = TN + HXG
       WRITE(NWTRE,801)  TN, H0, TXG, HXG, METVET
801    FORMAT( ' *** ABAP B OKE HTEPO...[GETNEW]:',
     =  5X, '(METVET=', I2, 10X, ' ***'/
     = ' *** TN=',E12.5,' H0=',E12.5,' TXG=',E12.5,' HXG=',E12.5,
     = ' ***'  )
       GO TO 802
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
850    CONTINUE
C@@@ EPECET....
C@@  COCTOHE HE MEHEM, A CTAEM C H0 = HXG.....
       IF ( HXG .EQ. 0.0 ) GO TO 820
       CASE1 = 1
       H0M1 = H0
       H0 = HXG
       TXG = TN + H0
       GO TO 52
C-->  O CASE1 ....
851    CONTINUE
       H0 = H0M1
C-->  EPECTA K TOKE TN+HXG ....
       IF ( FKOM .EQ. 1 ) GO TO 852
C***
       WRITE(NWTRE, 85344 ) TN, HXG, METVET, HXMIN, EPSKOM
85344  FORMAT(' *** POCK KOMMTA TN=', G12.5, ' HXG=',G12.5,
     = ' ***'/
     = ' *** METVET=', I3, ' HXMIN=',G12.5, ' EPSKOM=', G12.5, ' ***')
       GO TO 853
C-->  MEHM COCTOHE BEHTE...
852    CONTINUE
C=
         ZAPROS = 4
         KF = 2
         CALL CALLDM( KF, MSWALL, YALL, JALL, LOGYTR,
     =                TOKN, TOKN1, VALLN, VALLN1, KODMD )
C
853    CONTINUE
C-->  EAT "KOMMTA" :::
       TN1 = TN + HXG
       IF ( PON .EQ. 1 .AND. PPVENT .EQ. 1 )
     =                 CALL DRPR01( 4, TN1, TOKN1, VALLN1 )
       CASE1 = 0
       RETURN
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
880    CONTINUE
C-->  "CAHE"
C-->  HOB EPSKOM....
       EPSOLD = EPSKOM
C-->   EPSKOM = (TN+H0) - (TN+HXG)
       EPSKOM = H0 - HXG
       IF ( EPSKOM .LT. 0.0 ) WRITE(NWTRE,8805) TN, H0, HXG, EPSKOM
8805   FORMAT(' *** TN=',G12.5,' H0=',G12.5,' HXG=',G12.5,
     =         ' EPSKOM=', G12.5, ' ***')
885    CONTINUE
C===>  MEHT COCTOHE BEHTE...
         ZAPROS = 4
         KF = 2
         CALL CALLDM( KF, MSWALL, YALL, JALL, LOGYTR,
     =                TOKN, TOKN1, VALLN, VALLN1, KODMD )
C
       EPSKOM = EPSOLD
C-->  AEE TAK E KAK  METVET=0    KPOME HTEPO..
       GO TO 50
856    CONTINUE
C-->  B "N1" PETAT ... EATAEM...
       TN1 = TN + HXG
       IF ( PON .EQ. 1 .AND. PPVENT .EQ. 1 )
     =      CALL DRPR01( 4, TN1, TOKN1, VALLN1 )
C@@@@@ C    A H  E  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
       HXG = H0
       TXG = TN + HXG
       RETURN
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
890    CONTINUE
C-->  E MO. EPSKOM_A...
       EPSOLD = EPSKOM
       GO TO 885
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C
C@CA@ ---------------------------------------------------------------
201    CONTINUE
C-->  CA C TEP. TO.
C  YALLHP  --> CXOHA, YALL - EKOMOPOBAHA...
C
C-->  XPAHM...
       DO 205 I=1,NSYS
       DO 206 J=1,NSYS
       IDHH = ID(I,J)
       YALLHP(IDHH) = YALL(IDHH)
206    CONTINUE
205    CONTINUE
C-->  YALL = L * U,  PER -> WORKY
       CALL FACTR( YALL, WORKY, NSYS, NDALL, IERFAC )
C
       IF ( IERFAC .EQ. 0 ) GO TO 207
C-->  TOHOE BPAEHE
       WRITE(NWTRE, 2000) TN
2000   FORMAT(' *** YALL HE AKTOPETC TN=',G12.5, ' ***' )
C
       GO TO 202
207    CONTINUE
C-->  POEM PEAT..
       EPSXXX = EPSSYS
       CALL RSLMC(YALLHP, YALL, JALL, VALLN1, NSYS, EPSXXX,
     =            IERRSL, NDALL, WORKX, WORKY )
C
C-->  ???
       IF ( IERRSL .EQ. 0 ) GO TO 203
C
       GO TO (211, 212, 213, 214 ), IERRSL
       CALL SUBERR(IERRSL )
211    CONTINUE
C-->  TOHA TOKO HOPMA..
C@@@@@@WRITE(NWTRE,2001)     TN
2001   FORMAT(' *** B CA TOHOCT -> TOKO ',
     =  ' HOPM PEEH TN=',G12.5,  ' ***' )
C-->  HOPPEM..
       GO TO 203
212    CONTINUE
C-->  TOHOCT HOPM HE A.
       WRITE(NWTRE,2002)         EPSXXX, TN
2002   FORMAT(' *** B CA',
     =  ' PEEHE C TOHOCT =',G12.5, ' TN=',G12.5,   ' ***' )
C-->  IGNORE
       GO TO 203
213    CONTINUE
C-->  HET CMCA..
       WRITE(NWTRE,2003) TN
2003   FORMAT(' *** PEEHE CA HE MEET CMCA TN=', G12.5, ' ***' )
       GO TO 202
C
214    CONTINUE
C-->  YALL = L*U  -->  B U --> 0- B AOHAE...
       WRITE(NWTRE,2004) TN
2004   FORMAT(' *** CA -> H B AOHA [U] TN=',G12.5, ' ***')
       GO TO 202
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
         END
