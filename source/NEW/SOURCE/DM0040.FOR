         SUBROUTINE DM0040 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                         MSWALL, RMSWAL, ADRMSW )
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT   1990 .)------------
C   OPOPAMMA:  DM0040 ( MSW, RMSW, YALL, JALL, LOGYTR,
C   ------------             TOKN, TOKN1, VALLN, VALLN1, KOD,
C    *                         MSWALL, RMSWAL, ADRMSW )
C
C   HAHAEHE:    B ABCMOCT OT HAEH AA ZAPROS [MASPRT(28)]:
C   -----------    BOHET CEE HK:
C
C
C                  A) ZAPROS = 1
C                     ----------
C                  OPMPOBAHE BKAOB B YALL MATP POBOMOCTE 
C                  JALL - BEKTOP CTOHKOB TOKA HAEH APAMETPOB
C                  KBBAEHTHX  G - J BETBE  MOE EMEHTA E
C
C                  T     M MOE     OOHAEH B AHEEM
C
C                  66            ..C             ESG
C                              
C                              CHCOAH
C
C
C                  67                 JSC
C                              CHCOAH
C                              . 
C
C
C              EMEHT KOPETC:
C              -------------------
C
C               # T 66  K0 K1     R    L
C                                   MAS < NGARM1  E1  FI1
C                                         NGARM2  E2  FI2
C                                         .....   ..  ...  >  ;
C
C
C
C
C               # T 67  K0 K1   MAS < NGARM1  J1  FI1
C                                        NGARM2  J2  FI2
C                                        .....   ..  ...  >  ;
C
C
C
C                  B) ZAPROS = 2
C                     ----------
C                  BCEHE HAEH TOKOB B BETBX B T(N+1) MOMEHT
C                  BPEMEH   CXO  G  J APAMETPOB  HAEH
C                  OBX HAPEH HA EMEHTE PACTAHHX  T(N+1)
C                     AC (KCA) TX HAEH B "TOK T(N+1)";
C
C                  D) ZAPROS = 4
C                     **********
C                     HE OEPBAETC;
C
C   METO:         CKPETA PABHEH COCTOH MOE AHHOO
C   -----          TA HA OCHOBE METOA HEPA BO:
C                  Y(N+1) = Y(N) + H1*F(N+1) + H2*F(N).
C
C   APAMETP:     MSW, RMSW - PABEE COBO COCTOH MAKPOMOE
C   ---------      ( "OTPEOK" MACCB MSWALL -> C.M. / GETMSW );
C                  YALL - MATPA P0BOMOCT AHAPEMO E;
C                  JALL - BEKTOP CTOHKOB TOKA AHAPEMO E;
C                  VALLN - BEKTOP OBX HAPEH AHAPEMO E:
C                          P  T  =  TN;
C                  VALLN1- BEKTOP OBX HAPEH AHAPEMO E:
C                           P  T  =  TN  + H0;
C                  TOKN    TOKN1 - BEKTOPA EPEMEHHX "COCTOH"
C                                   EMEHTA P  TN    TN + H0;
C                                   PAMEPHOCT CM. MASPRT(46)=NNTOK;
C                  LOGYTR - BEKTOP PHAKOB K.. OB:
C                  COETC B MAKPOMOEX C PHAKOM TA = 5;
C                  PAMEPHOC MACCBOB P "ALL" OPEETC:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKA_PAMEPHOCT ---> NSYS = MASPRT(26)
C                  KOD - APAMETP OPATHO CB C MOHTOPOM DM....
C
C
C
C
C   OPOPAMM:  1. COMMON PROF1, PROF2, PROF3;
C   ------------             DEPOST;
C
C   PMEAHE:  1.CTPKTP MSW COBA MAKPOMOE AHHOO TA CM. HE
C   ----------   2. P ZAPROS ^=   1   2 - COOEHE  XO;
C
C
C               "OCTOHHA" ACT MSW TA # 66  #67
C                --------------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I  P. I KO I KO. IAP.   IPE I
C  I EME I TA   I /    I  TA  I ECT I BB. IHA.  IE I
C  I HTA   I MOE I PACETAI  MOEI BO   I HA I"TOKN" IPB I
C  I       I        I DM.....I        I OBI EH.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I   7   I 8 I
C  +-------+--------+--------+--------+------+------+-----------+
C
C
C
C                  RMSW TA # 66 [ CTOHK SIN HAPEH ]
C                  -----------------------------------------
C
C             ++-----+-----+--------+----+----+
C             II     I     I - I    I    I
C   :     II  R  I  L  I .I G  I J  I
C  K0         II     I     I  K     I    I    I
C             ++-----+-----+--------+----+----+
C      K1     II  1  I  2  I   3    I 4  I  5 I
C             ++-----+-----+--------+----+----+
C  9   10     II 11  I 12  I  13    I 14 I 15 I
C             ++-----+-----+--------+----+----+
C
C             +-----+-----+-----+--->...+------+------+------+
C             I     I     I     I--->...I      I      I      I
C             I NG1 I E1  I FI1 I--->...I NGK  I EK   I FIK  I
C             I     I     I     I--->...I      I      I      I
C             +-----+-----+-----+--->...+------+------+------+
C             I  6  I  7  I  8  I--->...I 3+K*3I4+K*3 I 5+K*3I
C             +-----+-----+-----+--->...+------+------+------+
C             I  16 I  17 I  18 I--->...I13+K*3I14+K*3I15+K*3I
C             +-----+-----+-----+--->...+------+------+------+
C
C
C
C                  RMSW TA # 67 [ CTOHK SIN TOKA ]
C                  ------------------------------------
C
C             ++-----+-----+--------+----+----+
C             II  -I  -I - I    I    I
C   :     II I I .I G  I J  I
C  K0         II     I     I  K     I    I    I
C             ++-----+-----+--------+----+----+
C      K1     II  1  I  2  I   3    I 4  I  5 I
C             ++-----+-----+--------+----+----+
C  9   10     II 11  I 12  I  13    I 14 I 15 I
C             ++-----+-----+--------+----+----+
C
C             +-----+-----+-----+--->...+------+------+------+
C             I     I     I     I--->...I      I      I      I
C             I NG1 I E1  I FI1 I--->...I NGK  I EK   I FIK  I
C             I     I     I     I--->...I      I      I      I
C             +-----+-----+-----+--->...+------+------+------+
C             I  6  I  7  I  8  I--->...I 3+K*3I4+K*3 I 5+K*3I
C             +-----+-----+-----+--->...+------+------+------+
C             I  16 I  17 I  18 I--->...I13+K*3I14+K*3I15+K*3I
C             +-----+-----+-----+--->...+------+------+------+
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSWALL(*), RMSWAL(*)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         REAL JALL, JES
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( NDALL,  MASPRT(23) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( TXG,    MASPRT(35) )
         EQUIVALENCE ( NTXG,   MASPRT(36) )
         EQUIVALENCE ( EPSKOM, MASPRT(39) )
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
         INTEGER ADRMSW, TIP, ZAPROS
C
C==> "HOBOE" BPEM   ( A, .... )
         TN1 = TN + H0
C---->    OKEH:
         K0 = MSW(9)
         K1 = MSW(10)
         KOD = 0
C--->  KOHTPO TA
         TIP = MSW(2)
         IF ( TIP .EQ. 66  .OR.  TIP .EQ. 67 ) GO TO 10
C----------------------------------------------------------------------
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** O. CO B DM0040 - APOC HA OCBAHE O
     =O TA ***'/
     =    ' *** EMEHT # ', I10, ' T MOE # ', I10, ' ***'//)
         CALL SUBERR(0)
C----------------------------------------------------------------------
10     CONTINUE
C---> BOP PEMA:
         GO TO ( 667, 666                 ), ZAPROS
C===> HAE OKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHTOP #', I4, ' APOC OCBAH OOEH
     = ***'/ ' *** ZAPROS = ', I5, ' - HOPPETC ***')
         RETURN
667      CONTINUE
C---------ZAPROS = 1---------------------------------------------------
C
C
         IF( TIP .EQ. 67 ) GO TO 67
C---> CTOHK SIN HAPEH
C--->   OEMEHTH BKA:
         ITOK= MSW(7)
         TOK = TOKN(ITOK)
C----------------------------------------------------------------------
         VK0 = 0.0
         IF ( K0 .NE. 0 ) VK0 = VALLN(K0)
         VK1 = 0.0
         IF ( K1 .NE. 0 ) VK1 = VALLN(K1)
         UN = VK0 - VK1
C----------------------------------------------------------------------
C-->  
         KGARM = MSW(13)
         EN = 0.0
         EN1= 0.0
         DO 2000 I=1,KGARM
         NG  =  MSW(13+3*I)
         EG  = RMSW(14+3*I)
         FIG = RMSW(15+3*I)
         EN  = EN  + EG * SIN( NG * 314.16 * TN  + FIG )
         EN1 = EN1 + EG * SIN( NG * 314.16 * TN1 + FIG )
2000     CONTINUE
C----------------------------------------------------------------------
         Z = RMSW(12) + H1 * RMSW(11)
         GES = H1 / Z
         JES =( TOK*(RMSW(12)-H2*RMSW(11)) + H1*EN1 + H2*EN + H2*UN )/Z
         RMSW(14) = GES
         RMSW(15) = JES
C---->
C======================================================================
         KOD = 0
C---->
         CALL DEPOST( K0, K1, GES, JES, YALL, JALL )
C---->
         RETURN
C======================================================================
67       CONTINUE
C---> CTOHK SIN 
C--->   OEMEHTH BKA:
C-->   
         KGARM = MSW(13)
         TOKJN1= 0.0
         DO 3000 I=1,KGARM
         NG  =  MSW(13+3*I)
         AG  = RMSW(14+3*I)
         FIG = RMSW(15+3*I)
         TOKJN1 = TOKJN1 + AG * SIN( NG * 314.16 * TN1 + FIG )
3000     CONTINUE
C----------------------------------------------------------------------
         JES =  TOKJN1
         RMSW(15) = JES
C---->
C======================================================================
         KOD = 0
C---->
         CALL DEPOST( K0, K1, 0.0, JES, YALL, JALL )
C---->
         RETURN
C======================================================================
666      CONTINUE
C################   ZAPROS = 2   ######################################
C---> TO A T?
         IF ( TIP .EQ. 67 ) GO TO 167
C######################################################################
C---> CTOHK SIN HAPEH.
C--->     HOBEEE BPEM...        TN + H0 =>  HEO JES OPEEEHO!!!
         GES = RMSW(14)
         JES = RMSW(15)
C--->  HOBOE HAPEHE:
         VK0 = 0.0
         IF ( K0 .NE. 0 ) VK0 = VALLN1(K0)
         VK1 = 0.0
         IF ( K1 .NE. 0 ) VK1 = VALLN1(K1)
         UN1 = VK0 - VK1
C--->  HOB TOK:
         TOKT = GES * UN1 + JES
C--->  AC TOKOB
         ITOK = MSW(7)
         TOKN1( ITOK ) = TOKT
         KOD = 0
         RETURN
C######################################################################
167      CONTINUE
C---> CTOHK SIN 
         JES = RMSW(15)
C--->  AC TOKOB
         ITOK = MSW(7)
         TOKN1( ITOK ) = JES
         KOD = 0
         RETURN
C######################################################################
         END
