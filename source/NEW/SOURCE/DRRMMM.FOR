      SUBROUTINE DRRMMM(MSWALL,TOKN)
CXXX****KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)************
C OPOPAMMA:    DRRMMM(MSWALL,TOKN)
C--------------
C
C  HAHAEHE:    OPAOTKA EPEKTB
C ------------    #MPEM
C                 < M MOE >  #  ISQ  ISD  IRQ  IRD  OMEGA(;)
C
C               AAHE HAAHOO PEMA PAOT . MAH:
C                 < M MOE > - M3X3X0 - PEAOBAHO;
C                              # - HOMEP EMEHTA B E;
C                            ISQ - POEK TOKA CTATOPA HA OC Q
C                                  OOPHO CCTEM;
C                            ISD - POEK TOKA CTATOPA HA OC D
C                                  OOPHO CCTEM;
C                            IRQ - POEK TOKA POTOPA HA OC Q
C                                  OOPHO CCTEM;
C                            IRD - POEK TOKA POTOPA HA OC D
C                                  OOPHO CCTEM;
C                          OMEGA - OBA CKOPOCT BPAEH POTOPA;
C
C     !!! BHMAHE !!!  OOPHA CCTEMA Q-D OCE COBAAET C OC
C                       A "A" CTATOPA ( OC Q ) ,
C                       OC D OEPEAET OC Q HA +90 PA.;
C                       CCTEMA CTATOPHX OMOTOK COBMEEHA C
C                       CCTEMO POTOPHX OMOTOK , T.E. GAMMA=0;
C     !!!!!!!!!!!!!!!!
C
C    METO:        BBO  POEK Q-D HAEH HA A-B-C OC.
C   -------
C
C  APAMETP:      MSWALL -CCOK COB COCTOH EMEHTOB;
C -----------        TOKN -MACCB HAAHX HAEH EPEMEHHX
C                          COCTOH;
C
C  OPOPAMM:   1.PROF1 , SUBERR
C --------------   2.GETDAT,SEQMS0
C
C  PMEAHE:     1.P EPEXOE  Q-D B A-B-C , CTAETC,
C ------------       TO "A"+"B"+"C"=0
C                    ( KOEHT 2/3 HE BBOTC );
C                  2.AC ...,,...  KBBAEHTHA ...,0,...;
C                  3.KOHE AHHX O ";"  OCE BBOA
C                    BCEX HAEH;
C                  4.P OKE BCE OHETC.
C
CZZZ*******************************************************************
      COMMON/PROF1/ MASPRT(200)
      EQUIVALENCE (NWTR, MASPRT(13))
      EQUIVALENCE (NWTRE,MASPRT(14))
      EQUIVALENCE (NRDR, MASPRT(12))
      EQUIVALENCE (KAR1(2),KAR(1))
      EQUIVALENCE (DIAL,MASPRT(15))
      DIMENSION MSWALL(1),TOKN(1),KAR(80),LTAB(10)
      DIMENSION DAT(21),M3X3X0(6),KAR1(81),PAR(6)
      INTEGER TERM,DIAL,BLANK
      REAL ISA,ISB,ISC,IRA,IRB,IRC
      REAL ISQ,ISD,IRQ,IRD
      INTEGER AMOT,ATOKM,TIPX
C
      DATA M3X3X0/'M','3','X','3','X','0'/
      DATA R120/2.0943951/,TERM/';'/
      DATA LTAB/11,110,12,120,6*0/,KLTAB/4/
      DATA KAR1/81*' '/,PAR/6*0.0/
      DATA BLANK/' '/,GAMMA/0.0/
C
      A(Q,D)=Q*COS(0.0*R120)+D*SIN(0.0*R120)
      B(Q,D)=Q*COS(1.0*R120)+D*SIN(1.0*R120)
      C(Q,D)=Q*COS(2.0*R120)+D*SIN(2.0*R120)
C--->  CK BBEEHHX
      KPAR=0
      DO 2000 I=1,81
 2000 KAR1(I)=BLANK
      DO 2001 I=1,21
 2001 DAT(I)=0.0
C--->  BBO CE.....
      READ (NRDR,1,END=666)(KAR(I),I=1,80)
      IF(DIAL.EQ.0) WRITE(NWTR,1001)(KAR(I),I=1,80)
 1001 FORMAT(/20X,80A1)
 1    FORMAT(80A1)
C--->  M ?
      DO 2 I=1,6
      IF(M3X3X0(I).NE.KAR(I)) GO TO 667
 2    CONTINUE
C--->  HAE.....
 100  CONTINUE
C--->  BT CO
      CALL GETDAT(KAR,DAT,IRL)
C--->  CKOKO ?
      KKK=IFIX(DAT(1))
C--->  HAKOT.....
      IF(KKK.GT.6) KKK=6
      DO 3 I=1,KKK
 3    PAR(KPAR+I)=DAT(1+I)
      KPAR=KPAR+KKK
 5    CONTINUE
C--->  HHO  EE ?
      IF(KPAR.GE.6) GO TO 10
      DO 4 I=7,72
      IF(KAR(I).EQ.TERM) GO TO 10
 4    CONTINUE
C--->  OBBO.....
      READ (NRDR,1,END=666)(KAR(I),I=1,80)
      IF(DIAL.EQ.0) WRITE(NWTR,1002)(KAR(I),I=1,80)
C--->  KA...CTM 73 O KAR.....
      KAR1(72)=BLANK
 1002 FORMAT(1X,20X,80A1)
C--->  OM CA , B KAR1(1) POE
      CALL GETDAT(KAR1,DAT,IRC1)
      KKK1=IFIX(DAT(1))
C--->  OPAHMC.....
      IF(KKK1.GT.(6-KPAR)) KKK1=6-KPAR
      IF(KKK1.LT.0) CALL SUBERR(KKK1)
C--->  PEM CE
      DO 40 I=1,KKK1
 40   PAR(KPAR+I)=DAT(I+1)
      KPAR=KPAR+KKK1
C--->  EE HHO ?
      GO TO 5
C**********************************************************************
 10   CONTINUE
      ISQ=PAR(2)
      ISD=PAR(3)
      IRQ=PAR(4)
      IRD=PAR(5)
      OMEGA=PAR(6)
      NELM=IFIX(PAR(1))
C--->  CKAT B MSWALL EMEHT C HOMEPOM NELM:
      CALL SEQMS0(MSWALL,NELM,AMOT,IRC0,KVTV,ATOKM)
      IF(IRC0.EQ.1) GO TO 11
C--->  EMEHTA HET.
      WRITE (NWTR,1005)NELM
 1005 FORMAT(/' *** E HE COEPT EMEHTA # ',I5,' ***'/
     *' *** EPEKTBA HOPPETC ***')
      RETURN
 11   CONTINUE
C--->  TO A T ?
      TIPX=MSWALL(AMOT+1)
      DO 12 I=1,KLTAB
      IF(TIPX.EQ.LTAB(I)) GO TO 13
 12   CONTINUE
C--->  HE HA T......
      WRITE (NWTR,1006) NELM,TIPX,(M3X3X0(I),I=1,6)
 1006 FORMAT(/' *** EMEHT E # ',I5,' ( T ',I4,') ***'/
     *' *** HE MOE . MAH ',6A1,' ***'/
     *' *** PEKTBA HOPPETC ***'/)
      RETURN
 13   CONTINUE
C--->  BCE O'KE....
      WRITE (NWTR,1007) NELM,TIPX,(M3X3X0(I),I=1,6),
     *                  ISQ,ISD,IRQ,IRD,OMEGA,GAMMA
 1007 FORMAT(/' ***  EMEHTA E # ',I5,' ( T ',I4,')',
     = 19X, ' ***'/
     *' *** . MAH ',6A1,' CTAHOBEHO:', 26X, ' ***'/
     *' ***   ISQ=',G12.5,'   ISD=',G12.5,    19X, ' ***'/
     *' ***   IRQ=',G12.5,'   IRD=',G12.5,    19X, ' ***'/
     *' *** OMEGA=',G12.5,' GAMMA=',G12.5,    19X, ' ***')
      ISA=A(ISQ,ISD)
      ISB=B(ISQ,ISD)
      ISC=C(ISQ,ISD)
C**********************************************************************
      IRA=A(IRQ,IRD)
      IRB=B(IRQ,IRD)
      IRC=C(IRQ,IRD)
      WRITE (NWTR,1008) ISA,ISB,ISC,IRA,IRB,IRC
 1008 FORMAT(' ***   AHX HAEH ( OC Q COBAAET',
     *' C AO "A" ): ***'/
     *' *** ISA=',G12.5,' ISB=',G12.5,' ISC=',G12.5,'       ***'/
     *' *** IRA=',G12.5,' IRB=',G12.5,' IRC=',G12.5,'       ***'/)
C--->  PACTABT HAEH.
      TOKN(ATOKM+0)=ISA
      TOKN(ATOKM+1)=ISB
      TOKN(ATOKM+2)=ISC
      TOKN(ATOKM+3)=IRA
      TOKN(ATOKM+4)=IRB
      TOKN(ATOKM+5)=IRC
      TOKN(ATOKM+6)=GAMMA
      TOKN(ATOKM+7)=OMEGA
      RETURN
C**********************************************************************
 667  CONTINUE
      WRITE (NWTR,1009)(M3X3X0(I),I=1,6),(LTAB(I),I=1,KLTAB)
 1009 FORMAT(/' *** PEKTBA " #MPEM" PEAOBAHA  MOEE ***'/
     *' *** M MOE:',6A1,' HOMEPA TOB: ***'/
     *' *** ',10I6,' ***')
      WRITE (NWTR,1010)
 1010 FORMAT(' *** HOPPETC ***'/)
      RETURN
 666  CONTINUE
      WRITE (NWTR,1011) NRDR
 1011 FORMAT(/' *** KOHE HA KAHAE BBOA ',I2,' [ DRRMMM ] ***'/
     *' *** PAOTA PEPBAETC ***'//)
      CALL SUBERR(0)
      RETURN
      END
