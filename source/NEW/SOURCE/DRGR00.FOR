         SUBROUTINE DRGR00(KOD, MKOD, SPIS, TIME,TOKN,VALLN,NDX,XGRAF)
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)------------
C   OPOPAMMA:   DRGR00(KOD, MKOD, SPIS, TIME,TOKN,VALLN,NDX,XGRAF)
C   ------------
C   HAHAEHE:    COHTEH "MEXAHM" BBOA "PAECKO"
C   ----------     HOPMA PEKTB #PA;
C
C   METO:         OEBEH;
C   -----          (EC P APOCE HAKOEH TOEK BBOA PEAAT
C                  PHT OE TOEK, EM AAHO B NTGRAF P KOD=1,
C                  TO TOHE TOK HOPPTC...)
C
C   APAMETP:     KOD = 1 - OTKPT PEM TOEK BBOA;
C   ---------          = 2 - PHT OEPEH TOK;
C                      = 3 - AKPT PEM TOEK, EATAT HA NWTR;
C                  MKOD = 0 - BBO PAKOB B HBAHX MACTAAX;
C                       = 1 - BBO BCEX PA. B OHOM MACTAE;
C                       = 2 - BBO KAK P =0  P =1 (BA PCHKA);
C                  SPIS - CCOK "APOC BBOA";
C                  TIME, TOKN, VALLN - MACCB HAEH OEPEHO TOK;
C                  NDX - PAMEPHOCT - PAOEO MACCBA XGRAF;
C                  XGRAF - PAO MACCB, MAX PAMEPHOCT
C                        <1+KO-BO PAKOB> * <KO-BO TOEK BBOA >
C                         ( CM. PMEAHE );
C
C   OPOPAMM:  1. PLOT2, MOVE0
C   ------------   2. COMMON PROF1, SERVZ2, SERVZ3;
C
C   PMEAHE:    1. KOHTPO HE PBOTC;
C                  2. KOECTBA TOEK BBOA BPAETC 
C                     MASPRT(47) = NTGRAF
C                  3. P MAOM PAMEPE MACCB XGRAF:
C                     KOA NTGRAF > NDX, OCECTBETC
C                     PAEHE BBOHOO OTOKA HA "OP"
C                  4. "CETKA" O BPEMEHHO OC BPAETC  XGRGAD
C                      MASPRT(63), AABAEMA B . PACAX;
C
CZZZ-------------------------------------------------------------------
         DIMENSION SPIS(1), TOKN(1), VALLN(1), XGRAF(1)
         INTEGER SPIS, FRAGM, ANM, ANT, TABTOK, TABTIP, TIP
         COMMON/PROF1/ MASPRT(80)
         COMMON/SERVZ2/ TABTOK(1)
         COMMON /SERVZ3/ TABTIP(1)
         INTEGER HELP, DIAL, PX
         DIMENSION HELP(80), RHELP(1)
         EQUIVALENCE ( HELP(1),  RHELP(1) )
         EQUIVALENCE ( NRDR,     MASPRT(12) )
         INTEGER YES, NO
         DIMENSION YES(2), NO(3)
         EQUIVALENCE ( NWTR, MASPRT(13) )
         EQUIVALENCE ( NWTRE, MASPRT(14) )
         EQUIVALENCE ( DIAL,  MASPRT(15) )
         EQUIVALENCE ( NTGRAF,  MASPRT(47) )
         EQUIVALENCE ( HOUTT,   MASPRT(48) )
         EQUIVALENCE ( XGRGAD,  MASPRT(63) )
C
         DATA YES/'', 'A' /, NO / 'H', 'E', 'T' /
C**********************************************************************
         KP = SPIS(1)
         IF ( KP .GT. 9 ) KP = 9
         GO TO (1,2,3), KOD
         CALL SUBERR(KOD)
1        CONTINUE
C--->  OTKPT OCT
C-->  CETKA:
         NXX = 0
         IF ( (XGRGAD/1.8E+4) .GT. HOUTT )
     =                         NXX = INT( XGRGAD/(HOUTT*1.8E+4) + 0.5 )
         IF ( NXX .EQ. 0 ) NXX = 5
C->> CKOKO MAX TOEK MOEM BBECT A OH "AXO"
         NX1 = NDX/(1+KP)
C---> HO HAM HAO BBOT NXT TOEK:
         NXT = NTGRAF
C-->  HAEM CKOKO MOEM BBOT B OHOM PAMEHTE...
C     FRANM - A PAMEHTOB, NREAL - C..K. PHTX TOEK
         IF ( NXT .LE. NX1 ) GO TO 10
C--> NX BEPEM O MAX, HO KPATHO CETKE...
         NX = (NX1/NXX) * NXX
         FRAGM = 1
         GO TO 11
10       NX = NXT
         FRAGM = 0
11       CONTINUE
         NREAL = 0
C--->  BBO AOOBKA...
         WRITE(NWTR,12)
12       FORMAT(1H1/20X,' PAK HAEH '/)
         ISPIS = 2
         IHELP = 1
         KPP = KP
         NNG = 0
13       CONTINUE
         IF ( KPP .LE. 0 ) GO TO 14
         NNG = NNG + 1
         PX = SPIS(ISPIS)
         GO TO ( 15, 16, 17 ), PX
         CALL SUBERR(PX)
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
15       CONTINUE
C--->  HAPEH
         NV = SPIS(ISPIS+1)
         WRITE(NWTR, 502) NNG, NV
502      FORMAT(1X,'CMBO ', I2, ' - ', 'HAPEHE A ', I5, ' ;')
         KPP = KPP -1
         ISPIS = ISPIS + 6
         GO TO 13
16       CONTINUE
C-->  PAHOCT
         NV = SPIS(ISPIS+1)
         NV1 = SPIS(ISPIS+2)
         WRITE(NWTR,503) NNG, NV, NV1
503      FORMAT(1X,'CMBO ', I2, ' - ', 'HAPEHE ME AM ',
     =  I5, '  ', I5, ' ;' )
         KPP = KPP - 1
         ISPIS = ISPIS + 6
         GO TO 13
17       CONTINUE
C---> TOK
         NEL = SPIS(ISPIS + 2)
         ANM = SPIS(ISPIS+3)
         ANT = SPIS(ISPIS+4)
         NSM = SPIS(ISPIS+5)
         IHELP = 1
         HELP(IHELP) = NNG
         IHELP = IHELP + 1
         CALL MOVE0( HELP(IHELP), TABTOK(ANT), 3 )
         IHELP = IHELP + 3
         HELP(IHELP) = NEL
         IHELP = IHELP + 1
         HELP(IHELP) = NSM
         IHELP = IHELP + 1
         CALL MOVE0( HELP(IHELP), TABTIP(ANM), 5 )
         IHELP = IHELP + 4
         WRITE(NWTR, 504) NNG,(HELP(I),I=2,4),NEL,NSM,(HELP(I),I=7,11)
504      FORMAT(' CMBO ', I2, ' - ',3A4, ' --> ', 'EMEHT ', I5,
     =        ' HAEHE ', I3, ' (', 5A4, ');'  )
         KPP = KPP - 1
         ISPIS = ISPIS + 6
         GO TO 13
14       CONTINUE
C-->  "CE..."
       WRITE(NWTR, 5040 )
5040   FORMAT(/)
         RETURN
C######################################################################
2        CONTINUE
C-->  PHT OEPEH, NX  OTOBO...
         NREAL = NREAL + 1
C--->  BOMOHO := PEAAT H TOK ??, EC A, TO HOPTPEM!
         IF ( NREAL .GT. NX ) RETURN
         NNG = 0
         ISPIS = 2
         KPP = KP
         XGRAF(NREAL) = TIME
20       CONTINUE
C-->  PAOP CCKA, NNG - HOMEP PAKA
         NNG = NNG + 1
         IF ( KPP .LE. 0 ) GO TO 21
         PX = SPIS(ISPIS)
         I2 = SPIS(ISPIS+1)
C$$$$$$$ I3 = SPIS(ISPIS+2)
         GO TO (22, 23, 24), PX
         CALL SUBERR(PX)
C--->
C--->  HAPEH:
22     CONTINUE
       VI2 = 0.0
       IF ( I2 .NE. 0 ) VI2 = VALLN( I2 )
         XGRAF( NREAL + NNG*NX ) = VI2
         ISPIS = ISPIS + 6
         KPP = KPP - 1
         GO TO 20
C--->  PAHOCT
23     CONTINUE
       I3 = SPIS( ISPIS + 2 )
       VI2 = 0.0
       VI3 = 0.0
       IF ( I2 .NE. 0 ) VI2 = VALLN( I2 )
       IF ( I3 .NE. 0 ) VI3 = VALLN( I3 )
         XGRAF( NREAL + NNG*NX ) = VI2 - VI3
         ISPIS = ISPIS + 6
         KPP = KPP - 1
         GO TO 20
C--->  TOK
24       XGRAF( NREAL + NNG*NX ) = TOKN(I2)
         ISPIS = ISPIS + 6
         KPP = KPP - 1
         GO TO 20
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
21       CONTINUE
C-->  TOK PH, HEHHO  BBECT PAMEHT....
         IF ( NREAL .EQ. NX  .AND.  FRAGM .EQ. 1 ) GO TO 25
         RETURN
C######################################################################
25       CONTINUE
C--> BBO PAMEHTA
         KSY = 123
         IF ( DIAL .EQ. 1 ) KSY = 74
         NIII = NX + 1
         CALL PLOT2( XGRAF, XGRAF(NIII), NX, KP, NX, KSY, NXX,
     =               10, NWTR, MKOD )
C======================================================================
C         IF ( DIAL .EQ. 1 ) WRITE(NWTR,510)
C510      FORMAT('*** EAETE POCMOTPET EE PA? (A/HET) ***')
C         IF ( DIAL .EQ. 1 ) READ(NRDR,511) (HELP(I), I=1,80)
C         IF ( DIAL .EQ. 1 .AND. HELP(1) .EQ. YES(1) .AND.
C     =        HELP(2) .EQ. YES(2) ) GO TO 25
C======================================================================
C-->  HE HHO  OBTOPT, P MKOD = 2
         IF ( MKOD .NE. 2 ) GO TO 26
C--> OBTOP
250      WRITE(NWTR, 505 )
505      FORMAT(//' *** BBO PEX PAKOB B HBAHX',
     = ' MACTAAX ***'//)
         CALL PLOT2( XGRAF, XGRAF(NIII), NX, KP, NX, KSY, NXX,
     =                10, NWTR, 0 )
C======================================================================
C         IF ( DIAL .EQ. 1 ) WRITE(NWTR,510)
C511      FORMAT(80A1)
C         IF ( DIAL .EQ. 1 ) READ(NRDR,511) (HELP(I), I=1,80)
C         IF ( DIAL .EQ. 1 .AND. HELP(1) .EQ. YES(1) .AND.
C     =        HELP(2) .EQ. YES(2) ) GO TO 250
C======================================================================
26       CONTINUE
C-->  PAMEHT BBE
         NXT = NXT - NX
         NREAL = 0
         IF ( NXT .LE. NX1 ) GO TO 27
C--> EE HEH PAMEHT...OOTOBM EO....
         FRAGM = 1
         NX =(NX1/NXX) * NXX
         RETURN
27       CONTINUE
C-->  HAKOM OCEH PAMEHT...
         NX = NXT
         FRAGM = 0
         RETURN
C######################################################################
3        CONTINUE
C===> KOHTPO HA KO-BO TOEK...
         IF ( NREAL .LT. NX ) WRITE(NWTRE,2501) NREAL, NX, NXX
2501    FORMAT(' *** O. HECOOTBETCTB B DRGR00: - PAHHEE AKPTE BBO
     =A ***'/ ' *** NREAL =',I5,' NX =',I5, ' NXX=',I5,' ***')
C===>
C--> AKPOEM PEM...
C!!!       80  
         KSY = 74
         IF ( DIAL .EQ. 1 ) KSY = 74
         NIII = NX + 1
C!!!-------------------------------------------------------------------
C        WRITE(NWTRE,700) NREAL, NX, NIII, NXX, KP
C700     FORMAT(' ***NREAL=',I5,' NX=',I5, ' NIII=', I5,
C    =  ' NXX=',I5, ' KP=',I5,'  ***')
C        IXXX=(KP+1)*NX+10
C        WRITE(NWTRE,701) (I, XGRAF(I), I=1,IXXX)
C701     FORMAT( 5(1X,'G(', I4, ')=', G12.5 ) )
C!!!-------------------------------------------------------------------
         CALL PLOT2( XGRAF, XGRAF(NIII), NX, KP, NX, KSY, NXX,
     =                10, NWTR, MKOD)
C======================================================================
C        IF ( DIAL .EQ. 1 ) WRITE(NWTR,510)
C-->
C        IF ( DIAL .EQ. 1 ) READ(NRDR,511) (HELP(I), I=1,80)
C        IF ( DIAL .EQ. 1 .AND. HELP(1) .EQ. YES(1) .AND.
C    =        HELP(2) .EQ. YES(2) ) GO TO 3
C======================================================================
         IF ( MKOD .NE. 2 ) RETURN
2500     WRITE (NWTR, 505)
         CALL PLOT2( XGRAF, XGRAF(NIII), NX, KP, NX, KSY, NXX, 10,
     =               NWTR, 0 )
C======================================================================
C        IF ( DIAL .EQ. 1 ) WRITE(NWTR,510)
C--->
C        IF ( DIAL .EQ. 1 ) READ(NRDR,511) (HELP(I), I=1,80)
C        IF ( DIAL .EQ. 1 .AND. HELP(1) .EQ. YES(1) .AND.
C    =        HELP(2) .EQ. YES(2) ) GO TO 2500
C======================================================================
         RETURN
         END
