       SUBROUTINE FM0020(BA0T, KNOTT, PAR0T, RMSW, LM )
CXXX----KOMEKC "MS1" --> BEPC 1.1  (OT   MA   1987 .)------------
C   OPOPAMMA: FM0020(BA0T, KNOTT, PAR-T, RMSW, LM )
C   -------------
C   HAHAEHE:  HACTPOKA MAKPOMOEE HEHX HAMECKX BEHEB:
C   ----------
C              +-----+-----------------------------------------------+
C              I     I                                   I  EPEA-  I
C              I T I       HAMEHOBAHE BEHA          I  TOHA   I
C              I     I                                   I  HK  I
C              I-----I-----------------------------------I-----------I
C              I     I  POOPOHAHO-CMMPEE      I           I
C              I 310 I       (  - PETOP )           I     K     I
C              I     I                                   I           I
C              I-----I-----------------------------------I-----------I
C              I     I         HTEPPEE             I           I
C              I 311 I       (  - PETOP )           I   1/(TS)  I
C              I     I                                   I           I
C              I-----I-----------------------------------I-----------I
C              I     I                                   I           I
C              I 312 I         HEPOHHOE               I 1/(TS+1)  I
C              I     I                                   I           I
C              I-----I-----------------------------------I-----------I
C              I     I         EPEHPEE          I           I
C              I 313 I       (  - PETOP )           I TS/(TS+1) I
C              I     I                                   I           I
C              I-----I-----------------------------------I-----------I
C              I     I                                   I I*        I
C              I 319 I  EHEPATOP OOPAHOO CHAA  I I  *      I
C              I     I                                   I I    *    I
C              I-----I-----------------------------------I-----------I
C              *******************************************************
C                PHAK TIP # 4 -> O. MAKPOMOE.
C                ( DM0024, LM0007 )
C                      OPMPET "EPEMEHH" ACT RMSW OCAH
C                              T 310:==> +1(VAR)
C                      HA:  T 311:==>  7
C                              T 312:==>  7
C                              T 313:==>  7
C                              T 319:==>  7
C
C----------------------------------------------------------------------
C              EMEHT OCBAETC:
C
C       # T 310  0 
C              MAS < NBXOD  #1 #CM1 K1  #2 #CM2 K2  ... >
C              MAS < NGARM  W  A0  A1  FI1  A2  FI2... >
C
C      E
C          NBXOD  -   KOECTBO TOKOB EMEHTOB CXEM , KOTOPE
C                     COTC B KAECTBE BXOHX CHAOB;
C          #I,#CMI- HOMEP EMEHTA  HOMEP TOKA EMEHTA ,
C                     COEMOO B KAECTBE BXOHOO CHAA;
C          KI       - KOEHT POOPOHAHOCT TOKA I-TOO
C                     EMEHTA;
C          NGARM  -   KOECTBO EMEHTOB APMOHECKOO PA
C                     OCBAEO AAHH CHA, OABAEM
C                     HA BXO PETOPA (C ETOM OCT. COCTAB.);
C          W    -     ACTOTA OCHOBHO APMOHK ( 1/C );
C          A0,A1,...- AMT COOTBETBX APMOHK CHAA;
C          FI1,FI2...-HA. A COOTBETBX APMOHK CHAA;
C      ----------------------------------------------------------------
C
C       # T 311  0   #  #CM  TAU
C       # T 312  0   #  #CM  TAU
C       # T 313  0   #  #CM  TAU
C
C      E
C          # ,#CM - HOMEP EMEHTA  HOMEP TOKA EMEHTA ,
C                     COEMOO B KAECTBE BXOHOO CHAA;
C          TAU    -   OCTOHHA BPEMEH;
C----------------------------------------------------------------------
C       # T 319  0  UMAX UMIN TZ TP TI
C
C      E
C          UMAX  -MAKCMAHOE HAPEHE  CHAA
C          UMIN  -MHMAHOE  HAPEHE  CHAA
C          TZ    - HAAH   CB O AE
C          TP    - EPO  CHAA OOPAHOO
C          TI    - TEHOCT CHAA
C
C
C----------------------------------------------------------------------
C   METO:         PAMETKA OE RMSW O MOE
C   -----
C
C   APAMETP:     BA0T, KNOTT, PAR0T - "OTPEK" HOPMAOHHX
C  ----------      MACCOBOB BA0, KNOT, PAR0 ( CM. INPUT0  GETMSW );
C                  RMSW - "EPEMEHHA" ACT MSW ( "OTPEOK" MSWALL );
C                  LM - HA "EPEMEHHO" ACT RMSW P FGMSW = 0;
C                  LM - HA BCEO MSW OCAH      P FGMSW = 1;
C
C   OPOPAMM:  1.COMMON PROF1
C   ------------
C
C   PMEAHE:    1. KOHTPO B MHMAHOM O"EME;
C   -----------    2. BCE HE OPEEEME O RMSW AHTC;
C                  3. HE PBOTC OPMAT RMSW:
C
C
C              OPMAT RMSW T # 310:
C              ----------------------
C+-----------I--------------I------I-----------------------------------
C  # COBA   I    # COBA B I KTO  I
C OT HAAA  I    OTPEKE   IOPE.I
C BCEO MSW  I    RMSW B    I      I       OOHAEHE - HAEHE
C OCAH   I    FM0020    I      I
C------------I--------------I------I-----------------------------------
C     9      I     0        I      I HOMEP A ( BCEA 0 )
C----------------------------------------------------------------------
C    10      I     1        I  DM  I  FQ - A HOBE HA. BCEH
C            I              I      I   (  CHXPO. MAKPO. P.TIP # 4 )
C    11      I     2        I  FM  I  NBXOD-KOECTBO TOKOB, CO-
C            I              I      I        EMX KAK BXOHE CHA;
C    12      I     3        I  FM  I  #1 - HOMEP EMEHTA;
C    13      I     4        I  FM  I  #CM1 - HOMEP TOKA EMEHTA #1;
C    14      I     5        I  FM  I  K1   - KOEHT POOPOHA-
C            I              I      I         HOCT TOKA #CM1 -TA #1;
C    15      I     6        I  LM  I  ATOKM1 - AP B TOKN/N1 HAEH
C            I              I      I           TOKA HOMEP #CM1
C            I              I      I           EMEHTA #1;
C  8+I*4     I  -1+I*4      I  FM  I  #I -      -"-
C  9+I*4     I     I*4      I  FM  I  #CMI -      -"-
C 10+I*4     I   1+I*4      I  FM  I  KI   -      -"-
C 11+I*4     I   2+I*4      I  LM  I  ATOKMI -    -"-
C .......    I   .......    I  ... I  ..........................
C12+NBXOD*4  I  3+NBXOD*4   I  FM  I  NGARM -KOECTBO APMOHK, C.
C            I              I      I          OCAH A. CHAA
C            I              I      I         (C ETOM OCT. COCTAB.);
C 13+NBXOD*4 I  4+NBXOD*4   I  FM  I  W  -   ACTOTA OCH. APMOHK(1/C)
C 14+NBXOD*4 I  5+NBXOD*4   I  FM  I  A0  -  AMTA OCT. COCTAB-
C            I              I      I         E A. CHAA;
C 15+NBXOD*4 I  6+NBXOD*4   I  FM  I  A1  -  AMTA 1-O APMOHK
C            I              I      I         AAHHOO CHAA;
C 16+NBXOD*4 I  7+NBXOD*4   I  FM  I  FI1 -  HA. AA 1-O APMOHK;
C 17+NBXOD*4 I  8+NBXOD*4   I  FM  I  A2  -  AMTA 2-O APMOHK;
C 18+NBXOD*4 I  9+NBXOD*4   I  FM  I  FI2 -  HA. AA 2-O APMOHK;
C .......    I   .......    I  ... I  ..........................
C----------------------------------------------------------------------
C
C  OA HA MSW --> LM<BC> = 12 + 4*NBXOD + 2*NGARM
C
C  HA EPEMEH. ACT --> LM<RMSW> = 3 + 4*NBXOD + 2*NGARM
C
C----------------------------------------------------------------------
C
C              OPMAT RMSW T # 311,312,313:
C              ------------------------------
C+-----------I--------------I------I-----------------------------------
C  # COBA   I    # COBA B I KTO  I
C OT HAAA  I    OTPEKE   IOPE.I
C BCEO MSW  I    RMSW B    I      I       OOHAEHE - HAEHE
C OCAH   I    FM0020    I      I
C------------I--------------I------I-----------------------------------
C     9      I     0        I      I HOMEP A ( BCEA 0 )
C----------------------------------------------------------------------
C    10      I     1        I  DM  I  FQ - A HOBE HA. BCEH
C            I              I      I   (  CHXPO. MAKPO. P.TIP # 4 )
C    11      I     2        I  FM  I         PEEPB
C            I              I      I
C    12      I     3        I  FM  I  #  - HOMEP EMEHTA;
C    13      I     4        I  FM  I  #CM  - HOMEP TOKA EMEHTA #1;
C    14      I     5        I  LM  I  ATOKM  - AP B TOKN/N1 HAEH
C            I              I      I           TOKA HOMEP #CM
C            I              I      I           EMEHTA #;
C    15      I     6        I  FM  I  TAU  - OCTOHHA BPEMEH;
C    16      I     7        I  FM  I          PEEPB
C----------------------------------------------------------------------
C
C              OPMAT RMSW T # 319
C              ------------------------------
C+-----------I--------------I------I-----------------------------------
C  # COBA   I    # COBA B I KTO  I
C OT HAAA  I    OTPEKE   IOPE.I
C BCEO MSW  I    RMSW B    I      I       OOHAEHE - HAEHE
C OCAH   I    FM0020    I      I
C------------I--------------I------I-----------------------------------
C     9      I     0        I      I HOMEP A ( BCEA 0 )
C----------------------------------------------------------------------
C    10      I     1        I  DM  I  FQ - A HOBE HA. BCEH
C            I              I      I   (  CHXPO. MAKPO. P.TIP # 4 )
C    11      I     2        I  FM  I         PEEPB
C            I              I      I
C    12      I     3        I  FM  I  UMAX - MAK. HAPEHE
C    13      I     4        I  FM  I  UMIN - MH. HAPEHE
C    14      I     5        I  LM  I  TZ   - CB O AE
C    15      I     6        I  FM  I  TP   - EPO CHAA
C    16      I     7        I  FM  I  TI   - TEHOCT CHAA
C----------------------------------------------------------------------
C  OA HA MSW --> LM<BC> = 16
C
C  HA EPEMEH. ACT --> LM<RMSW> = 7
C
CZZZ-------------------------------------------------------------------
       COMMON /PROF1/ MASPRT(100)
       DIMENSION BA0T(*), KNOTT(*), PAR0T(*), RMSW(*)
       EQUIVALENCE( NWTR, MASPRT(13) )
       EQUIVALENCE( NWTRE, MASPRT(14) )
       EQUIVALENCE( FGMSW, MASPRT(87) )
       EQUIVALENCE ( RN  ,   N  )
       INTEGER  TIP, BA0T, FGMSW
       NEL = BA0T(1)
       TIP = BA0T(2)
       NTIP= TIP - 309
       IF ( NTIP .EQ. 10 ) GO TO 300
       IF ( NTIP .GE. 1 .AND. NTIP .LE. 4 ) GO TO 1
C!!!-------------------------------------------------------------------
       WRITE(NWTRE, 501 ) NEL, TIP
501    FORMAT(/' *** O. CO B FM0020 --> HOMEP TA HE HA ***'/
     =  ' *** HOMEP EMEHTA ', I5, ' HOMEP TA ', I5, ' ***'/)
C!!!-------------------------------------------------------------------
       CALL SUBERR(TIP)
C######################################################################
1      CONTINUE
       GO TO (100,200,200,200),NTIP
C----------------------------------------------------------------------
C---> POOPOHAHO CMMPEE BEHO ( T  # 310 )
C----------------------------------------------------------------------
100   CONTINUE
C--> OPEEEHE KOHCTAHT
       NBXOD = 0
       IF( PAR0T(2) .GT. 0.0 ) NBXOD = IFIX ( PAR0T(2) )
       INGARM = 4 + 3*NBXOD
       NGARM  = 0
       IF( PAR0T(INGARM) .GT. 0.0 ) NGARM = IFIX ( PAR0T(INGARM) )
       IF ( FGMSW .EQ. 0 ) GO TO 1000
C----------------------------------------------------------------------
C-->  TOHT LM <O >
       LM = 12 + 4*NBXOD + 2*NGARM
       RETURN
C######################################################################
1000   CONTINUE
C-->  PHT  TO MOHO COPMPOBAT..
       LM = 3 + 4*NBXOD + 2*NGARM
       DO 2 I=1,LM
2      RMSW(I) = 0.0
C---> POBEPM  PABHO  BBEEH AHHE?
       NBXOD1 = (IFIX ( PAR0T(1) ) - 1 ) / 3
       IF ( NBXOD .EQ. NBXOD1 ) GO TO 3
C!!!-------------------------------------------------------------------
       WRITE(NWTRE, 502 ) NEL, TIP
502    FORMAT(/' *** OKA B FM0020 -->HEPABHO AAHO KOECTBO BX
     =OOB***'/' *** HOMEP EMEHTA ', I5, ' HOMEP TA ', I5, ' ***'/)
C!!!-------------------------------------------------------------------
       CALL SUBERR(TIP)
3      CONTINUE
       NGARM1 = (IFIX( PAR0T(INGARM-1) ) - 1) / 2
       IF ( NGARM .EQ. NGARM1 ) GO TO 4
C!!!-------------------------------------------------------------------
       WRITE(NWTRE, 503 ) NEL, TIP
503    FORMAT(/' *** OKA B FM0020 -->HEPABHO AAHO KO-BO APMOH
     =K  ***'/' *** HOMEP EMEHTA ', I5, ' HOMEP TA ', I5, ' ***'/)
C!!!-------------------------------------------------------------------
       CALL SUBERR(TIP)
4      CONTINUE
C----------------------------------------------------------------------
C---->  AOMHM HOMEPA TOKOB, BXC BXOHM CHAAM  ---------
       N = NBXOD
       RMSW(2) = RN
       IPAR0T = 2
       IRMSW = 2
       IF( NBXOD .EQ. 0 ) GO TO 50000
          DO 5 I = 1 , NBXOD
          IPAR0T = IPAR0T + 1
          IRMSW = IRMSW + 1
          NELBX = IFIX ( PAR0T(IPAR0T) )
          IF( NELBX .GT. NEL ) GO TO 9999
          N = NELBX
          RMSW(IRMSW) = RN
          IPAR0T = IPAR0T + 1
          IRMSW = IRMSW + 1
          N = IFIX ( PAR0T(IPAR0T) )
          RMSW(IRMSW) = RN
          IPAR0T = IPAR0T + 1
          IRMSW = IRMSW + 1
          RMSW(IRMSW) =  PAR0T(IPAR0T)
          IRMSW = IRMSW + 1
5      CONTINUE
50000  CONTINUE
C----------------------------------------------------------------------
C---->  AOMHM AMT  A APMOHK ----------------------------
       IPAR0T = IPAR0T + 2
       IRMSW = IRMSW + 1
       N = NGARM
       RMSW(IRMSW) = RN
       IF( NGARM .EQ. 0 ) GO TO 60000
       IPAR0T = IPAR0T + 1
       IRMSW = IRMSW + 1
       RMSW(IRMSW) = PAR0T(IPAR0T)
       IPAR0T = IPAR0T + 1
       IRMSW = IRMSW + 1
       RMSW(IRMSW) = PAR0T(IPAR0T)
       I1 = NGARM-1
       IF( I1 .LT. 1 ) GO TO 60000
          DO 6 I = 1 , I1
          IPAR0T = IPAR0T + 1
          IRMSW = IRMSW + 1
          RMSW(IRMSW) = PAR0T(IPAR0T)
          IPAR0T = IPAR0T + 1
          IRMSW = IRMSW + 1
          RMSW(IRMSW) = PAR0T(IPAR0T) * 3.1416 / 180.
6      CONTINUE
60000  CONTINUE
       RETURN
C======================================================================
C----------------------------------------------------------------------
C---> HTEPPEE     BEHO ( T  # 311 )
C---> HEPOHHOE       BEHO ( T  # 312 )
C---> EPEHPEE  BEHO ( T  # 313 )
C----------------------------------------------------------------------
200    CONTINUE
       IF ( FGMSW .EQ. 0 ) GO TO 1001
C----------------------------------------------------------------------
C-->  TOHT LM <O >
       LM = 16
       RETURN
C######################################################################
1001   CONTINUE
C-->  PHT  TO MOHO COPMPOBAT..
       LM = 7
       DO 7 I=1,LM
7      RMSW(I) = 0.0
C----------------------------------------------------------------------
C---> AOMHM AHHE  ------------------------------------------------
       NELBX = IFIX( PAR0T(1) )
       IF( NELBX .GT. NEL ) GO TO 9999
       N = NELBX
       RMSW(3) = RN
       N = IFIX( PAR0T(2) )
       RMSW(4) = RN
       RMSW(6) = PAR0T(3)
C----------------------------------------------------------------------
C---> POBEPM, PABHO  BBEEH AHHE?
       IF( PAR0T(3) .GT. 0. ) RETURN
C!!!-------------------------------------------------------------------
       WRITE(NWTRE, 505 ) NEL, TIP
505    FORMAT(/' *** OKA B FM0020 -->HEPABHO AAHA OCTOHHA BP
     =EMEH ***'/' ***  EMEHT ', I5, ' HOMEP TA ', I5,' ***'/
     =           ' *** BCEH PEKPAATC              ***')
C!!!-------------------------------------------------------------------
       CALL SUBERR(TIP)
C----------------------------------------------------------------------
       RETURN
C######################################################################
C----------------------------------------------------------------------
C  EHEPATOP OOPAHOO CHAA   ( T # 319 )
C----------------------------------------------------------------------
300    CONTINUE
       IF ( FGMSW .EQ. 0 ) GO TO 2001
C----------------------------------------------------------------------
C-->  TOHT LM <O >
       LM = 16
       RETURN
C######################################################################
2001   CONTINUE
C-->  PHT  TO MOHO COPMPOBAT..
       LM = 7
       DO 9 I=1,LM
9      RMSW(I) = 0.0
C----------------------------------------------------------------------
C---> AOMHM AHHE  ------------------------------------------------
       DO 10 I = 1,5
       RMSW(2+I) = PAR0T(I)
 10    CONTINUE
C----------------------------------------------------------------------
C---> POBEPM, PABHO  BBEEH AHHE?
       IF( PAR0T(4) .GT. 0..AND.PAR0T(5).GT.0. ) RETURN
C!!!-------------------------------------------------------------------
       WRITE(NWTRE, 507 ) NEL, TIP
507    FORMAT(/' *** OKA B FM0020 -->HEPABHO AAHA OCTOHHA BP
     =EMEH ***'/' ***  EMEHT ', I5, ' HOMEP TA ', I5,' ***'/
     =           ' *** BCEH PEKPAATC              ***')
C!!!-------------------------------------------------------------------
       CALL SUBERR(TIP)
C----------------------------------------------------------------------
       RETURN
C######################################################################
9999   CONTINUE
C!!!-------------------------------------------------------------------
       WRITE(NWTRE, 504 ) NEL, TIP,NELBX
504    FORMAT(/' *** OKA B FM0020 -->HEPABHO AAH BXOHE AHH
     =E   ***'/' *** HA BXO EMEHTA ', I5, ' HOMEP TA ', I5,' ***',
     =         ' *** OAETC TOK EMEHTA, MEEO O OPKOB
     =HOMEP ( # ' ,I3,' )  *** ')
C!!!-------------------------------------------------------------------
       CALL SUBERR(TIP)
C######################################################################
       RETURN
       END
