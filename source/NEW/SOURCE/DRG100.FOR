         SUBROUTINE DRG100(KOD, KSX, SPIS, TIME,TOKN,VALLN,NDX,XGRAF)
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)------------
C   OPOPAMMA:   DRG100(KOD, KSX, SPIS, TIME,TOKN,VALLN,NDX,XGRAF)
C   ------------
C   HAHAEHE:    COHTEH "MEXAHM" BBOA "PAECKO"
C   ----------     HOPMA PEKTB #PA1;
C
C   METO:         OEBEH;
C   -----          (EC P APOCE HAKOEH TOEK BBOA PEAAT
C                  PHT OE TOEK, EM AAHO B NTGRAF P KOD=1,
C                  TO TOHE TOK HOPPTC...)
C
C   APAMETP:     KOD = 1 - OTKPT PEM TOEK BBOA;
C   ---------          = 2 - PHT OEPEH TOK;
C                      = 3 - AKPT PEM TOEK, EATAT HA NWTR;
C                  KSX - KOECTBO CTPOK O OC "X" PAKA;
C                  SPIS - CCOK "APOC BBOA";
C                  TIME, TOKN, VALLN - MACCB HAEH OEPEHO TOK;
C                  NDX - PAMEPHOCT - PAOEO MACCBA XGRAF;
C                  XGRAF - PAO MACCB, MAX PAMEPHOCT
C                        2 * <KO-BO TOEK OCTPOEH PAKA, NTGRAF>
C                         ( CM. PMEAHE );
C
C   OPOPAMM:  1. PLOMXY,  MOVE0
C   ------------   2. COMMON PROF1, SERVZ2, SERVZ3;
C
C   PMEAHE:    1. KOHTPO HE PBOTC;
C                  2. KOECTBA TOEK BBOA BPAETC 
C                     MASPRT(47) = NTGRAF
C                  3. P MAOM PAMEPE MACCB XGRAF:
C                     KOA NTGRAF > NDX, OCECTBETC
C                     OPAHEHE NTGRAF = NDX --> E COOEH
C                  4. "CETKA" O "X" OC CTAHABBAETC PABHO 10;
C
C
CZZZ-------------------------------------------------------------------
         DIMENSION SPIS(1), TOKN(1), VALLN(1), XGRAF(1)
         INTEGER SPIS, FRAGM, ANM, ANT, TABTOK, TABTIP, TIP
         COMMON/PROF1/ MASPRT(80)
         COMMON/SERVZ2/ TABTOK(1)
         COMMON /SERVZ3/ TABTIP(1)
         INTEGER HELP, DIAL, PX
         DIMENSION HELP(80), RHELP(1)
         EQUIVALENCE ( HELP(1),  RHELP(1) )
         EQUIVALENCE ( NRDR,     MASPRT(12) )
         INTEGER YES, NO
         DIMENSION YES(2), NO(3)
         DIMENSION OSXY(4)
         INTEGER OSXY
         EQUIVALENCE ( NWTR, MASPRT(13) )
         EQUIVALENCE ( NWTRE, MASPRT(14) )
         EQUIVALENCE ( DIAL,  MASPRT(15) )
         EQUIVALENCE ( NTGRAF,  MASPRT(47) )
         EQUIVALENCE ( HOUTT,   MASPRT(48) )
         EQUIVALENCE ( XGRGAD,  MASPRT(63) )
C
         DATA OSXY / ' OC', ' X  ',  ' OC', ' Y  ' /
         DATA YES/'', 'A' /, NO / 'H', 'E', 'T' /
C**********************************************************************
         KP = SPIS(1)
         IF ( KP .NE. 2 ) CALL SUBERR(KP)
         GO TO (1,2,3), KOD
         CALL SUBERR(KOD)
1        CONTINUE
C--->  OTKPT OCT
C-->  CETKA O "X"
         NXX = 10
C-->  KAATE "OC"
         IOSXY = 1
         IOSXY1 = 2
C->> CKOKO MAX TOEK MOEM BBECT A OH "AXO"
         NX1 = NDX/2
C---> HO HAM HAO BBOT NTX TOEK:
         NTX = NTGRAF
C      NREAL - C..K. PHTX TOEK
C-->  EC OKA, OPAHMC........
         IF ( NTX .GT. NX1 ) NTX = NX1
         NX = NTX
C        *********
         NREAL = 0
C--->  BBO AOOBKA...
         WRITE(NWTR,12)
12       FORMAT(1H1/20X,' PAK APAMETPECKO ABCMOCT '/)
         ISPIS = 2
         IHELP = 1
         KPP = KP
         NNG = 0
13       CONTINUE
         IF ( KPP .LE. 0 ) GO TO 14
         NNG = NNG + 1
         PX = SPIS(ISPIS)
         GO TO ( 15, 16, 17 ), PX
         CALL SUBERR(PX)
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
15       CONTINUE
C--->  HAPEH
         NV = SPIS(ISPIS+1)
         WRITE(NWTR, 502) ( OSXY(II), II=IOSXY,IOSXY1), NNG, NV
502      FORMAT(1X, 2A4,      I2, ' - ', 'HAPEHE A ', I5, ' ;')
         KPP = KPP -1
         ISPIS = ISPIS + 6
         IOSXY = 3
         IOSXY1 = 4
         GO TO 13
16       CONTINUE
C-->  PAHOCT
         NV = SPIS(ISPIS+1)
         NV1 = SPIS(ISPIS+2)
         WRITE(NWTR,503) ( OSXY(II), II=IOSXY, IOSXY1), NNG, NV, NV1
503      FORMAT(1X,  2A4,     I2, ' - ', 'HAPEHE ME AM ',
     =  I5, '  ', I5, ' ;' )
         KPP = KPP - 1
         ISPIS = ISPIS + 6
         IOSXY = 3
         IOSXY1 = 4
         GO TO 13
17       CONTINUE
C---> TOK
         NEL = SPIS(ISPIS + 2)
         ANM = SPIS(ISPIS+3)
         ANT = SPIS(ISPIS+4)
         NSM = SPIS(ISPIS+5)
         IHELP = 1
         HELP(IHELP) = NNG
         IHELP = IHELP + 1
         CALL MOVE0( HELP(IHELP), TABTOK(ANT), 3 )
         IHELP = IHELP + 3
         HELP(IHELP) = NEL
         IHELP = IHELP + 1
         HELP(IHELP) = NSM
         IHELP = IHELP + 1
         CALL MOVE0( HELP(IHELP), TABTIP(ANM), 5 )
         IHELP = IHELP + 4
         WRITE(NWTR, 504) (OSXY(II), II= IOSXY, IOSXY1),
     =                    NNG,(HELP(I), I=2,4),NEL,NSM,(HELP(I),I=7,11)
504      FORMAT(1X,2A4,        I2, ' - ',3A4, ' --> ', 'EMEHT ', I5,
     =        ' HAEHE ', I3, ' (', 5A4, ');'  )
         KPP = KPP - 1
         ISPIS = ISPIS + 6
         IOSXY = 3
         IOSXY1 = 4
         GO TO 13
14       CONTINUE
C-->  "CE..."
       WRITE(NWTR,5040 )
5040   FORMAT( / )
         RETURN
C######################################################################
2        CONTINUE
C-->  PHT OEPEH, NX  OTOBO...
         NREAL = NREAL + 1
C--->  BOMOHO := PEAAT H TOK ??, EC A, TO HOPTPEM!
         IF ( NREAL .GT. NX ) RETURN
         NNG = 1
         ISPIS = 2
         KPP = KP
C
20       CONTINUE
C-->  PAOP CCKA, NNG - PHAK OC-->  =1 -> "X",  =0 --> "Y"
C-->  PAOP COACHO POPTETAM-->  (CM. DRG1F0 )
         IF ( KPP .LE. 0 ) GO TO 21
         PX = SPIS(ISPIS)
         I2 = SPIS(ISPIS+1)
C$$$$$$  I3 = SPIS(ISPIS+2)
         GO TO (22, 23, 24), PX
         CALL SUBERR(PX)
C--->
C--->  HAPEH:
22     CONTINUE
       VI2 = 0.0
       IF ( I2 .NE. 0 ) VI2 = VALLN( I2 )
         XGRAF( 2*NREAL - NNG ) = VI2
         ISPIS = ISPIS + 6
         KPP = KPP - 1
         NNG = 0
         GO TO 20
C--->  PAHOCT
23     CONTINUE
       I3 = SPIS( ISPIS + 2 )
       VI2 = 0.0
       VI3 = 0.0
       IF ( I2 .NE. 0 ) VI2 = VALLN( I2 )
       IF ( I3 .NE. 0 ) VI3 = VALLN( I3 )
         XGRAF( 2*NREAL - NNG ) = VI2 - VI3
         ISPIS = ISPIS + 6
         KPP = KPP - 1
         NNG = 0
         GO TO 20
C--->  TOK
24       XGRAF( 2*NREAL - NNG ) = TOKN(I2)
         ISPIS = ISPIS + 6
         KPP = KPP - 1
         NNG = 0
         GO TO 20
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
21       CONTINUE
C**********************************************************************
C**********************************************************************
         RETURN
C######################################################################
3        CONTINUE
C===> KOHTPO HA KO-BO TOEK...
         IF ( NREAL .LT. NX ) WRITE(NWTRE,2501) NREAL, NX
2501    FORMAT(' *** O. HECOOTBETCTB B DRG100: - PAHHEE AKPTE BBO
     =A ***'/ ' *** NREAL =',I5,' NX =',I5,            ' ***')
C===>
         IXXI = 0
301      CONTINUE
C--> AKPOEM PEM...
C!!!     80 
         KSY = 74
         IF ( DIAL .EQ. 1 ) KSY = 74
         CALL PLOMXY( XGRAF,              NX,    KSX, KSY, 10,
     =                10, NWTR, XGRAF, IXXI )
C======================================================================
         IF ( DIAL .EQ. 1 ) WRITE(NWTR,510)
C-->
         IF ( DIAL .EQ. 1 ) READ(NRDR,511) (HELP(I), I=1,80)
         IF ( DIAL .EQ. 1 .AND. HELP(1) .EQ. YES(1) .AND.
     =        HELP(2) .EQ. YES(2) ) GO TO 300
         RETURN
300      CONTINUE
         IXXI = -1
         GO TO 301
C======================================================================
510      FORMAT(' *** EAETE OCMOTPET EE PA ? (A/HET) ***')
511      FORMAT(80A1)
C--->
         END
