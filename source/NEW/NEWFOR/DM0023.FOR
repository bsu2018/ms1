         SUBROUTINE DM0023 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                       MSWALL, RMSWAL, ADRMSW )
CXXX----KOMEKC "MS1" --> BEPC 1.1  (OT   MA   1987 .)------------
C   OPOPAMMA:  DM0023 ( MSW, RMSW, YALL, JALL, LOGYTR
C  -------------             TOKN, TOKN1, VALLN, VALLN1, KOD,
C                            MSWALL, RMSWAL, ADRMSW )
C
C   HAHAEHE:    B ABCMOCT OT HAEH AA ZAPROS [MASPRT(28)]:
C   -----------    BOHET CEE HK:
C
C                  MOE #301--> CCTEMA MCHO-AOBOO PABEH
C                                    ( C )
C
C
C              EMEHT OCBAETC:
C
C       # T 301  0 
C              MAS < NTOKOB  #1 #CM1  #2 #CM2 ... >
C              MAS < NHAP   EN1 EK1  EN2 EK2 ... >
C              PSUB #P < .........>;
C
C              EPE AAPAT PSUB AATC AKOH PABEH ;
C
C      E
C          NTOKOB -   KOECTBO TOKOB EMEHTOB CXEM , KOTOPE
C                     COTC P PACETE CHAOB PABEH(C);
C          #I , #CMI     - HOMEP EMEHTA  HOMEP TOKA EMEHTA ,
C                            COEMOO P PACETE C;
C          NHAP           - KOECTBO HAPEH ME AM CXEM ,
C                            COEMX P PACETE C;
C          ENI , EKI - HOMEPA OB , HAPEH ME KOTOPM
C                            COTC P PACETE C;
C          #P              - HOMEP / OOBATE ( PSUB#P ) ,
C                            B KOTOPO POBOTC PACET C;
C
C
C                  A) ZAPROS = 1
C                  -------------
C                    CPOC AA FQ - BEH P. APAM. OPEEEH;
C                  === H EO HE PACTBAEM ==
C
C                  B) ZAPROS = 2
C                     ----------
C                      == B CAE HEBOO HAEH AA FQ -->
C                  BCEHE
C
C
C              FQ - PACET P. HAPEH BOHEH -->
C                  MEXAHM TOO AA OBOET CHXPOHPOBAT
C                  BOHEH PAHX DM_MOHTOPOB C .TA # 4;
C
C                  AKOH PABEH --> EPE OPOPAMM OOBATE
C
C
C                  C) ZAPROS = 3
C                     **********
C                     HE OEPBAETC ( PEEPB );
C
C                  D) ZAPROS = 4
C                     **********
C                     HE OEPBAETC;
C
C   METO:     OPEEEHE CHAOB PABEH O AAHHOM AKOH
C   -----      B ABCMOCT OT TOKOB  HAPEH EMEHTOB CXEM
C
C   APAMETP:     MSW, RMSW - PABEE COBO COCTOH MAKPOMOE
C   ---------      ( "OTPEOK" MACCB MSWALL -> C.M. / GETMSW );
C                  YALL - MATPA P0BOMOCT AHAPEMO E;
C                  JALL - BEKTOP CTOHKOB TOKA AHAPEMO E;
C                  VALLN - BEKTOP OBX HAPEH AHAPEMO E:
C                          B T = TN;
C                  VALLN1- BEKTOP OBX HAPEH AHAPEMO E:
C                          B T = TN + H0;
C                  TOKN    TOKN1  -  HAEH "TOKOB" P T :=
C                                     TN    TN + H0;
C                                   PAMEPHOCT CM. MASPRT(46)=NNTOK;
C                  LOGYTR - BEKTOP PHAKOB K.. OB:
C                  COETC B MAKPOMOEX C PHAKOM TA = 5;
C                  PAMEPHOC MACCBOB P "ALL" OPEETC:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKA_PAMEPHOCT ---> NSYS = MASPRT(26)
C                  KOD - APAMETP OPATHO CB C MOHTOPOM DM....
C                   ( =1 P OO OK. OPEHOCT );
C                 MSWALL( (RMSWAL ) - BEC CCOK MSW_ALL,
C                 ADRMSW - APEC TEK. COAB MSW ( RMSW );
C
C
C   OPOPAMM:  1. COMMON PROF1, PROF2, PROF3;
C   ------------      DEPOST, CALL_PS --> B.  PSUB /;
C
C   PMEAHE:  1.CTPKTP MSW COBA MAKPOMOE AHHOO TA CM. HE
C   ----------   2. P ZAPROS ^=   1  2 - COOEHE  XO;
C
C
C               "OCTOHHA" ACT MSW TA # 301:
C                ---------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I PHAKI KO I KO. IAP.   IPE I
C  I EME I TA   I /    I TA   I ECT I BB. IHA.   IE I
C  I HTA   I MOE I PACETAI MOE I BO   I HA I"TOKN" IPB I
C  I       I        I DM.....I       .I OBI EH.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I  7    I 8 I
C  +-------+--------+--------+--------+------+------+-------+---+
C
C              OPMAT RMSW T # 301:
C              ----------------------
C
C+-----------I--------------I------I-----------------------------------
C  # COBA   I    # COBA B I KTO  I
C OT HAAA  I    OTPEKE   IOPE.I
C BCEO MSW  I    RMSW B    I      I       OOHAEHE - HAEHE
C OCAH   I    FM0019    I      I
C------------I--------------I------I-----------------------------------
C     9      I     0        I      I HOMEP A ( BCEA 0 )
C----------------------------------------------------------------------
C    10      I     1        I  DM  I  FQ - A HOBE HA. BCEH
C            I              I      I   (  CHXPO. MAKPO. P.TIP # 4 )
C    11      I     2        I  FM  I  NTOKOB -KOECTBO TOKOB, CO-
C            I              I      I          EMX P PACETE C;
C    12      I     3        I  FM  I  #1 - HOMEP EMEHTA;
C    13      I     4        I  FM  I  #CM1 - HOMEP TOKA EMEHTA #1;
C    14      I     5        I  LM  I  ATOKM1 - AP B TOKN/N1 HAEH
C            I              I      I           TOKA HOMEP #CM1
C            I              I      I           EMEHTA #1;
C  9+I*3     I     I*3      I  FM  I  #I -      -"-
C 10+I*3     I   1+I*3      I  FM  I  #CMI -      -"-
C 11+I*3     I   2+I*3      I  LM  I  ATOKMI -    -"-
C .......    I   .......    I  ... I  ..........................
C12+NTOKOB*3 I  3+NTOKOB*3  I  FM  I  NHAP -KOECTBO HAPEH,
C            I              I      I         C.  PACETA C;
C13+NTOKOB*3 I  4+NTOKOB*3  I  FM  I  EN1 -E HAAA HAPEH;
C14+NTOKOB*3 I  5+NTOKOB*3  I  FM  I  EK1 -E KOHA  HAPEH;
C .........  I ............ I .... I  ...........................
C            I              I      I
C13+NTOKOB*3+I 3+NTOKOB*3+  I      I  NPSUB - HOMEP / OOBATE
C NHAP*2    I  NHAP*2     I  FM  I         ( PSUB ) B KOTOPO PO-
C            I              I      I         BOTC PACET C;
C (...)+1    I  (...)+1     I  FM  I  NPAR - KOECTBO APAMETPOB PSUB;
C            I              I      I
C OT(...)+2  I OT(...)+2    I  FM  I  APAMETP PSUB , AAHHE
CO(...)+NPARI O(...)+NPAR I      I  OOBATEEM C BOCEM
C  + 8       I   + 8        I      I  EMEHTOB (HA BCK CA)
C----------------------------------------------------------------------
C
C     B MACCBE TOKN  TOKN1 COEPTC:
C     **********************************
C    OT 1 O 6   - HAEH MCIU;
C                  MCIU = 00  --> "C" HET B [TN, TN+H0];
C                                  HX = 0.0;
C                  MCIU = 01  --> B [TN, TN+H0] -> EPEH POHT
C                                 MCA "C", HX = HTEPBA OT
C                                 TN O EPEHEO POHTA "C";
C                  MCIU = 10 -->  B [TN, TN+H0] -> AH POHT
C                                 MCA "C", HX = HTEPBA
C                                 OT TN O AHEO POHTA MCA  ;
C                  MCIU = 11 -->  B [TN, TN+H0] "C" BKEH,
C                                 COCTOHE HE MEH, HX=0.0;
C    OT 7 O 12  - HAEH HX
C          
C            13  -  = 1.0 -->    ᮢ ࠢ   
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         DIMENSION MSWALL(*), RMSWAL(*)
c??????? DIMENSION INTMAS(1), STMAS(100), DGMAS(12)
         DIMENSION INTMAS(10), STMAS(100), DGMAS(12)
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
         INTEGER ADRMSW
         REAL JALL, JNEL, MAXITR,INTMAS
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( NNTOK,  MASPRT(46) )
         EQUIVALENCE ( NSYS,   MASPRT(26) )
         EQUIVALENCE ( NWTRE,  MASPRT(14) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( FITER,  MASPRT(65) )
         EQUIVALENCE ( EITER,  MASPRT(67) )
         EQUIVALENCE ( NLITER, MASPRT(79) )
         EQUIVALENCE ( MAXITR, MASPRT(80) )
         EQUIVALENCE ( NSITER, MASPRT(88) )
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         INTEGER FITER, TIP, ZAPROS
       KOD = 0
C**********************************************************************
       TIP = MSW(2)
       IF ( TIP .EQ. 301 ) GO TO 9900
C######################################################################
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** O. CO B DM0023 - APOC HA OCBAHE O
     =O TA ***'/
     =    ' *** EMEHT # ', I10, ' T MOE # ', I10, ' ***'//)
         CALL SUBERR(0)
C######################################################################
9900   CONTINUE
C--->  BOP PEMA APOCA..
6666   GO TO( 100, 200), ZAPROS
C----------------------------------------------------------------------
C===> HAE OKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHTOP #', I4, ' APOC OCBAH OOEH
     = ***'/ ' *** ZAPROS = ', I5, ' - HOPPETC ***')
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C---- ZAPROS = 1 ------------------------------------------------------
100    CONTINUE
C==> CPOC AA       OCHOBHO PACET BOHEH;
       MSW(10) = 0
       RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C-----ZAPROS = 2 ------------------------------------------------------
200    CONTINUE
C-->  HHO  PAOTAT ?
       IF ( MSW(10) .EQ. 1 ) RETURN
C----------------------------------------------------------------------
C-->  PETC .............................
C-->  ZAPROS = 2 --> PACTAT HAEH....
       STMAS( 1) = TN
       STMAS( 2) = H0
       ISTMAS = 1
C----------------------------------------------------------------------
C--> EPEAEM TOK
       NTOKOB = MSW(11)
       IF( NTOKOB .EQ. 0 ) GO TO 16
          DO 15 I= 1,NTOKOB
          ISTMAS = ISTMAS + 2
          ITOKN = MSW( 3*I + 11 )
          STMAS(ISTMAS) = TOKN(ITOKN)
          STMAS(ISTMAS+1) = TOKN1(ITOKN)
15     CONTINUE
16     CONTINUE
C----------------------------------------------------------------------
C--> EPEAEM HAPEH
C----------------------------------------------------------------------
       NNAPR = MSW (12 + 3*NTOKOB )
       IF( NNAPR .EQ. 0 ) GO TO 18
       IMSWV = 11 + 3*NTOKOB
          DO 17 I= 1,NNAPR
          ISTMAS = ISTMAS + 2
          IMSWV = IMSWV + 2
          NA = MSW( IMSWV )
          KO = MSW( IMSWV + 1 )
          VNA = 0.0
          IF( NA .GT. 0 ) VNA = VALLN(NA)
          VNA1= 0.0
          IF( NA .GT. 0 ) VNA1= VALLN1(NA)
          VKO = 0.0
          IF( KO .GT. 0 ) VKO = VALLN(KO)
          VKO1= 0.0
          IF( KO .GT. 0 ) VKO1= VALLN1(KO)
          STMAS(ISTMAS) = VNA - VKO
          STMAS(ISTMAS+1) = VNA1 - VKO1
17     CONTINUE
18     CONTINUE
C----------------------------------------------------------------------
C-->  URMAS <--> MSW(14 + 3*NTOKOB + 2*NNAPR)
C----------------------------------------------------------------------
       INPSUB = 13 + 3*NTOKOB + 2*NNAPR
       NPSUB = MSW(INPSUB)
       NEL = MSW(1)
C----------------------------------------------------------------------
C--> PACTBAEM C
C----------------------------------------------------------------------
       CALL CALLPS( NPSUB, NEL, RMSW(INPSUB+1), STMAS, DGMAS, INTMAS )
C----------------------------------------------------------------------
C -->  AC B TOKN1
C----------------------------------------------------------------------
       ITOK = MSW(7)
          DO 25 I= 1 , 12
          TOKN1( ITOK + I - 1 ) = DGMAS( I )
25     CONTINUE
          TOKN1( ITOK + 12 ) = RMSW( INPSUB + 8 )  
C----------------------------------------------------------------------
C-->  AKCP. KOHE BCEH       ( FQ A )
       MSW(10) = 1
       RETURN
       END
