         SUBROUTINE DM0029 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                         MSWALL, RMSWAL, ADRMSW )
CXXX----KOMEKC "MS1" --> BEPC 1.1  (OT EKAP 1987 .)------------
C   OPOPAMMA:  DM0029 ( MSW, RMSW, YALL, JALL, LOGYTR,
C   -------------            TOKN, TOKN1, VALLN, VALLN1, KOD,
C                              MSWALL, RMSWAL, ADRMSW )
C   HAHAEHE:
C   -----------              MOHTOP MOEE:
C               +-----+--------------------------------------+
C               I     I                                      I
C               I T I    HAMEHOBAHE EMEHTA             I
C               I     I                                      I
C               +-----+--------------------------------------+
C               I 330 I POBO OECK EMEHT ""      I
C               +-----+--------------------------------------+
C               I 331 I POBO OECK EMEHT ""    I
C               +-----+--------------------------------------+
C               I 332 I POBO OECK EMEHT"CK."I
C               +-----+--------------------------------------+
C
C                  B ABCMOCT OT HAEH AA ZAPROS [MASPRT(28)]:
C                  BOHET CEE HK:
C
C                  A) ZAPROS = 1
C                     ----------
C                   HE EAET HEO
C
C
C                  B) ZAPROS = 2
C                     ----------
C                   HE EAET HEO
C
C                                                                      )
C                  C) ZAPROS = 3
C                     -----------
C                     OBOTC PACET HAEH BXOHX CHAOB
C                     O BECTHM BXOHM CHAAM.
C                     P TOM: FKOM = 0 - COCTOHE BXOHX
C                                          CHAOB HE MEHOC;
C                               FKOM = 1 - HA TEKEM AE COCTOHE
C                                         OHO "O" MEHTC B
C                                         B T = TX MOMEHT BPEMEH;
C                                         PEAHO B POPAMME OPEE-
C                                         ETC HX-A BOMOHO CME-
C                                         H COCTOH, ATEM TX=TN+HX;
C                                         P HX < HXMIN [MASPRT(62)]
C                                         PHMAETC HX = HXMIN;
C                                         COCTOHE HX=0.0 BBAET
C                                         EAT COOEH;
C                                         POBEEH COTBETCTBE
C                                         MEHEH B MASPRT:
C                                          FKOM <== "1"
C                                         HXG = MIN( HX, HXG )
C                                         TXG = TN + HXG
C
C
C
C                  D) ZAPROS = 4
C                     **********
C                   - P TX_G  [MASPRT(35)] .EQ. TX[RMSW(10)] -
C               ( PABEHCTBO POBEPETC C TO. O "EPSKOM"[MASPRT(39)])
C                      KCPETC CMEHA COCTOH BXOHOO CHAA,
C                      B POTBHOM CAE, HAEHE BXOHOO CHAA
C                      BOCCTAHABBAETC;
C
C   METO:         OECKOE MOEPOBAHE
C   -----
C
C   APAMETP:     MSW, RMSW - PABEE COBO COCTOH MAKPOMOE
C   ---------      ( "OTPEOK" MACCB MSWALL -> C.M. / GETMSW );
C                  YALL - MATPA P0BOMOCT AHAPEMO E;
C                  JALL - BEKTOP CTOHKOB TOKA AHAPEMO E;
C                  VALLN - BEKTOP OBX HAPEH AHAPEMO E:
C                          P  T  =  TN;
C                  VALLN1- BEKTOP OBX HAPEH AHAPEMO E:
C                          P  TN + H0;
C                  TOKN   TOKN1 - HAEHE EPEMEHHX "COCTOH"
C                                  MOE P TN    TN + H0;
C                          ( PAMEPHOCT -> CM. MASPRT(46) = NNTOK )
C                  LOGYTR - BEKTOP PHAKOB K.. OB:
C                  COETC B MAKPOMOEX C PHAKOM TA = 6;
C                  PAMEPHOC MACCBOB P "ALL" OPEETC:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKA_PAMEPHOCT ---> NSYS = MASPRT(26)
C                  KOD - APAMETP OPATHO CB C MOHTOPOM DM....
C
C
C
C
C   OPOPAMM:  1. COMMON PROF1, PROF2, PROF3;
C   ------------   2. SEQSOS
C
C   PMEAHE:  1.CTPKTP MSW COBA MAKPOMOE AHHOO TA CM. HE
C   ----------   2. P ZAPROS ^=  1, 2, 3, 4 - BAA COOEH  XO
C                3. P FTEST >=1 -> EAT HA WTRE AKTA CMEH COCTOH
C
C
C                    "OCTOHHA" ACT MSW
C                     ----------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I PHAKI KO I KO. IAP.   IPE I
C  I EME I TA   I /    I TA   I ECT I BB. IHA.  IE I
C  I HTA   I MOE I PACETAI MOE I BO   I HA I"TOKN" IPB I
C  I       I        I DM.....I        I OBI EH.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I   7   I 8 I
C  +-------+--------+--------+--------+------+------+-------+---+
C
C
C              OPMAT RMSW T # 330,331,332:
C              ------------------------------
C+-----------I--------------I------I-----------------------------------
C  # COBA   I    # COBA B I KTO  I
C OT HAAA  I    OTPEKE   IOPE.I
C BCEO MSW  I    RMSW B    I      I       OOHAEHE - HAEHE
C OCAH   I    FM0025    I      I
C------------I--------------I------I-----------------------------------
C     9      I     0        I      I HOMEP A ( BCEA 0 )
C----------------------------------------------------------------------
C    10      I     1        I  DM  I         PEEPB
C            I              I      I
C    11      I     2        I  FM  I  NBXOD-KOECTBO TOKOB, CO-
C            I              I      I        EMX KAK BXOHE CHA;
C    12      I     3        I  FM  I  #1 - HOMEP EMEHTA;
C    13      I     4        I  FM  I  #CM1 - HOMEP TOKA EMEHTA #1;
C    14      I     5        I  LM  I  ATOKM1 - AP B TOKN/N1 HAEH
C            I              I      I           TOKA HOMEP #CM1
C            I              I      I           EMEHTA #1;
C .......    I   .......    I  ... I  ..........................
C  9+I*3     I     I*3      I  FM  I  #I -      -"-
C 10+I*3     I   1+I*3      I  FM  I  #CMI -      -"-
C 11+I*3     I   2+I*3      I  LM  I  ATOKMI -    -"-
C .......    I   .......    I  ... I  ..........................
C----------------------------------------------------------------------
C  OA HA MSW --> LM<BC> = 11 + 3*NBXOD
C
C  HA EPEMEH. ACT --> LM<RMSW> = 2 + 3*NBXOD
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         REAL JALL, JRL, L, IRLT, IRLN
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
               DIMENSION MSWALL(*), RMSWAL(*)
               INTEGER ADRMSW
         EQUIVALENCE ( MASPRT(62), HXMIN )
         EQUIVALENCE ( MASPRT(14), NWTRE )
         EQUIVALENCE ( MASPRT(60), FTEST )
         INTEGER FTEST
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( HXG,    MASPRT(61) )
         EQUIVALENCE ( NDALL,  MASPRT(23) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( FKOM,   MASPRT(34) )
         EQUIVALENCE ( TXG,    MASPRT(35) )
         EQUIVALENCE ( NTXG,   MASPRT(36) )
         EQUIVALENCE ( EPSKOM, MASPRT(39) )
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         EQUIVALENCE ( ICLOSE, MASPRT(77) )
         EQUIVALENCE ( UOPEN,  MASPRT(78) )
         REAL ICLOSE
         INTEGER FKOM, ZAPROS, TIP, SIG1, SIG11, SIG2, SIG21
C--->  KOHTPO TA
         TIP = MSW(2)
         NTIP = TIP - 329
         IF ( NTIP .GE. 1  .AND. NTIP .LE. 3 ) GO TO 11
C######################################################################
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), TIP
9998     FORMAT( ' *** O. CO B DM0029 - APOC HA OCBAHE O
     =O TA ***'/
     =    ' *** EMEHT # ', I10, ' T MOE # ', I10, ' ***'//)
         CALL SUBERR(1)
         RETURN
C######################################################################
11       CONTINUE
C---> BOP PEMA:
         GO TO ( 667, 666, 600, 500       ), ZAPROS
C===> HAE OKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHTOP #', I4, ' APOC OCBAH OOEH
     = ***'/ ' *** ZAPROS = ', I5, ' - HOPPETC ***')
         RETURN
C======================================================================
C---------------Z A P R O S = 1----------------------------------------
667      CONTINUE
         KOD = 0
         RETURN
C======================================================================
C---------------Z A P R O S = 2----------------------------------------
666      CONTINUE
C---> "CPOC" HAEH TX - BOMOHOO BPEMEH EPEKEH.....
         RMSW(10) = TN + H0
         KOD = 0
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C---- Z A P R O S = 3 -----TOKN, TOKN1, VALLN, VALLN1 OPEEEH-------
600      CONTINUE
C==>  TO A T?
         GO TO ( 610 , 620 , 630 ), NTIP
C-->  OKA. KOHAEM...
         CALL SUBERR(TIP)
         RETURN
C######################################################################
610      CONTINUE
C======================================================================
C     POBO OECK EMEHT ""
C----------------------------------------------------------------------
         NBXOD = MSW(11)
         TIME  = TN + H0
         IMSW  = 11
         DO 615 I = 1,NBXOD
         IMSW = IMSW + 3
         TIME1 = TOKN1( MSW(IMSW) + 3 - MSW(IMSW-1) )
         IF( TIME .GT. TIME1 ) TIME = TIME1
615      CONTINUE
         IMSW = 11
         DO 617 I = 1,NBXOD
         IMSW = IMSW + 3
         IBX  = IFIX (TOKN1( MSW(IMSW) ) )
         TIME1 = TOKN1( MSW(IMSW) + 3 - MSW(IMSW-1) )
         PARAM =  TOKN( MSW(IMSW) )
         IF( TIME1 .GT. TIME ) IBX = IFIX( PARAM )
         IF( IBX .EQ. 0  ) GO TO 663
617      CONTINUE
         GO TO 662
C######################################################################
620      CONTINUE
C======================================================================
C     POBO OECK EMEHT ""
C----------------------------------------------------------------------
         NBXOD = MSW(11)
         TIME  = TN + H0
         IMSW  = 11
         DO 625 I = 1,NBXOD
         IMSW = IMSW + 3
         TIME1 = TOKN1( MSW(IMSW) + 3 - MSW(IMSW-1) )
         IF( TIME .GT. TIME1 ) TIME = TIME1
625      CONTINUE
         IMSW = 11
         DO 627 I = 1,NBXOD
         IMSW = IMSW + 3
         PARAM = TOKN1( MSW(IMSW) )
         IBX  = IFIX ( PARAM )
         TIME1 = TOKN1( MSW(IMSW) + 3 - MSW(IMSW-1) )
         PARAM = TOKN( MSW(IMSW) )
         IF( TIME1 .GT. TIME ) IBX = IFIX( PARAM )
         IF( IBX .EQ. 1  ) GO TO 662
627      CONTINUE
         GO TO 663
C######################################################################
630      CONTINUE
C======================================================================
C     POBO OECK EMEHT "CK. "
C----------------------------------------------------------------------
         NBXOD = MSW(11)
         TIME  = TN + H0
         IMSW  = 11
         DO 635 I = 1,NBXOD
         IMSW = IMSW + 3
         TIME1 = TOKN1( MSW(IMSW) + 3 - MSW(IMSW-1) )
         IF( TIME .GT. TIME1 ) TIME = TIME1
635      CONTINUE
         IMSW = 11
         IBIX = 0
         DO 637 I = 1,NBXOD
         IMSW = IMSW + 3
         PARAM = TOKN1( MSW(IMSW) )
         IBX  = IFIX ( PARAM )
         TIME1 = TOKN1( MSW(IMSW) + 3 - MSW(IMSW-1) )
         PARAM = TOKN( MSW(IMSW) )
         IF( TIME1 .GT. TIME ) IBX = IFIX( PARAM )
         IBIX = IBIX + IBX
637      CONTINUE
         IF( IBIX .EQ. 0  .OR.  IBIX .EQ. NBXOD ) GO TO 663
C######################################################################
C
C       BOMOHE CTAHAPTHE CTA.
C
C######################################################################
662      CONTINUE
C-->   CHA HA BXOE P  T=TIME  CTA PABHM  "1".
C----------------------------------------------------------------------
         RMSW(10) = TIME
         ITOK = MSW(7)
         TOKN1(ITOK) = 1.
         TOKN1(ITOK + 1 ) = 0.
         TOKN1(ITOK + 2 ) = TIME
         KOD = 0
         RETURN
C======================================================================
663      CONTINUE
C-->   CHA HA BXOE P  T=TIME  CTA PABHM  "0".
C----------------------------------------------------------------------
         RMSW(10) = TIME
         ITOK = MSW(7)
         TOKN1(ITOK) = 0.
         TOKN1(ITOK + 1 ) = 1.
         TOKN1(ITOK + 2 ) = TIME
         KOD = 0
         RETURN
C######################################################################
500      CONTINUE
C===> KCA CMEH COCTOH BXOHOO CHAA......ZAPROS = 4
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
        KOD = 0
C       EC TXG   "PMEPHO" PABHO TX=MOE, TO CMEHA HHA!
         TX   = RMSW(10)
         EPST = ABS( TX   - TXG )
C----->   (TX - TXG) = [ (TN+HX) - (TN+HXG) ]
         IF ( EPST .GT. EPSKOM ) GO TO 510
C===> HAE CMEHM COCTOHE....
         ITOK = MSW(7)
         TOKN1(ITOK+2) = TXG
C!!!-------------------------------------------------------------------
         IF ( FTEST .GE. 1 ) WRITE(NWTRE,501) MSW(1),TOKN1(ITOK),TN,TXG
501     FORMAT(' ***FTEST_1: B -TE #',I5, ' CHA  CTA =',F2.0,
     =          ' TN = ', E12.5, ' TXG = ', E12.5, ' ***')
C!!!-------------------------------------------------------------------
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
510      CONTINUE
C--->  BX. CHA HE MEHC.
         ITOK = MSW(7)
         TOKN1(ITOK) = TOKN(ITOK)
         TOKN1(ITOK+1) = 0.0
         IF( TOKN1(ITOK) .LE. 0.5 ) TOKN1(ITOK+1) = 1.0
         TOKN1(ITOK+2) = TXG
         RETURN
C----------------------------------------------------------------------
         END
