         SUBROUTINE DM0035 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                       MSWALL, RMSWAL, ADRMSW )
CXXX----KOMèãEKC "MS1" --> BEPCàü 1.1  (OT  AèPEãü 1988 É.)------------
C   èOÑèPOÉPAMMA:  DM0035 ( MSW, RMSW, YALL, JALL, LOGYTR
C  -------------             TOKN, TOKN1, VALLN, VALLN1, KOD,
C                            MSWALL, RMSWAL, ADRMSW )
C
C   HAáHAóEHàE:    B áABàCàMOCTà OT áHAóEHàü îãAÉA ZAPROS [MASPRT(28)]:
C   -----------    BõèOãHüET CãEÑìûôàE îìHKñàà:
C
C
C                  A) ZAPROS = 1
C                  -------------
C                    CÅPOC îãAÉA FQ - BEãàóàHõ ìèP. èAPAM. OèPEÑEãEHõ;
C                  === Hà óEÉO HE PACóàTõBAEM ==
C
C                  B) ZAPROS = 2
C                     ----------
C                      == B CãìóAE HìãEBOÉO áHAóEHàü îãAÉA FQ -->
C                  BõóàCãEHàE
C
C
C              FQ - PACóET ìèP. HAèPüÜEHàâ BõèOãHEH -->
C                  MEXAHàáM ùTOÉO îãAÉA èOáBOãüET CàHXPOHàáàPOBATú
C                  BõèOãHEHàü PAáãàóHõX DM_MOHàTOPOB C è.TàèA # 4;
C
C                  C) ZAPROS = 3
C                     **********
C                     HE èOÑÑEPÜàBAETCü ( PEáEPB );
C
C                  D) ZAPROS = 4
C                     **********
C                     HE èOÑÑEPÜàBAETCü;
C
C----------------------------------------------------------------------
C
C              OÅPAÅATõBAET MAKPOMOÑEãà ãàHEâHõX ÑàHAMàóECKàX áBEHúEB:
C
C  +-----+-------------------------------------------+----------------+
C  I     I                               I  èEPEÑA-  I   PACóETHAü    I
C  I Tàè I       HAàMEHOBAHàE áBEHA      I  TOóHAü   I    îOPMìãA     I
C  I     I                               I  îìHKñàü  I                I
C  I-----I-------------------------------I-----------I----------------I
C  I     I  èPOèOPñàOHAãúHO-CìMMàPìûôEE  I           I                I
C  I 318 I       ( è - PEÉìãüTOP )       I     K     I YN1=SUM(K*UN1) I
C  I     I                               I           I                I
C  I-----I-------------------------------I-----------I----------------I
C  I     I  èPOèOPñàOHAãúHõâ CìMMATOP    I           I                I
C  I 324 I       KBAÑPATOB               I           IYN1=SUM(K*UN1**2)
C  I     I                               I           I                I
C  I-----I-------------------------------I-----------I----------------I
C                ******************************************************
C                èPàáHAK TIP # 4 -> ãOÉ. MAKPOMOÑEãú.
C
C----------------------------------------------------------------------
C              ùãEMEHTõ OèàCõBAûTCü:
C
C      ù # T 3XX ì 0 è
C              MAS < NNAPR  ìáH1 ìáK1 K1  ìáH2 ìáK2 K2  ... >
C              MAS < NGARM  W  A0  A1  FI1  A2  FI2... >
C
C      ÉÑE
C          NNAPR  -   KOãàóECTBO HAèPüÜEHàâ CXEMõ , KOTOPõE
C                     àCèOãúáìûTCü B KAóECTBE BXOÑHõX CàÉHAãOB;
C          ìáHI,ìáKI- HOMEPA ìáãOB, HAèPüÜEHàE MEÜÑì KOTOPõMà
C                     àCèOãúáìETCü B KAóECTBE BXOÑHOÉO CàÉHAãA;
C          KI       - KOùîîàñàEHT èPOèOPñàOHAãúHOCTà I-TOÉO
C                     HAèPüÜEHàü;
C          NGARM  -   KOãàóECTBO ùãEMEHTOB ÉAPMOHàóECKOÉO PüÑA
C                     OèàCõBAûôEÉO áAÑAHHõâ CàÉHAã, èOÑABAEMõâ
C                     HA BXOÑ PEÉìãüTOPA (C ìóETOM èOCT. COCTABã.);
C          W    -     óACTOTA OCHOBHOâ ÉAPMOHàKà ( 1/C );
C          A0,A1,...- AMèãàTìÑõ COOTBETBìûôàX ÉAPMOHàK CàÉHAãA;
C          FI1,FI2...-HAó. îAáõ COOTBETBìûôàX ÉAPMOHàK CàÉHAãA;
C----------------------------------------------------------------------
C
C   METOÑ:     OèPEÑEãEHàE BõXOÑHõX CàÉHAãOB ãàHEâHõX ÑàHAMàóECKàX
C   -----      áBEHúEB B COOTBETCTBàà C àX èEPEÑATOóHõMà îìHKñàüMà.
C
C   èAPAMETPõ:     MSW, RMSW - ìèPABãüûôEE CãOBO COCTOüHàü MAKPOMOÑEãà
C   ---------      ( "OTPEáOK" MACCàBõ MSWALL -> C.M. è/è GETMSW );
C                  YALL - MATPàñA èP0BOÑàMOCTà AHAãàáàPìEMOâ ñEèà;
C                  JALL - BEKTOP àCTOóHàKOB TOKA AHAãàáàPìEMOâ ñEèà;
C                  VALLN - BEKTOP ìáãOBõX HAèPüÜEHàâ AHAãàáàPìEMOâ ñEèà:
C                          B T = TN;
C                  VALLN1- BEKTOP ìáãOBõX HAèPüÜEHàâ AHAãàáàPìEMOâ ñEèà:
C                          B T = TN + H0;
C                  TOKN  à  TOKN1  -  áHAóEHàü "TOKOB" èPà T :=
C                                     TN  à  TN + H0;
C                                   PAáMEPHOCTà CM. MASPRT(46)=NNTOK;
C                  LOGYTR - BEKTOP èPàáHAKOB K.á. ìáãOB:
C                  àCèOãúáìETCü B MAKPOMOÑEãüX C èPàáHAKOM TàèA = 5;
C                  PAáMEPHOCà MACCàBOB ÉPìèèõ "ALL" OèPEÑEãüûTCü:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKìôAü_PAáMEPHOCTú ---> NSYS = MASPRT(26)
C                  KOD - èAPAMETP OÅPATHOâ CBüáà C MOHàTOPOM DM....
C                   ( =1 èPà ÅOãúòOâ ãOK. èOÉPEòHOCTà );
C                 MSWALL( (RMSWAL ) - BECú CèàCOK MSW_ALL,
C                 ADRMSW - AÑPEC TEK. CãOAB MSW ( RMSW );
C
C
C   èOÑèPOÉPAMMõ:  1. COMMON PROF1, PROF2, PROF3;
C   ------------      DEPOST;
C
C   èPàMEóAHàE:  1.CTPìKTìPì MSW CãOBA MAKPOMOÑEãà ÑAHHOÉO TàèA CM. HàÜE
C   ----------   2. èPà ZAPROS ^=   1 àãà 2 - COOÅôEHàE à ìXOÑ;
C
C
C               "èOCTOüHHAü" óACTú MSW TàèOB # 318, # 324:
C                -----------------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I èPàáHAKI KOãà I KOã. IAÑP.   IPE I
C  I ùãEME I TàèA   I è/è    I TàèA   I óECT I BõB. IHAó.   IáE I
C  I HTA   I MOÑEãà I PACóETAI MOÑEãà I BO   I áHAó I"TOKN" IPB I
C  I       I        I DM.....I       .I ìáãOBI EHàâ.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I  7    I 8 I
C  +-------+--------+--------+--------+------+------+-------+---+
C
C
C              îOPMAT RMSW Tàè # 318, # 324:
C              -----------------------------
C+-----------I--------------I------I-----------------------------------
C  # CãOBA   I    # CãOBA B I KTO  I
C OT HAóAãA  I    OTPEáKE   IOèPEÑ.I
C BCEÉO MSW  I    RMSW B    I      I       OÅOáHAóEHàE - áHAóEHàE
C OèàCAHàü   I    FM0030    I      I
C------------I--------------I------I-----------------------------------
C     9      I     0        I      I HOMEP ìáãA ( BCEÉÑA 0 )
C----------------------------------------------------------------------
C    10      I     1        I  DM  I  FQ - îãAÉ HOBõE áHAó. BõóàCãEHõ
C            I              I      I   ( Ñãü CàHXPO. MAKPO. P.TIP # 4 )
C    11      I     2        I  FM  I  NNAPR-KOãàóECTBO HAèP., àCèOãú-
C            I              I      I        áìEMõX KAK BXOÑHõE CàÉHAãõ;
C    12      I     3        I  FM  I  ìáH1 - ìáEã HAóAãA;
C    13      I     4        I  FM  I  ìáK1 - ìáEã KOHñA;
C    14      I     5        I  FM  I  K1   - KOùîîàñàEHT èPOèOPñàOHAãú-
C            I              I      I         HOCTà HAèPüÜEHàü;
C  9+I*3     I     I*3      I  FM  I  ìáHI -      -"-
C 10+I*3     I   1+I*3      I  FM  I  ìáKI -      -"-
C 11+I*3     I   2+I*3      I  FM  I  KI   -      -"-
C .......    I   .......    I  ... I  ..........................
C12+NNAPR*3  I  3+NBXOD*3   I  FM  I  NGARM -KOãàóECTBO ÉAPMOHàK, àCè.
C            I              I      I         Ñãü OèàCAHàü áAÑ. CàÉHAãA
C            I              I      I         (C ìóETOM èOCT. COCTABã.);
C 13+NNAPR*3 I  4+NNAPR*3   I  FM  I  W  -   óACTOTA OCH. ÉAPMOHàKà;
C 14+NNAPR*3 I  5+NNAPR*3   I  FM  I  A0  -  AMèãàTìÑA èOCT. COCTABãü-
C            I              I      I         ûôEâ áAÑ. CàÉHAãA;
C 15+NNAPR*3 I  6+NNAPR*3   I  FM  I  A1  -  AMèãàTìÑA 1-Oâ ÉAPMOHàKà
C            I              I      I         áAÑAHHOÉO CàÉHAãA;
C 16+NNAPR*3 I  7+NNAPR*3   I  FM  I  FI1 -  HAó. îAáA 1-Oâ ÉAPMOHàKà;
C 17+NNAPR*3 I  8+NNAPR*3   I  FM  I  A2  -  AMèãàTìÑA 2-Oâ ÉAPMOHàKà;
C 18+NNAPR*3 I  9+NNAPR*3   I  FM  I  FI2 -  HAó. îAáA 2-Oâ ÉAPMOHàKà;
C .......    I   .......    I  ... I  ..........................
C----------------------------------------------------------------------
C
C  OÅôAü ÑãàHA MSW --> LM<BCü> = 12 + 3*NNAPR + 2*NGARM
C
C  ÑãàHA èEPEMEH. óACTà --> LM<RMSW> = 3 + 3*NNAPR + 2*NGARM
C
C----------------------------------------------------------------------
C
C     B MACCàBE TOKN à TOKN1 COÑEPÜàTCü:
C     **********************************
C     TOKN/N1(1) - áHAóEHàE BõXOÑHOÉO CàÉHAãA;
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         DIMENSION MSWALL(*), RMSWAL(*)
         DIMENSION INTMAS(1), STMAS(100), DGMAS(12)
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
         INTEGER ADRMSW
         REAL JALL, JNEL, MAXITR,INTMAS
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( NNTOK,  MASPRT(46) )
         EQUIVALENCE ( NSYS,   MASPRT(26) )
         EQUIVALENCE ( NWTRE,  MASPRT(14) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( FITER,  MASPRT(65) )
         EQUIVALENCE ( EITER,  MASPRT(67) )
         EQUIVALENCE ( NLITER, MASPRT(79) )
         EQUIVALENCE ( MAXITR, MASPRT(80) )
         EQUIVALENCE ( NSITER, MASPRT(88) )
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         INTEGER FITER, TIP, ZAPROS
       KOD = 0
C**********************************************************************
       TIP = MSW(2)
       NTIP = TIP - 317
       IF ( NTIP .EQ. 1 ) GO TO 9900
       IF ( NTIP .EQ. 7 ) GO TO 9900
C######################################################################
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** ãOÉ. CÅOâ B DM0035 - áAèPOC HA OÅCãìÜàBAHàE óìÜOÉ
     =O TàèA ***'/
     =    ' *** ùãEMEHT # ', I10, ' Tàè MOÑEãà # ', I10, ' ***'//)
         CALL SUBERR(0)
C######################################################################
9900   CONTINUE
C--->  BõÅOP PEÜàMA áAèPOCA..
6666   GO TO( 100, 200), ZAPROS
C----------------------------------------------------------------------
C===> àHAóE OòàÅKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHàTOP #', I4, ' áAèPOC OÅCãìÜàBAHàü OòàÅOóEH
     = ***'/ ' *** ZAPROS = ', I5, ' - àÉHOPàPìETCü ***')
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C---- ZAPROS = 1 ------------------------------------------------------
100    CONTINUE
C==> CÅPOC îãAÉA       OCHOBHOâ PACóET BõèOãHEH;
       MSW(10) = 0
       RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C-----ZAPROS = 2 ------------------------------------------------------
200    CONTINUE
C-->  HìÜHO ãà PAÅOTATú ?
       IF ( MSW(10) .EQ. 1 ) RETURN
C----------------------------------------------------------------------
C-->  èPàÑETCü .............................
C-->  ZAPROS = 2 --> PACóàTATú áHAóEHàü....
       GO TO (1000),NTIP
C######################################################################
1000   CONTINUE
C----------------------------------------------------------------------
C-->   èPOèOPñàOHAãúHO CìMMàPìûôEE áBEHO ( Tàè 318 )
C----------------------------------------------------------------------
       NNAPR = MSW(11)
       NGARM = MSW(12 + 3*NNAPR)
       SIGNAL = 0.
       IF( NGARM .LT. 1 ) GO TO 1110
C----------------------------------------------------------------------
C--> èPàÅABàM áHAóEHàE áAÑAHHOÉO BXOÑHOÉO CàÉHAãA
       W = RMSW(13 + 3*NNAPR)
       A0 = RMSW(14 + 3*NNAPR)
       SIGNAL = A0
       I1 = 2*(NGARM - 1)
       IF( I1 .EQ. 0 ) GO TO 1110
          DO 1100 I=1,I1,2
          NRMSW = 14 + I + 3*NNAPR
          AI = RMSW(NRMSW)
          FII= RMSW(NRMSW+1)
          N = I / 2 + 1
          SIGNAL = SIGNAL + AI * SIN(N*W*(TN+H0) + FII)
1100   CONTINUE
1110   CONTINUE
       IF( NTIP .EQ. 7 ) SIGNAL = SIGNAL**2
C----------------------------------------------------------------------
C--> èPOCìMMàPìEM BXOÑHõE CàÉHAãõ
       IF(NNAPR .EQ. 0 ) GO TO 1210
          DO 1200 I=1,NNAPR
          NMSW = 11 + I*3
          AKI  = RMSW(NMSW)
          NYZN = MSW(NMSW-2)
          NYZK = MSW(NMSW-1)
          VN = 0.0
          IF( NYZN .NE. 0 ) VN = VALLN1(NYZN)
          VK = 0.0
          IF( NYZK .NE. 0 ) VK = VALLN1(NYZK)
          IF( NTIP .EQ. 1 ) SIGNAL = SIGNAL + AKI*(VN - VK)
          IF( NTIP .EQ. 7 ) SIGNAL = SIGNAL + AKI*(VN - VK)**2
1200   CONTINUE
1210   CONTINUE
C----------------------------------------------------------------------
C--> áAèàòEM B TOKN1
       ITOK = MSW(7)
       TOKN1(ITOK) = SIGNAL
C----------------------------------------------------------------------
C-->  áAîàKCàP. KOHEñ BõóàCãEHàâ       ( FQ îãAÉ )
       MSW(10) = 1
       RETURN
       END
