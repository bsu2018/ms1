         SUBROUTINE DM0035 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                       MSWALL, RMSWAL, ADRMSW )
CXXX----KOMEKC "MS1" --> BEPC 1.1  (OT  APE 1988 .)------------
C   OPOPAMMA:  DM0035 ( MSW, RMSW, YALL, JALL, LOGYTR
C  -------------             TOKN, TOKN1, VALLN, VALLN1, KOD,
C                            MSWALL, RMSWAL, ADRMSW )
C
C   HAHAEHE:    B ABCMOCT OT HAEH AA ZAPROS [MASPRT(28)]:
C   -----------    BOHET CEE HK:
C
C
C                  A) ZAPROS = 1
C                  -------------
C                    CPOC AA FQ - BEH P. APAM. OPEEEH;
C                  === H EO HE PACTBAEM ==
C
C                  B) ZAPROS = 2
C                     ----------
C                      == B CAE HEBOO HAEH AA FQ -->
C                  BCEHE
C
C
C              FQ - PACET P. HAPEH BOHEH -->
C                  MEXAHM TOO AA OBOET CHXPOHPOBAT
C                  BOHEH PAHX DM_MOHTOPOB C .TA # 4;
C
C                  C) ZAPROS = 3
C                     **********
C                     HE OEPBAETC ( PEEPB );
C
C                  D) ZAPROS = 4
C                     **********
C                     HE OEPBAETC;
C
C----------------------------------------------------------------------
C
C              OPAATBAET MAKPOMOE HEHX HAMECKX BEHEB:
C
C  +-----+-------------------------------------------+----------------+
C  I     I                               I  EPEA-  I   PACETHA    I
C  I T I       HAMEHOBAHE BEHA      I  TOHA   I    OPMA     I
C  I     I                               I  HK  I                I
C  I-----I-------------------------------I-----------I----------------I
C  I     I  POOPOHAHO-CMMPEE  I           I                I
C  I 318 I       (  - PETOP )       I     K     I YN1=SUM(K*UN1) I
C  I     I                               I           I                I
C  I-----I-------------------------------I-----------I----------------I
C  I     I  POOPOHAH CMMATOP    I           I                I
C  I 324 I       KBAPATOB               I           IYN1=SUM(K*UN1**2)
C  I     I                               I           I                I
C  I-----I-------------------------------I-----------I----------------I
C                ******************************************************
C                PHAK TIP # 4 -> O. MAKPOMOE.
C
C----------------------------------------------------------------------
C              EMEHT OCBATC:
C
C       # T 3XX  0 
C              MAS < NNAPR  H1 K1 K1  H2 K2 K2  ... >
C              MAS < NGARM  W  A0  A1  FI1  A2  FI2... >
C
C      E
C          NNAPR  -   KOECTBO HAPEH CXEM , KOTOPE
C                     COTC B KAECTBE BXOHX CHAOB;
C          HI,KI- HOMEPA OB, HAPEHE ME KOTOPM
C                     COETC B KAECTBE BXOHOO CHAA;
C          KI       - KOEHT POOPOHAHOCT I-TOO
C                     HAPEH;
C          NGARM  -   KOECTBO EMEHTOB APMOHECKOO PA
C                     OCBAEO AAHH CHA, OABAEM
C                     HA BXO PETOPA (C ETOM OCT. COCTAB.);
C          W    -     ACTOTA OCHOBHO APMOHK ( 1/C );
C          A0,A1,...- AMT COOTBETBX APMOHK CHAA;
C          FI1,FI2...-HA. A COOTBETBX APMOHK CHAA;
C----------------------------------------------------------------------
C
C   METO:     OPEEEHE BXOHX CHAOB HEHX HAMECKX
C   -----      BEHEB B COOTBETCTB C X EPEATOHM HKM.
C
C   APAMETP:     MSW, RMSW - PABEE COBO COCTOH MAKPOMOE
C   ---------      ( "OTPEOK" MACCB MSWALL -> C.M. / GETMSW );
C                  YALL - MATPA P0BOMOCT AHAPEMO E;
C                  JALL - BEKTOP CTOHKOB TOKA AHAPEMO E;
C                  VALLN - BEKTOP OBX HAPEH AHAPEMO E:
C                          B T = TN;
C                  VALLN1- BEKTOP OBX HAPEH AHAPEMO E:
C                          B T = TN + H0;
C                  TOKN    TOKN1  -  HAEH "TOKOB" P T :=
C                                     TN    TN + H0;
C                                   PAMEPHOCT CM. MASPRT(46)=NNTOK;
C                  LOGYTR - BEKTOP PHAKOB K.. OB:
C                  COETC B MAKPOMOEX C PHAKOM TA = 5;
C                  PAMEPHOC MACCBOB P "ALL" OPEETC:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKA_PAMEPHOCT ---> NSYS = MASPRT(26)
C                  KOD - APAMETP OPATHO CB C MOHTOPOM DM....
C                   ( =1 P OO OK. OPEHOCT );
C                 MSWALL( (RMSWAL ) - BEC CCOK MSW_ALL,
C                 ADRMSW - APEC TEK. COAB MSW ( RMSW );
C
C
C   OPOPAMM:  1. COMMON PROF1, PROF2, PROF3;
C   ------------      DEPOST;
C
C   PMEAHE:  1.CTPKTP MSW COBA MAKPOMOE AHHOO TA CM. HE
C   ----------   2. P ZAPROS ^=   1  2 - COOEHE  XO;
C
C
C               "OCTOHHA" ACT MSW TOB # 318, # 324:
C                -----------------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I PHAKI KO I KO. IAP.   IPE I
C  I EME I TA   I /    I TA   I ECT I BB. IHA.   IE I
C  I HTA   I MOE I PACETAI MOE I BO   I HA I"TOKN" IPB I
C  I       I        I DM.....I       .I OBI EH.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I  7    I 8 I
C  +-------+--------+--------+--------+------+------+-------+---+
C
C
C              OPMAT RMSW T # 318, # 324:
C              -----------------------------
C+-----------I--------------I------I-----------------------------------
C  # COBA   I    # COBA B I KTO  I
C OT HAAA  I    OTPEKE   IOPE.I
C BCEO MSW  I    RMSW B    I      I       OOHAEHE - HAEHE
C OCAH   I    FM0030    I      I
C------------I--------------I------I-----------------------------------
C     9      I     0        I      I HOMEP A ( BCEA 0 )
C----------------------------------------------------------------------
C    10      I     1        I  DM  I  FQ - A HOBE HA. BCEH
C            I              I      I   (  CHXPO. MAKPO. P.TIP # 4 )
C    11      I     2        I  FM  I  NNAPR-KOECTBO HAP., CO-
C            I              I      I        EMX KAK BXOHE CHA;
C    12      I     3        I  FM  I  H1 - E HAAA;
C    13      I     4        I  FM  I  K1 - E KOHA;
C    14      I     5        I  FM  I  K1   - KOEHT POOPOHA-
C            I              I      I         HOCT HAPEH;
C  9+I*3     I     I*3      I  FM  I  HI -      -"-
C 10+I*3     I   1+I*3      I  FM  I  KI -      -"-
C 11+I*3     I   2+I*3      I  FM  I  KI   -      -"-
C .......    I   .......    I  ... I  ..........................
C12+NNAPR*3  I  3+NBXOD*3   I  FM  I  NGARM -KOECTBO APMOHK, C.
C            I              I      I          OCAH A. CHAA
C            I              I      I         (C ETOM OCT. COCTAB.);
C 13+NNAPR*3 I  4+NNAPR*3   I  FM  I  W  -   ACTOTA OCH. APMOHK;
C 14+NNAPR*3 I  5+NNAPR*3   I  FM  I  A0  -  AMTA OCT. COCTAB-
C            I              I      I         E A. CHAA;
C 15+NNAPR*3 I  6+NNAPR*3   I  FM  I  A1  -  AMTA 1-O APMOHK
C            I              I      I         AAHHOO CHAA;
C 16+NNAPR*3 I  7+NNAPR*3   I  FM  I  FI1 -  HA. AA 1-O APMOHK;
C 17+NNAPR*3 I  8+NNAPR*3   I  FM  I  A2  -  AMTA 2-O APMOHK;
C 18+NNAPR*3 I  9+NNAPR*3   I  FM  I  FI2 -  HA. AA 2-O APMOHK;
C .......    I   .......    I  ... I  ..........................
C----------------------------------------------------------------------
C
C  OA HA MSW --> LM<BC> = 12 + 3*NNAPR + 2*NGARM
C
C  HA EPEMEH. ACT --> LM<RMSW> = 3 + 3*NNAPR + 2*NGARM
C
C----------------------------------------------------------------------
C
C     B MACCBE TOKN  TOKN1 COEPTC:
C     **********************************
C     TOKN/N1(1) - HAEHE BXOHOO CHAA;
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         DIMENSION MSWALL(*), RMSWAL(*)
         DIMENSION INTMAS(1), STMAS(100), DGMAS(12)
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
         INTEGER ADRMSW
         REAL JALL, JNEL, MAXITR,INTMAS
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( NNTOK,  MASPRT(46) )
         EQUIVALENCE ( NSYS,   MASPRT(26) )
         EQUIVALENCE ( NWTRE,  MASPRT(14) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( FITER,  MASPRT(65) )
         EQUIVALENCE ( EITER,  MASPRT(67) )
         EQUIVALENCE ( NLITER, MASPRT(79) )
         EQUIVALENCE ( MAXITR, MASPRT(80) )
         EQUIVALENCE ( NSITER, MASPRT(88) )
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         INTEGER FITER, TIP, ZAPROS
       KOD = 0
C**********************************************************************
       TIP = MSW(2)
       NTIP = TIP - 317
       IF ( NTIP .EQ. 1 ) GO TO 9900
       IF ( NTIP .EQ. 7 ) GO TO 9900
C######################################################################
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** O. CO B DM0035 - APOC HA OCBAHE O
     =O TA ***'/
     =    ' *** EMEHT # ', I10, ' T MOE # ', I10, ' ***'//)
         CALL SUBERR(0)
C######################################################################
9900   CONTINUE
C--->  BOP PEMA APOCA..
6666   GO TO( 100, 200), ZAPROS
C----------------------------------------------------------------------
C===> HAE OKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHTOP #', I4, ' APOC OCBAH OOEH
     = ***'/ ' *** ZAPROS = ', I5, ' - HOPPETC ***')
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C---- ZAPROS = 1 ------------------------------------------------------
100    CONTINUE
C==> CPOC AA       OCHOBHO PACET BOHEH;
       MSW(10) = 0
       RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C-----ZAPROS = 2 ------------------------------------------------------
200    CONTINUE
C-->  HHO  PAOTAT ?
       IF ( MSW(10) .EQ. 1 ) RETURN
C----------------------------------------------------------------------
C-->  PETC .............................
C-->  ZAPROS = 2 --> PACTAT HAEH....
       GO TO (1000),NTIP
C######################################################################
1000   CONTINUE
C----------------------------------------------------------------------
C-->   POOPOHAHO CMMPEE BEHO ( T 318 )
C----------------------------------------------------------------------
       NNAPR = MSW(11)
       NGARM = MSW(12 + 3*NNAPR)
       SIGNAL = 0.
       IF( NGARM .LT. 1 ) GO TO 1110
C----------------------------------------------------------------------
C--> PABM HAEHE AAHHOO BXOHOO CHAA
       W = RMSW(13 + 3*NNAPR)
       A0 = RMSW(14 + 3*NNAPR)
       SIGNAL = A0
       I1 = 2*(NGARM - 1)
       IF( I1 .EQ. 0 ) GO TO 1110
          DO 1100 I=1,I1,2
          NRMSW = 14 + I + 3*NNAPR
          AI = RMSW(NRMSW)
          FII= RMSW(NRMSW+1)
          N = I / 2 + 1
          SIGNAL = SIGNAL + AI * SIN(N*W*(TN+H0) + FII)
1100   CONTINUE
1110   CONTINUE
       IF( NTIP .EQ. 7 ) SIGNAL = SIGNAL**2
C----------------------------------------------------------------------
C--> POCMMPEM BXOHE CHA
       IF(NNAPR .EQ. 0 ) GO TO 1210
          DO 1200 I=1,NNAPR
          NMSW = 11 + I*3
          AKI  = RMSW(NMSW)
          NYZN = MSW(NMSW-2)
          NYZK = MSW(NMSW-1)
          VN = 0.0
          IF( NYZN .NE. 0 ) VN = VALLN1(NYZN)
          VK = 0.0
          IF( NYZK .NE. 0 ) VK = VALLN1(NYZK)
          IF( NTIP .EQ. 1 ) SIGNAL = SIGNAL + AKI*(VN - VK)
          IF( NTIP .EQ. 7 ) SIGNAL = SIGNAL + AKI*(VN - VK)**2
1200   CONTINUE
1210   CONTINUE
C----------------------------------------------------------------------
C--> AEM B TOKN1
       ITOK = MSW(7)
       TOKN1(ITOK) = SIGNAL
C----------------------------------------------------------------------
C-->  AKCP. KOHE BCEH       ( FQ A )
       MSW(10) = 1
       RETURN
       END
