         SUBROUTINE DM0014 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                       MSWALL, RMSWAL, ADRMSW )
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)------------
C   OPOPAMMA:  DM0014 ( MSW, RMSW, YALL, JALL, LOGYTR
C  -------------             TOKN, TOKN1, VALLN, VALLN1, KOD,
C                            MSWALL, RMSWAL, ADRMSW )
C
C   HAHAEHE:    B ABCMOCT OT HAEH AA ZAPROS [MASPRT(28)]:
C   -----------    BOHET CEE HK:
C
C                  MOE #40 --> PETOP BOEH  . MAH:
C                                MOE # 11, 110, 12, 120;
C
C
C
C              EMEHT OCBAETC:
C
C       # T 40  KA KB KC
C           T_BK U_OTO. #-TA_._MAH_3X3X0
C              PSUB #P < .........>;
C
C              EPE AAPAT PSUB AATC AKOH PABEH "HE";
C
C      E
C              KA, KB, KC -  E, PHTE A OOPH CCTEM
C                           HAPEH ( CET ECKOHEHO MOHOCT );
C              T_BK - BPEM, HAHA C KOTOPOO BK. PE. BO.
C              U_OT. - OTOOHOE HAPEHE HA BXOE PETOPA
C                      ( OPAHBATC "CHCO" BX. HAPEH );
C              #. MA. - HOMEP EMEHTA, OCBA . MAH,
C                          KOTOP PEPEM;
C
C
C***********
C BHHMAHE:  MOHTOP KOPPEKTHO OPEEET OMEGA_OOPHA  OBOE
C              OOEHE OOPHOO BEKTOPA CCTEM ( AABAEMOO
C              KAK CET ECKOHEHO MOHOCT, AM KA, KB, KC ),
C              TOKO P COB HE PABEHCTBA H MHOBEHHX
C              OBX HAPEH OHOBPEMEHHO.
C
C  !!!           B CAE PABEHCTBA 0.0 TX BEH CTAHABBAETC
C                                                    ---------------
C               OMEGA_OOPHO_CCTEM = 314.15927,
C               COS( OMEGA*TN1 ) = 1.0,
C               SIN( OMEGA*TN1 ) = 0.0;
C  !!!
C               OECEEH BOHEH TOO COB:
C              1. AABAT T_BK HE PABHOE T0 (BPEMEH HAAA PACETA);
C                                
C              2. AABAT HAAHOE HAEHE OBX HAPEH HA
C                 AX KA, KB, KC;
C
C              3.  B O  M O  H O ------------>
C                 KOPOBAT HOMEP A KA PABHM 0.
C                 ----------------------------------
C                 P TOM CTAETC OMEG_OOPHA = 314.15927,
C                 AA = 0 ( B MOMEHT BKEH "PE. BOEH" )
C
C
C***********
C
C      BBOHE BEH B MACCBE TOKN/TOKN1:
C
C      U_R__A, U_R__B, U_R__C,  -->  HAPEH PABEH
C       (#1)      (#2)       (#3)          B CCTEME OCE POTOPA;
C     OMEA_OPOHA, S_CKOEHE,         !!! BBEEHO MHOEHE HA
C          (#4)         (#5)               !!! KO. 2/3 P EPEXOE
C    U_Q_P.  U_D_P;                    !!! OT AHX K OOPHM
C     (#6)      (#7)                       !!! B Q-D CCTEME BEKTOPAM;
C                                          !!!!!!!!!!!!!!!!!!!!!!!!!!!!
C  OOHTEHO KCPETC:==>
C
C   U_S_Q_0,   U_S_D_0,  I_S_Q_0,  I_S_D_0,
C     (#8)      (#9)      (#10)     (#11)
C   U_R_Q_0,   U_R_D_0,  I_R_Q_0,  I_R_D_0
C    (#12)      (#13)     (#14)     (#15)
C   I_S_D_A,   S_CKOEHE_A,  INT(ISD-ISD_ZAD),  INT(S-S_ZAD),
C    (#16)       (#17)               (#18)               (#19)
C    PEEPB;
C    (#20)                                 -->   BCEO 20 HAEH;
C
C*****  AHHA MOE OCBAET MAKPOMOE C T.# 11, 110, 12, 120;
C
C
C                  A) ZAPROS = 1
C                  -------------
C                    CPOC AA FX - BEH P. HAP. OPEEEH;
C                  === H EO HE PACTBAEM ==
C
C                  B) ZAPROS = 2
C                     ----------
C                      == B CAE HEBOO HAEH AA FQ -->
C                  BCEHE HAPEH PABEH B CCTEME OCE
C                  POTOPA MAH;
C
C
C              FQ - PACET P. HAPEH BOHEH -->
C                  MEXAHM TOO AA OBOET CHXPOHPOBAT
C                  BOHEH PAHX DM_MOHTOPOB C .TA # 4;
C
C                  AKOH PABEH --> EPE OPOPAMM OOBATE
C
C
C                  C) ZAPROS = 3
C                     **********
C                     HE OEPBAETC ( PEEPB );
C
C                  D) ZAPROS = 4
C                     **********
C                     HE OEPBAETC;
C
C   METO:         OPEEEHE OMEGA_OOPHO CCTEM, PAOEHE
C   -----          BCEX BEH (TOK, HAPEHE) B TO CCTEME,
C                  BCEHE CKOEHE  P. HAP. (EPE PSUB)
C                  POEK BEKTOPA HAP. PAB. HA OC POTOPA;
C
C
C      1) ......... OCAH AKOHOB PABEH PEAOBAHA PSUB1-->
C
C      PSUB 1 < KE URD00 KI ISDZAD URQ00 KS BETA SZAD XAF   >;
C              ( 8-M APAMETPOB )
C
C
C      2) ......... OCAH AKOHOB PABEH PEAOBAHA PSUB2-->
C
C      PSUB 2 < KE URD00 KI ISDZAD URQ00 KS BETA SZAD  XAF
C
C      KTI  TI1 ISZAD_1  TI2 ISZAD_2 .....
C                        I         I
C                        I<---*--->I
C
C      KTS  TS1 S_1      TS2    S_2  ...... >;
C                        I         I
C                        I         I
C                        I<---*--->I
C
C
C    E:
C          -*-  BA HAEH, OCBAE OH TOK OPEEEH
C               COOTBETCTBE HKOHAHO ABCMOCT -->
C               OHA AAETC KAK KCOHO-HEHA HK;
C
C       KTI  - KO-BO TOEK  OPEEEH ABCMOCT ISZAD OT "TN";
C
C       KTS  - KO-BO TOEK  OPEEEH ABCMOCT SZAD  OT "TN";
C
C  !!! FM0010 KTI  KTS BABAET !!!
C
C   B POBOH / OOBATE EPEAETC CEEE:
C
C  APAMETP:   NEL - HOMEP EMEHTA,  KOTOPOO PSUB PAOTAET;
C  ---------    URMAS - MACCB AHHX OOBATE: ( PSUB1):
C               *****
C       COBO        HAEHE
C      1               8 - KO-BO APAMETPOB B CCKE URMAS
C      2               KE         HAEHE
C      3               URD00      HAEHE
C      4               KI         HAEHE
C      5               ISDZAD     HAEHE
C      6               URQ00      HAEHE
C      7               KS         HAEHE
C      8               BETA       HAEHE
C      9               SZAD       HAEHE
C      10              XAF        HAEHE
C  - - - - - - -- - - - - - - - - - - - - - - - - - - - - -
C     AEE ---> AHAOHO COACHO
C                CCKA AKOPOBAHHX B OCATEE PSUB <....>
C                HAEH, CKA KAAHHE;
C
C
C              STMAS - MACCB AHHX, EPEABAEMX B PSUB:
C              *****
C      COBO           OOHAEHE   -   HAEHE
C      1               TN - BPEM N - O AA PACETA;
C      2               H0 - A HTEPPOBAH;
C- TN+H0*** TN ***
C   I           I
C   Y           Y
C   13         3       ISQ0 - TOK CTATOPA Q OC OOPHA;
C   14         4       ISD0 - TOK CTATOPA D OC OOPHA;
C   15         5       USQ0 - HAPEHE CTATOPA Q OC OOPHA;
C   16         6       USD0 - HAPEHE CTATOPA D OC OOPHA;
C   17         7       IRQ0 - TOK POTOPA Q OC OOPHA;
C   18         8       IRD0 - TOK POTOPA D OC OOPHA;
C   19         9       OMEG0 - OOPHA ACTOTA;
C   20        10       OMEGA - OBA CKOPOCT POTOPA;
C   21        11       GAMMA - O ME CTATOP.  POTOP. AA "A";
C   22        12       S - CKOEHE;
C------------------------
C   14 *--* 22 - TO E  T = TN+H0;
C   23, 24, 25 -  P E  E P B;
C
C------------------------------------------------------
C
C
C          DGMAS  -  MACCB BECEHHX HAEHE HAPEH
C          *****                        PABEH B Q_D O.
C
C   COBO        OOHAEHE - HAEHE:
C   1          UYQ0    - P. HAP. O Q OC O. CCTEM;
C   2          UYD0      - P. HAP. O D OC O. CCTEM;
C   3          UYMOD     - MO BEKTOPA P. HAPEH;
C   4          I_S_D_ZAD - AAHHOE ISD;
C   5          S_ZAD     - AAHHOE CKOEHE;
C -----------------------------------------------------
C
C              INTMAS - MACCB  PEAA HTEPATOPOB,
C              ******  ( 5-T COB );
C INT(TOK)  INT(S) XPAHTC B TOKN/N1 #18  #19; ( EPBE 2-A COBA);
C
C  PSUB1 --->  BCET:
C  *****
C     UYD0 = [ URD00 - KI*INT(ISD0-ISDZAD) ]* ( KE+1 ) - KE*IRD0 * XAF;
C
C
C  UYQ0 = [URQ00 - KS *S - BETA*INT(S-SZAD) ]* ( KE+1 ) - KE*IRQ0 * XAF;
C
C  E:  INT - HTEPA;
C
C
C  PSUB2 --->  BCET:
C  *****
C     UYD0 = [ URD00 - KI*INT(ISD0-ISDZAD) ]* ( KE+1 ) - KE*IRD0;
C
C
C  UYQ0 = [URQ00 - KS *S - BETA*INT(S-SZAD) ]* ( KE+1 ) - KE*IRQ0;
C
C  E:  INT - HTEPA, A ISDZAD  SZAD - KCOHO-HEHA HK
C                                                     B P E M E H 
C                                                     *************
C
C
C   APAMETP:     MSW, RMSW - PABEE COBO COCTOH MAKPOMOE
C   ---------      ( "OTPEOK" MACCB MSWALL -> C.M. / GETMSW );
C                  YALL - MATPA P0BOMOCT AHAPEMO E;
C                  JALL - BEKTOP CTOHKOB TOKA AHAPEMO E;
C                  VALLN - BEKTOP OBX HAPEH AHAPEMO E:
C                          B T = TN;
C                  VALLN1- BEKTOP OBX HAPEH AHAPEMO E:
C                          B T = TN + H0;
C                  TOKN    TOKN1  -  HAEH "TOKOB" P T :=
C                                     TN    TN + H0;
C                                   PAMEPHOCT CM. MASPRT(46)=NNTOK;
C                  LOGYTR - BEKTOP PHAKOB K.. OB:
C                  COETC B MAKPOMOEX C PHAKOM TA = 5;
C                  PAMEPHOC MACCBOB P "ALL" OPEETC:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKA_PAMEPHOCT ---> NSYS = MASPRT(26)
C                  KOD - APAMETP OPATHO CB C MOHTOPOM DM....
C                   ( =1 P OO OK. OPEHOCT );
C                 MSWALL( (RMSWAL ) - BEC CCOK MSW_ALL,
C                 ADRMSW - APEC TEK. COAB MSW ( RMSW );
C
C
C
C
C   OPOPAMM:  1. COMMON PROF1, PROF2, PROF3;
C   ------------      DEPOST, CALL_PS --> B.  PSUB /;
C
C   PMEAHE:  1.CTPKTP MSW COBA MAKPOMOE AHHOO TA CM. HE
C   ----------   2. P ZAPROS ^=   1  2 - COOEHE  XO;
C
C              --->  OT 3.03.87 OP, P HE BK. APB KOPOBAHE
C              --->                    TOKN  B TOKN1
C              --->  PHA:  P "#CET" EPHA B TOKN1 (?)
C              ---> HO TO HA BM "BH",  HAC BCE O'KEY
C              --->          C T P A X O B K A !!!!!!!
C
C               "OCTOHHA" ACT MSW TA # 40:
C                --------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I PHAKI KO I KO. IAP.   IPE I
C  I EME I TA   I /    I TA   I ECT I BB. IHA.   IE I
C  I HTA   I MOE I PACETAI MOE I BO   I HA I"TOKN" IPB I
C  I       I        I DM.....I       .I OBI EH.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I  7    I 8 I
C  +-------+--------+--------+--------+------+------+-------+---+
C
C
C
C
C              OPMAT RMSW T # 40:
C              ---------------------
C+-----------I--------------I------I-----------------------------------
C  # COBA   I    # COBA B I KTO  I       OOHAEHE - HAEHE
C OT HAAA  I    OTPEKE   IOPE.I
C BCEO MSW  I    RMSW B    I      I
C OCAH   I    FM0010    I      I
C            I              I      I
C------------I--------------I------I-----------------------------------
C     9      I    -2        I      I HOMEP A KA ( AA A )
C    10      I    -1        I      I HOMEP A KB ( AA B )
C    11      I     0        I      I HOMEP A KC ( AA C )
C----------------------------------------------------------------------
C    12      I     1        I  DM  I  FQ - A HOBE HA. BCEH
C            I              I      I   (  CHXPO. MAKPO. P.TIP # 4
C    13      I     2        I  FM  I  NELT - HOMEP . PEP. . MA.
C    14      I     3        I  LM  I  AMOT - AP. B MSWALL OCAH
C            I              I      I         PE. . MAH
C    15      I     4        I  LM  I  APOT - APEC B MSWALL OB MAH
C    16      I     5        I  LM  I  ATOKM - AP B TOKN/N1 BEH,
C            I              I      I          PACT.  . MA.
C    17      I     6        I  FM  I  TBKL - BPEM, HAHA C KOTOPOO
C            I              I      I         BKAETC PETOP;
C    18,19   I     7,8      I      I  PEEPB.
C    20      I     9        I  FM  I  UPOT - OTOOHOE HAPEHE
C    21      I     10       I  FM  I  NSUB - HOMEP / OOBATE
C22,23,..,26 I11,12,13,14,15I      I  PA. MECTO  HT. 1  2 B TOKN/1
C  27        I    16        I  FM  I  NPAR - KO-BO APAMETPOB,
C            I              I      I         BBEEHHX B PSUB<..>
C OT 28 O   I OT 17 O     I FM   I  APAMETP PSUB, AAHHE
C 28 + NPAR  I 17 + NPAR    I      I  OOBATEEM
C            I              I      I
C----------------------------------------------------------------------
C
C  OA HA MSW --> LM<BC> = 28+NPAR
C
C  HA EPEMEH. ACT --> LM<RMSW> = 17+NPAR
C
C               "OCTOHHA" ACT MSW TA # 11, 110, 12, 120:
C                ----------------------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I PHAKI KO I KO. IAP.   IPE I
C  I EME I TA   I /    I TA   I ECT I BB. IHA.   IE I
C  I HTA   I MOE I PACETAI MOE I BO   I HA I"TOKN" IPB I
C  I       I        I DM.....I       .I OBI EH.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I  7    I 8 I
C  +-------+--------+--------+--------+------+------+-------+---+
C
C  +--------------------------------------------------------------+
C  I  OKEH S1N S2N S3N F1N F2N F3N S1K S2K F1K F2K F3K I
C  I           12-T COB: OT 9 O 20                             I
C  +--------------------------------------------------------------+
C
C              RMSW T # 11, 110, 12, 120 [ . MAHA 3X3X0 ] :
C              ************************************************
C
C  +--------+-----+------+------+-------+-------+-------+-------+-----+
C  I PEEPB I"DOM"I PARD I PARM I PARGY I PARG1 I PARJY I PARJ0 I TMASI
C  I 5-T   I  I      I      I       I       I       I       I     I
C  I  COB  IMEX. I 9-T I 9-T I 36-T I 36-T I 6-T  I 6-T  I NMASI
C  I        IP- I COB I COB I COB  I COB  I COB  I COB  I COBI
C  +--------+-----+------+------+-------+-------+-------+-------+-----+
C  I 21 - 25I 26  I27-35 I36-44 I45-80  I81-116 I117-122I123-128I129-@I
C  I        I     I      I      I       I       I       I       I     I
C  +--------+-----+------+------+-------+-------+-------+-------+-----+
C  +D1            +D2    +D3    +D4     +D5     +D6     +D7     +D8   +
C
C              @ - OPEEETC PAMEPOM MAS <...> ==> ...+ NMAS + 1
C
C
C
C
C      DATA D1, D2, D3, D4, D5, D6,  D7,  D8
C    =  /   21, 27, 36, 45, 81, 117, 123, 129 /
C
C--->  D@ -> HOMEPA OE B MSW_ALL MACCBA;
C
C
C     B MACCBE TOKN  TOKN1  . MAH COEPTC:
C     *************************************************
C    OT 1 O 6   - HAEH TOKOB A OMOTOK: S1 S2 S3 F2 F2 F3;
C
C       7        -  HAEHE GAMMA -> O OOEH POTOPA;
C
C       8        -  HAEHE OMEGA -> OBA ACTOTA BPAEH POTOPA
C                                     ( B OHOEPOHO MOE );
C       9        -  HAEHE MFT - . MA. MOMEHTA;
C
C      10        -  HAEHE M_BHE(T) - BHEH HAPOH MOMEHT;
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         DIMENSION MSWALL(*), RMSWAL(*)
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
         INTEGER ADRMSW
         REAL K2D3
         REAL JALL, JNEL, MAXITR
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( NNTOK,  MASPRT(46) )
         EQUIVALENCE ( NSYS,   MASPRT(26) )
         EQUIVALENCE ( NWTRE,  MASPRT(14) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( FITER,  MASPRT(65) )
         EQUIVALENCE ( EITER,  MASPRT(67) )
         EQUIVALENCE ( NLITER, MASPRT(79) )
         EQUIVALENCE ( MAXITR, MASPRT(80) )
         EQUIVALENCE ( NSITER, MASPRT(88) )
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         INTEGER FITER, TIP, ZAPROS
         REAL ISQ0N,  ISD0N,  IRQ0N,  IRD0N
         REAL ISQ0N1, ISD0N1, IRQ0N1, IRD0N1
         DIMENSION ULN(6), ULN1(6), STMAS(25), DGMAS(5)
         DATA K2D3 / 0.666667 /
         DATA KXALL, SQ3D2, R120, R240 /6, 0.8660254, 2.0944, 4.1888 /
       KOD = 0
C**********************************************************************
       TIP = MSW(2)
       IF ( TIP .EQ. 40 ) GO TO 9900
C
C######################################################################
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** O. CO B DM0014 - APOC HA OCBAHE O
     =O TA ***'/
     =    ' *** EMEHT # ', I10, ' T MOE # ', I10, ' ***'//)
         CALL SUBERR(0)
C
9900   CONTINUE
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
       TBKL = RMSW(17)
       TN1 = TN + H0
       IF ( TN1 .GT. TBKL )  GO TO  6666
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C-->  BCTABKA OT 03.03.87 (OP)
       IF ( ZAPROS .EQ. 1 ) RETURN
       ITOKX = MSW(07) - 1
       DO 6667 I=1,20
       TOKN1( ITOKX+I ) = TOKN( ITOKX+I )
6667   CONTINUE
       RETURN
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C-->  PETOP BKEH.....
C--->  BOP PEMA APOCA..
6666   GO TO( 100, 200), ZAPROS
C===> HAE OKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHTOP #', I4, ' APOC OCBAH OOEH
     = ***'/ ' *** ZAPROS = ', I5, ' - HOPPETC ***')
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C---- ZAPROS = 1 ------------------------------------------------------
100    CONTINUE
C-->
C==> CPOC AA       OCHOBHO PACET BOHEH;
       MSW(12) = 0
C
       RETURN
C######################################################################
200    CONTINUE
C-->  HHO  PAOTAT ?
       IF ( MSW(12) .EQ. 1 ) RETURN
C-->  PETC .............................
C-->  ZAPROS = 2 --> PACTAT HAEH....
C-->  ..
       KA = MSW(9)
       KB = MSW(10)
       KC = MSW(11)
C-->  AP. TOKA B TIP # 40
       ITOK = MSW(7)
C**********************************************************************
       IF ( KA .NE. 0 ) GO TO 105
C-->  OMEG0 -> OOPHA  PABHA 314.15927, AA 0.0===>
       OMEG0 = 314.15927
C-->  O.....
C$$$$$$COPN = COS(OMEG0*TN   )
C$$$$$$SOPN = SIN(OMEG0*TN   )
C
       COPN1 = COS(OMEG0*TN1 )
       SOPN1 = SIN(OMEG0*TN1 )
C
       GO TO 106
C----------------------------------------------------------------------
105    CONTINUE
C-->  OOP. ACTOTA
       VAN = 0.0
       VBN = 0.0
       VCN = 0.0
C
       VAN1 = 0.0
       VBN1 = 0.0
       VCN1 = 0.0
C
       IF ( KA .EQ. 0 ) GO TO 101
       VAN = VALLN(KA)
       VAN1 = VALLN1(KA)
101    CONTINUE
       IF ( KB .EQ. 0 ) GO TO 102
       VBN = VALLN(KB)
       VBN1 = VALLN1(KB)
102    CONTINUE
       IF ( KC .EQ. 0 ) GO TO 103
       VCN = VALLN(KC)
       VCN1 = VALLN1(KC)
103    CONTINUE
C-->  PAOEHE O OCM X,Y( CBAH CO CTATOPOM ):
       VXN = K2D3*(  VAN - ( VBN + VCN ) / 2.0       )
       VXN1 = K2D3*(   VAN1 - ( VBN1 + VCN1 ) / 2.0  )
C
       VYN = K2D3*(  SQ3D2 * ( VBN - VCN )    )
       VYN1 = K2D3*( SQ3D2 * ( VBN1 - VCN1 )  )
C-->  MO B      TN1
       VXYN1 = SQRT(VXN1**2+VYN1**2)
C----------------------------------------------------------------------
C-->  OMEA_OOPHA
       OMEG0 = 314.15927
       COPN1 = 1.0
       SOPN1 = 0.0
       IF ( VXYN1 .EQ. 0.0 ) GO TO 106
       XXX = H0 * VXYN1
       IF ( XXX .EQ. 0.0 ) GO TO 104
       D2X = ( VXN1 - VXN ) ** 2
       D2Y = ( VYN1 - VYN ) ** 2
       YYY = SQRT ( D2X + D2Y )
       OMEG0 = YYY / XXX
104    CONTINUE
C-->  COS  &  SIN A....
       COPN1 = VXN1 / VXYN1
       SOPN1 = VYN1 / VXYN1
C----------------------------------------------------------------------
106    CONTINUE
       TOKN1( ITOK+3) = OMEG0
C-->  CKOEHE, OMEGA -  MOE . MAH
       ITOKM = MSW(16)
C-->  CTAP & HOB
       OMEGN = TOKN( ITOKM+7 )
       OMEGN1 = TOKN1( ITOKM+7 )
C--    CKOEHE BCM, A HE BEPEM  TOKN
       SN = ( OMEGN - OMEG0 ) / OMEG0
       SN1 = ( OMEGN1 - OMEG0 ) / OMEG0
C-->  EO KCPEM
       TOKN1( ITOK+4) = SN1
C
C-->  POEK HHA CHXPOHHE ( OH OPEHTP. O BEKTOP U_O.
C
C-->  AP. OB MAH
       IXV1 = MSW(15) - 1
       IXV2 = IXV1 + KXALL
       DO 201 I = 1, KXALL
       K = MSWALL( IXV1 + I )
       M = MSWALL( IXV2 + I )
C$$$$$$VKN = 0.0
C$$$$$$VMN = 0.0
       VKN1 = 0.0
       VMN1 = 0.0
       IF ( K .EQ. 0 ) GO TO 202
C$$$$$$VKN = VALLN(K)
       VKN1 = VALLN1(K)
202    CONTINUE
       IF ( M .EQ. 0 ) GO TO 203
C$$$$$$VMN = VALLN(M)
       VMN1 = VALLN1(M)
203    CONTINUE
C$$$$$$ULN(I) = VKN - VMN
       ULN1(I) = VKN1 - VMN1
201    CONTINUE
C-->  TOK CTATOPA  POTOPA
C$$$$$$TS1N  = TOKN ( ITOKM )
C$$$$$$TS2N  = TOKN ( ITOKM  + 1 )
C$$$$$$TS3N  = TOKN ( ITOKM  + 2 )
C$$$$$$TR1N  = TOKN ( ITOKM  + 3 )
C$$$$$$TR2N  = TOKN ( ITOKM  + 4 )
C$$$$$$TR3N  = TOKN ( ITOKM  + 5 )
       GAMN  = TOKN ( ITOKM  + 6 )
C->
       TS1N1 = TOKN1( ITOKM )
       TS2N1 = TOKN1( ITOKM  + 1 )
       TS3N1 = TOKN1( ITOKM  + 2 )
       TR1N1 = TOKN1( ITOKM  + 3 )
       TR2N1 = TOKN1( ITOKM  + 4 )
       TR3N1 = TOKN1( ITOKM  + 5 )
       GAMN1 = TOKN1( ITOKM  + 6 )
C->
C-->  X POEK...
C$$$$$$USXXN  = ULN (1) - ( ULN (2) + ULN (3) ) /2.0
C$$$$$$USYYN  = SQ3D2 * ( ULN (2) - ULN (3) )
C-->
C$$$$$$USQ0N  = COPN  * USXXN  + SOPN  * USYYN
C$$$$$$USD0N  = COPN  * USYYN  - SOPN  * USXXN
C
C
       USXXN1 = K2D3*(  ULN1(1) - ( ULN1(2) + ULN1(3) ) /2.0   )
       USYYN1 = K2D3*(  SQ3D2 * ( ULN1(2) - ULN1(3) )          )
C-->
       USQ0N1 = COPN1 * USXXN1 + SOPN1 * USYYN1
       USD0N1 = COPN1 * USYYN1 - SOPN1 * USXXN1
C-->  TOK..
C$$$$$$TSXXN  = TS1N  - ( TS2N  + TS3N  ) / 2.0
C$$$$$$TSYYN  = SQ3D2 * ( TS2N  - TS3N  )
C*
C$$$$$$ISQ0N  = COPN  *TSXXN  + SOPN  * TSYYN
C$$$$$$ISD0N  = COPN  *TSYYN  - SOPN  * TSXXN
C--> B TN1...
       TSXXN1 = K2D3*(    TS1N1 - ( TS2N1 + TS3N1 ) / 2.0         )
       TSYYN1 = K2D3*(    SQ3D2 * ( TS2N1 - TS3N1 )               )
C*
       ISQ0N1 = COPN1 *TSXXN1 + SOPN1 * TSYYN1
       ISD0N1 = COPN1 *TSYYN1 - SOPN1 * TSXXN1
C
C-->  POTOPHE BEH--->
C$$$$$$CR1N  = COS(GAMN  )
C$$$$$$CR2N  = COS(GAMN  + R120 )
C$$$$$$CR3N  = COS(GAMN  + R240 )
C
C$$$$$$SR1N  = SIN(GAMN  )
C$$$$$$SR2N  = SIN(GAMN  + R120 )
C$$$$$$SR3N  = SIN(GAMN  + R240 )
C-->  B TN1
       CR1N1 = COS(GAMN1 )
       CR2N1 = COS(GAMN1 + R120 )
       CR3N1 = COS(GAMN1 + R240 )
C
       SR1N1 = SIN(GAMN1 )
       SR2N1 = SIN(GAMN1 + R120 )
       SR3N1 = SIN(GAMN1 + R240 )
C***
C->  HAPEH...
C$$$$$$SRXXN  = ULN (4)*CR1N  + ULN (5)*CR2N  + ULN (6)*CR3N
C$$$$$$SRYYN  = ULN (4)*SR1N  + ULN (5)*SR2N  + ULN (6)*SR3N
C
C$$$$$$URQ0N  = COPN  * SRXXN  +  SOPN  * SRYYN
C$$$$$$URD0N  = COPN  * SRYYN  -  SOPN  * SRXXN
C--->  B TOKE N1..
       SRXXN1 = K2D3*( ULN1(4)*CR1N1 + ULN1(5)*CR2N1 + ULN1(6)*CR3N1 )
       SRYYN1 = K2D3*( ULN1(4)*SR1N1 + ULN1(5)*SR2N1 + ULN1(6)*SR3N1 )
C
       URQ0N1 = COPN1 * SRXXN1 +  SOPN1 * SRYYN1
       URD0N1 = COPN1 * SRYYN1 -  SOPN1 * SRXXN1
C-->
C-->  TOK POTOPA...
C$$$$$$SRXXN  = TR1N  * CR1N  + TR2N  * CR2N  + TR3N  * CR3N
C$$$$$$SRYYN  = TR1N  * SR1N  + TR2N  * SR2N  + TR3N  * SR3N
C-->
C$$$$$$IRQ0N  = COPN  * SRXXN  + SOPN  * SRYYN
C$$$$$$IRD0N  = COPN  * SRYYN  - SOPN  * SRXXN
C--->  B TN1
       SRXXN1 = K2D3*( TR1N1 * CR1N1 + TR2N1 * CR2N1 + TR3N1 * CR3N1 )
       SRYYN1 = K2D3*( TR1N1 * SR1N1 + TR2N1 * SR2N1 + TR3N1 * SR3N1 )
C-->
       IRQ0N1 = COPN1 * SRXXN1 + SOPN1 * SRYYN1
       IRD0N1 = COPN1 * SRYYN1 - SOPN1 * SRXXN1
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C-->  AC B TOKN1(**)
       TOKN1(ITOK + 7 ) = USQ0N1
       TOKN1(ITOK + 8 ) = USD0N1
       TOKN1(ITOK + 9 ) = ISQ0N1
       TOKN1(ITOK + 10) = ISD0N1
       TOKN1(ITOK + 11) = URQ0N1
       TOKN1(ITOK + 12) = URD0N1
       TOKN1(ITOK + 13) = IRQ0N1
       TOKN1(ITOK + 14) = IRD0N1
C----------------------------------------------------------------------
C-->  HAEH TOK...B TN    TOKN
C
       USQ0N  =  TOKN( ITOK  +  7 )
       USD0N  =  TOKN( ITOK  +  8 )
       ISQ0N  =  TOKN( ITOK  +  9 )
       ISD0N  =  TOKN( ITOK  + 10 )
       URQ0N  =  TOKN( ITOK  + 11 )
       URD0N  =  TOKN( ITOK  + 12 )
       IRQ0N  =  TOKN( ITOK  + 13 )
       IRD0N  =  TOKN( ITOK  + 14 )
C----------------------------------------------------------------------
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C----------------------------------------------------------------------
C
C BCE B POEK HA OOPH CCTEM OPEEEHO, MOHO
C  OPMPOBAT P. HAPEH --->  EPE PSUB#
C
C  OP-EM  PSUB _ MACCB:
       STMAS(1) = TN
       STMAS(2) = H0
C*********************
       STMAS( 3) = ISQ0N
       STMAS( 4) = ISD0N
       STMAS( 5) = USQ0N
       STMAS( 6) = USD0N
       STMAS( 7) = IRQ0N
       STMAS( 8) = IRD0N
       STMAS( 9) = OMEG0
       STMAS(10) = OMEGN
       STMAS(11) = GAMN
       STMAS(12) = SN
C*********************
       STMAS(13) = ISQ0N1
       STMAS(14) = ISD0N1
       STMAS(15) = USQ0N1
       STMAS(16) = USD0N1
       STMAS(17) = IRQ0N1
       STMAS(18) = IRD0N1
       STMAS(19) = OMEG0
       STMAS(20) = OMEGN1
       STMAS(21) = GAMN1
       STMAS(22) = SN1
C**
C-->  OM P. HAPEH...
       NSUB = MSW(21)
       NEL = MSW(1)
C-->  URMAS <-> MSW(27),  INTMAS <-> MSW(22)
C                        HO 1  2-E HAEHE B TOKN/TOKN1 XPAHM;
       RMSW(22) = TOKN( ITOK + 17 )
       RMSW(23) = TOKN( ITOK + 18 )
C
       CALL CALLPS( NSUB, NEL, MSW(27), STMAS, DGMAS, MSW(22) )
C-->  X KCPEM
       TOKN1( ITOK + 5 ) = DGMAS(1)
       TOKN1(  ITOK + 6 ) = DGMAS(2)
C==> KCPEM HTEPATOP-->  AAHHE HAEH TOK  CKOEH
       TOKN1( ITOK + 15 ) = DGMAS(4)
       TOKN1( ITOK + 16 ) = DGMAS(5)
       TOKN1( ITOK + 17 ) = RMSW(22)
       TOKN1( ITOK + 18 ) = RMSW(23)
C
       UYQ0 = DGMAS(1)
       UYD0 = DGMAS(2)
C******UYMOD = DGMAS(3)
C**** POEK OT 25.09.86....
C       A  A     "A" ---->
       UYR1 =        ( UYQ0 * ( CR1N1*COPN1 + SR1N1*SOPN1 )  +
     +                 UYD0 * ( SR1N1*COPN1 - SOPN1*CR1N1 )       )
C       A  A     "B" ---->
       UYR2 =        ( UYQ0 * ( CR2N1*COPN1 + SR2N1*SOPN1 )  +
     +                 UYD0 * ( SR2N1*COPN1 - SOPN1*CR2N1 )       )
C       A  A     "C" ---->
       UYR3 =        ( UYQ0 * ( CR3N1*COPN1 + SR3N1*SOPN1 )  +
     +                 UYD0 * ( SR3N1*COPN1 - SOPN1*CR3N1 )       )
C######################################################################
C
C   OPAHEHE O AMTE.....
C
C######################################################################
       UPOT = RMSW(20)
C
       IF ( UYR1 .GT. 0.0  .AND.  UYR1 .GT. UPOT ) UYR1 = UPOT
       IF ( UYR2 .GT. 0.0  .AND.  UYR2 .GT. UPOT ) UYR2 = UPOT
       IF ( UYR3 .GT. 0.0  .AND.  UYR3 .GT. UPOT ) UYR3 = UPOT
C
       IF ( UYR1 .LT. 0.0  .AND . UYR1 .LT. -UPOT ) UYR1 = -UPOT
       IF ( UYR2 .LT. 0.0  .AND . UYR2 .LT. -UPOT ) UYR2 = -UPOT
       IF ( UYR3 .LT. 0.0  .AND . UYR3 .LT. -UPOT ) UYR3 = -UPOT
C -->  AC B TOKN1
       TOKN1( ITOK )  =    UYR1
       TOKN1( ITOK +1 ) =  UYR2
       TOKN1( ITOK +2 ) =  UYR3
C-->  AKCP. KOHE BCEH       ( FQ A )
       MSW(12) = 1
C----->KOD = 0
       RETURN
       END
