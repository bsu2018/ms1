         SUBROUTINE DM0016 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                         MSWALL, RMSWAL, ADRMSW )
CXXX----KOMèãEKC "MS1" --> BEPCàü 1.0  (OT ÑEKAÅPü 1986 É.)------------
C   èOÑèPOÉPAMMA:  DM0016 ( MSW, RMSW, YALL, JALL, LOGYTR,
C   ------------             TOKN, TOKN1, VALLN, VALLN1, KOD,
C    *                         MSWALL, RMSWAL, ADRMSW )
C
C   HAáHAóEHàE:    B áABàCàMOCTà OT áHAóEHàü îãAÉA ZAPROS [MASPRT(28)]:
C   -----------    BõèOãHüET CãEÑìûôàE îìHKñàà:
C
C                  A) ZAPROS = 1
C                     ----------
C                  îOPMàPOBAHàE BKãAÑOB B YALL MATPàñì èPOBOÑàMOCTEâ à
C                  JALL - BEKTOP àCTOóHàKOB TOKA áHAóEHàâ èAPAMETPOB
C                  ùKBàBAãEHTHõX  G - J BETBEâ  MOÑEãà ùãEMEHTA ñEèà
C                  Tàè     àMü MOÑEãà     OÅOáHAóEHàü B ÑAãúHEâòEM
C
C                  63      3-X îAáHAü ù.Ñ.C        ES3
C                              CàHìCOàÑAãúHOü
C
C
C              ùãEMEHT KOÑàPìETCü:
C              -------------------
C
C              ù # T 63 ì K0 KA KB KC è R EMAX OMEGA FAZ0;
C
C     K0 - OÅôàâ ìáEã, KA - îAáA A, KB - îAáA B, KC - îAáA C;
C
C---> BõBOÑHõE áHAóEHàü: TOKà: K ìáãAM KA, KB, KC, OT ìáãA K0;
C                              *                   **
C
C
C                  13      "àáMEPàTEãú"
C                           HAèPüÜEHàü             V3
C
C
C              ùãEMEHT KOÑàPìETCü:
C              -------------------
C
C              ù # T 13 ì K1 K2 K3;
C
C   B CèàCOK BõóECãEHHõX áHAóEHàâ èOMEôAET HAèPüÜEHàE ìáãOB K1, K2, K3,
C   áATEM -> V_MOD, ìÉOã OTHOC. îAáõ "A", V_X HA "A" èPOEKñàü, à
C            V_Y HA "A"+90ÉPAÑ. èPOEKñàü, ìÉãOBAü CKOPOCTú BPAôEHàü
C                                         BEKTOPA V_MOD;
C                      !!! èPà V_MOD = 0.0 ---> OMEGA = 314.15927 !!!!
C
C                     èEPEXOÑ OT 3-X K 2-M C ìóETOM KOùî. 2/3     !!!!!
C
C                  ***************************************************
C                  B) ZAPROS = 2
C                     ----------
C                  BõóàCãEHàE áHAóEHàâ TOKOB B BETBüX B T(N+1) MOMEHT
C                  BPEMEHà   àCXOÑü àá G à J èAPAMETPOB à áHAóEHàü
C                  ìáãOBõX HAèPüÜEHàâ HA ùãEMEHTE PACóàTAHHõX Ñãü T(N+1)
C                    à áAèàCú (îàKCAñàü) ùTàX áHAóEHàâ B "TOK T(N+1)";
C
C              Ñãü MOÑEãà # 13 -->  èEPEáAèàCú àá VALLN1 B TOKN1
C              -------------------------------------------------
C              + BõóàCãEHàE PAáãOÜEHàü 3-X îAáHOâ CàCTEMõ, CóàTAü -->
C              V(K1) - îAáA A; V(K2) - îAáA B; V(K3) - îAáA C;
C                  C) ZAPROS = 3
C                     **********
C                     HE èOÑÑEPÜàBAETCü ( PEáEPB );
C
C                  D) ZAPROS = 4
C                     **********
C                     HE èOÑÑEPÜàBAETCü;
C
C   METOÑ:         ÑàCKPETàáAñàü ìPABHEHàâ COCTOüHàü MOÑEãà ÑAHHOÉO
C   -----          TàèA HA OCHOBE METOÑA ãàHàÑÜEPA BàOãìÉÅà:
C                  Y(N+1) = Y(N) + H1*F(N+1) + H2*F(N).
C
C   èAPAMETPõ:     MSW, RMSW - ìèPABãüûôEE CãOBO COCTOüHàü MAKPOMOÑEãà
C   ---------      ( "OTPEáOK" MACCàBõ MSWALL -> C.M. è/è GETMSW );
C                  YALL - MATPàñA èP0BOÑàMOCTà AHAãàáàPìEMOâ ñEèà;
C                  JALL - BEKTOP àCTOóHàKOB TOKA AHAãàáàPìEMOâ ñEèà;
C                  VALLN - BEKTOP ìáãOBõX HAèPüÜEHàâ AHAãàáàPìEMOâ ñEèà:
C                          èPà  T  =  TN;
C                  VALLN1- BEKTOP ìáãOBõX HAèPüÜEHàâ AHAãàáàPìEMOâ ñEèà:
C                           èPà  T  =  TN  + H0;
C                  TOKN  à  TOKN1 - BEKTOPA èEPEMEHHõX "COCTOüHàü"
C                                   ùãEMEHTA èPà  TN  à  TN + H0;
C                                   PAáMEPHOCTà CM. MASPRT(46)=NNTOK;
C                  LOGYTR - BEKTOP èPàáHAKOB K.á. ìáãOB:
C                  àCèOãúáìETCü B MAKPOMOÑEãüX C èPàáHAKOM TàèA = 5;
C                  PAáMEPHOCà MACCàBOB ÉPìèèõ "ALL" OèPEÑEãüûTCü:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKìôAü_PAáMEPHOCTú ---> NSYS = MASPRT(26)
C                  KOD - èAPAMETP OÅPATHOâ CBüáà C MOHàTOPOM DM....
C
C
C
C
C   èOÑèPOÉPAMMõ:  1. COMMON PROF1, PROF2, PROF3;
C   ------------             DEPOST;
C
C   èPàMEóAHàE:  1.CTPìKTìPì MSW CãOBA MAKPOMOÑEãà ÑAHHOÉO TàèA CM. HàÜE
C   ----------   2. èPà ZAPROS ^=   1  àãà 2 - COOÅôEHàE à ìXOÑ;
C
C
C               "èOCTOüHHAü" óACTú MSW TàèA # 63 à #13
C                --------------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I  èPàá. I KOãà I KOã. IAÑP.   IPE I
C  I ùãEME I TàèA   I è/è    I  TàèA  I óECT I BõB. IáHAó.  IáE I
C  I HTA   I MOÑEãà I PACóETAI  MOÑEãàI BO   I áHAó I"TOKN" IPB I
C  I       I        I DM.....I        I ìáãOBI EHàâ.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I   7   I 8 I
C  +-------+--------+--------+--------+------+------+-----------+
C
C
C
C                RMSW TàèA # 63 [ àCTOóHàK SIN HAèPüÜEHàü - 3-ú îAáHõâ
C                -----------------------------------------------------
C
C
C                    ( U1 = EM * SIN( OMEGA * T  +  FAZ0 )     LM = 8
C                    ( U2 = EM * SIN( OMEGA * T  +  FAZ0 - 120 )
C                    ( U3 = EM * SIN( OMEGA * T  +  FAZ0 + 120 )
C                             SPM                 SRAB
C             ++--------+------+--------+------++------+---+---+-----+
C             II áHAó.  I áHAó.I        I FAZ0 II      IJESIJESI PE  I
C   ìáãõ:     II  1/R   I EM/R I OMEGA  I  P   II JESA I   I   I áE  I
C  K0         II        I      I        I PAÑ. II      I B I C I PB  I
C    K1       ++--------+------+--------+------++------+---+---+-----+
C      K2     II   1    I  2   I   3    I  4   II  5   I 6 I 7 I  8  I
C         K3  ++--------+------+--------+------++------+---+---+-----+
C  9 10 11 12 II  13    I  14  I  15    I  16  II  17  I18 I19 I 20  I
C             ++--------+------+--------+------++------+---+---+-----+
C
C
C
C
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         REAL JALL, JESA, JESB, JESC
         REAL K2D3
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( NDALL,  MASPRT(23) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( FKOM,   MASPRT(34) )
         EQUIVALENCE ( TXG,    MASPRT(35) )
         EQUIVALENCE ( NTXG,   MASPRT(36) )
         EQUIVALENCE ( EPSKOM, MASPRT(39) )
         DIMENSION MSWALL(*), RMSWAL(*)
         INTEGER ADRMSW, TIP
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         INTEGER FKOM, ZAPROS
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
C
         DATA R120/ 2.0944/, SQ3D2/ 0.8660254 /, PI2/6.283185306/
         DATA RGRAD / 57.29577 /
         DATA K2D3/0.666667 /
C
       KOD = 0
       TIP = MSW(2)
       IF ( TIP .EQ. 13  .OR.  TIP .EQ. 63 ) GO TO 10
C----------------------------------------------------------------------
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** ãOÉ. CÅOâ B DM0016 - áAèPOC HA OÅCãìÜàBAHàE óìÜOÉ
     =O TàèA ***'/
     =    ' *** ùãEMEHT # ', I10, ' Tàè MOÑEãà # ', I10, ' ***'//)
         CALL SUBERR(0)
C----------------------------------------------------------------------
10     CONTINUE
C---> BõÅOP PEÜàMA:
         GO TO ( 667, 666                 ), ZAPROS
C===> àHAóE OòàÅKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHàTOP #', I4, ' áAèPOC OÅCãìÜàBAHàü OòàÅOóEH
     = ***'/ ' *** ZAPROS = ', I5, ' - àÉHOPàPìETCü ***')
         RETURN
667      CONTINUE
C---------ZAPROS = 1---------------------------------------------------
C
       IF ( TIP .EQ. 13 ) RETURN
C
C--->   èOùãEMEHTHõâ BKãAÑ:    -->>  Ñãü  E_SIN_3
C==> "HOBOE" BPEMü   ( ÑA, ìÜ.... )
         TN1 = TN + H0
         GES = RMSW(13)
         JESA = RMSW(14) * SIN( RMSW(15) * TN1 + RMSW(16)  )
         JESB = RMSW(14) * SIN( RMSW(15) * TN1 + RMSW(16) - R120 )
         JESC = RMSW(14) * SIN( RMSW(15) * TN1 + RMSW(16) + R120 )
         RMSW(17) = JESA
         RMSW(18) = JESB
         RMSW(19) = JESC
C---->
C======================================================================
C-->  ìáãõ*******
       K0 = MSW(9)
       KA = MSW(10)
       KB = MSW(11)
       KC = MSW(12)
C---->
         CALL DEPOST( K0, KA, GES, JESA, YALL, JALL )
         CALL DEPOST( K0, KB, GES, JESB, YALL, JALL )
         CALL DEPOST( K0, KC, GES, JESC, YALL, JALL )
C---->
         RETURN
C======================================================================
C$$$$$$$$$$$$$$$$$$$ZAPROS = 2$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
666      CONTINUE
C
       IF ( TIP .EQ. 13 ) GO TO 777
C
C-->  ìáãõ*******
       K0 = MSW(9)
       KA = MSW(10)
       KB = MSW(11)
       KC = MSW(12)
C---->
C--->     HOBEâòEE BPEMü...        TN + H0 => Ñãü HEÉO JES OèPEÑEãEHO!!!
         JESA = RMSW(17)
         JESB = RMSW(18)
         JESC = RMSW(19)
C--->  HOBõâ TOK:
         V0 = 0.0
         IF ( K0 .NE. 0 ) V0 = VALLN1(K0)
         VA = 0.0
         IF ( KA .NE. 0 ) VA = VALLN1(KA)
         VB = 0.0
         IF ( KB .NE. 0 ) VB = VALLN1(KB)
         VC = 0.0
         IF ( KC .NE. 0 ) VC = VALLN1(KC)
C-->
         TOK1 = RMSW(13) * (V0-VA)  + JESA
         TOK2 = RMSW(13) * (V0-VB)  + JESB
         TOK3 = RMSW(13) * (V0-VC)  + JESC
C--
       TOK0 = TOK1 + TOK2 + TOK3
C-->
C--->     áAèàCú TOKOB
         ITOK = MSW(7)
         TOKN1( ITOK ) = TOK1
         TOKN1( ITOK + 1 ) = TOK2
         TOKN1( ITOK + 2 ) = TOK3
         TOKN1( ITOK + 3 ) = TOK0
C----------------------------------------------------------------------
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
777    CONTINUE
       VA = 0.0
       VB = 0.0
       VC = 0.0
C
       KA =  MSW(9)
       KB =  MSW(10)
       KC =  MSW(11)
C
       IF ( KA .NE. 0 ) VA = VALLN1( KA )
       IF ( KB .NE. 0 ) VB = VALLN1( KB )
       IF ( KC .NE. 0 ) VC = VALLN1( KC )
C
       ITOK = MSW(7)
C
       TOKN1( ITOK    ) = VA
       TOKN1( ITOK +1 ) = VB
       TOKN1( ITOK +2 ) = VC
C
C-->  PAáãOÜEHàE BEKTOPOB HA OCà "A" à "A+90ÉPAÑ." --> X, Y;
C
       VX = K2D3 *(  VA - ( VB+VC )/2.    )
       VY = K2D3 *(  SQ3D2 * ( VB - VC )  )
C
       VXYMOD = SQRT( VX**2 + VY**2 )
       GVXY = ATAN2( VY, VX )
       IF ( VY .LT. 0.0 ) GVXY = GVXY + PI2
       IF ( GVXY .GE. PI2 ) GVXY = GVXY - INT( GVXY/PI2 ) * PI2
C-->  B TOKN1
       TOKN1( ITOK + 3 ) =  VXYMOD
       TOKN1( ITOK + 4 ) =  GVXY * RGRAD
       TOKN1( ITOK + 5 ) =  VX
       TOKN1( ITOK + 6 ) =  VY
C-->  BõóàCãEHàE OMEGA BPAôEHàü-->
       VXOLD = TOKN( ITOK + 5 )
       VYOLD = TOKN( ITOK + 6 )
C******VXYOLD = TOKN( ITOK + 3 )
       OMEGA = 314.15927
       XXX = H0 * VXYMOD
       IF ( XXX .EQ. 0.0 ) GO TO 778
       YYY = SQRT( (VX - VYOLD)**2  + (VY - VYOLD)**2 )
       OMEGA = YYY / XXX
778    CONTINUE
       TOKN1( ITOK + 7 ) = OMEGA
C-->
       RETURN
       END
