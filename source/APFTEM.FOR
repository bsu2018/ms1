         SUBROUTINE APFTEM ( KAR, KSIM, SIM, RSIM, ER, IER )
CXXX ---KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)------------
C      OPOPAMMA: APFTEM ( KAR, KSIM, SIM, RSIM, ER, IER )
C      -------------
C      HAHAEHE:   HAAHOE CKAHPOBAHE TEKCTA  PEBAPTEHOE
C      -----------    BEEHE TEPMOB  COBX KOHCTAHT E HAKA
C                      MACCBA KAR ( A-KO )  OPMPOBAHE MACCBA
C                     SIM ( F-KO ) O OEHHM TEPMAM  KAR;
C                     KCA PX OOK B OCAH BPAEH.
C
C      METO:        OCK, BEEHE APM. BPAEH  AKOBKA
C      -----         EHTKATOPOB B SIM. P TOM:
C                    "C. CMBO" - PECTABEH CBOM F-KOAM, HO
C                                      C OPATHM HAKAM, T.E. < 0;
C                    "EHTKATOP" - PECTABEH OHO OE B
C                                       SIM B CATOM F-KOE. P TOM
C                                       COTC EPBE ETPE
C                                       CMBOA, OCTAHE HOPPT-
C                                       C.  HAEHE BCEA > 0.
C                    "COBE
C                     KOHCTAHT" - PECTABEH B MACCBE SIM
C                                  BM OCEOBATEHM CAM
C                                  HEM  HAEHEM KOHCTAHT B
C                                  PECTABEH REAL*4.
C                                  T.E. B HAAE 0, ATEM AEHE > 0.
C
C      APAMETP:  KAR - MACCB CTPOK B A-KOE ( PAMEPHOCT >= 72 ),
C      ----------        COEPA CXOH  PAOPA TEKCT.
C                         T INTEGER*4;
C                   KSIM - KOECTBO AHTX O B MACCBE SIM,
C                          ( <= 100 ), INTEGER*4;
C                   SIM - MACCB TEPMOB B F-KOE ( PAMEPHOCT >=100 ).
C                          CM. METO, INTEGER*4 + REAL*4;
C                   RSIM - TOT E MACCB TO  SIM, HO OCAH
C                           B BBAE POPAMME KAK REAL*4;
C                            P BOBE APFTEM KAAT:
C                           CALL APFTEM ( KAR, KSIM, SIM, SIM, ER,IER)
C                                                         ----
C
C                   ER  -  MACCB PAMETK OOK ( 80 CMBOOB )
C                           B A - KOE; INTEGER*4.
C                   IER - KOECTBO OOK; P = 0 B MACCBE ER
C                         HAXOTC POE B A-KOE;
C                           T: INTEGER*4;
C      OPOPAMM: APFTRT, APFSQE, APFPAK; ( COMMON PRINTN );
C      ------------
C      PMEAHE: 1.   KAR BPAETC K72 = 72 EPBX CMBOOB;
C      ----------- 2.   B C E      POE HOPPTC;
C                       *****
CZZZ ------------------------------------------------------------------
C!!!-------------------------------------------------------------------
       COMMON /PRINTN/ NW6
C!!!-------------------------------------------------------------------
       DIMENSION KAR(1), SIM(1), RSIM(1), ER(1), FCAR(4)
       INTEGER KAR, SIM, ER, FLAG, FCAR
C------EQUIVALENCE ( RSIM(1),  SIM(1) )--------------------------------
       DATA K72 / 72 /
C EPEEM B F-KO:
       CALL APFTRT ( 1, K72, KAR, KAR )
C HAA:
       IK=1
       IS=1
       FLAG=0
       IER=0
C B ER POE B F=KOE:
       DO 100 J=1,80
100    ER(J)=11
C   CKAHPEM KAR, BPAEM:
2      CONTINUE
C   POE ? --> 30  *** 01.02.86 ***
       IF ( KAR(IK) .EQ. 11 ) GO TO 30
C  CEHE HAK ?  ---> 4
       IF ( KAR(IK) .GE. 12  .AND. KAR(IK)  .LE. 26 ) GO TO 4
C  HBAHO, <.>  <E> ? ---> 5  / <E> OKPOBAHO /
       IF ( KAR(IK) .EQ. 27                        ) GO TO 5
C  P ? ---> 6
       IF ( KAR(IK) .GE. 1  .AND. KAR(IK) .LE. 10 ) GO TO 6
C  KB ? ---> 7
       IF ( KAR(IK) .GE. 35  .AND. KAR(IK) .LE.  83 ) GO TO 7
C====== OOHTEHE CEHE CMBO ---> 4  / 01.02.86 /
       IF ( KAR(IK) .GE. 28  .AND. KAR(IK) .LE. 34 ) GO TO 4
C  HAE BHA OKA, OPAOTAT EE:
8      IER = IER + 1
C  ACAT "-" $
       ER(IK) = 37
       FLAG = 0
       GO TO 3
C----------------------------------------------------------------------
C----------------------------------------------------------------------
C----------------------------------------------------------------------
C  OAETC PA,  POOEHE EHTKATOPA
6      CONTINUE
       IF ( FLAG .EQ. 1 ) GO TO 7
C  <.>, <E>, <PA> - EPEKOPOBAT KOHCTAHT
5       CONTINUE
C   HHO  BTOKHT EHTKATOP
       IF ( FLAG .EQ. 0 ) GO TO 9
C   BTOKHT FCAR
       FLAG = 0
C   AKOBAT
       CALL APF PAK ( 1, IDKOD, FCAR )
       SIM(IS) = IDKOD
       IS = IS + 1
C   PHT KOHCTAHT
9      N1 = IK
       N2 = K72 - IK + 1
       CALL APF SQE ( KAR, E0, N1, N2, IF1 )
       GO TO ( 11, 11,   11,   10, 10, 10 ), IF1
10     CONTINUE
C!!!-------------------------------------------------------------------
       WRITE(NW6,12) IF1, N1, N2, IK, IS
12     FORMAT(' ***** CO B AOPTME APFTEM: IF1 =',I6,
     *        ' N1=',I6,' N2=',I6, ' IK=',I3,' IS=',I4)
C!!!-------------------------------------------------------------------
       CALL SUBERR(1)
C====>
C====>
C====>
C====>
C====>
C  ACAT KOHCTAHT
11     SIM(IS) = 0
       RSIM(IS + 1) = E0
       IS = IS + 2
C  KOPPEKTPEM C..K. IK  POOAEM
       IK = N1 - 1
       GO TO ( 3, 3, 8 ), IF1
C!!!-------------------------------------------------------------------
       GO TO 10
C!!!-------------------------------------------------------------------
C  PHT CEH HAK
4      CONTINUE
C   BTOKHT FCAR, EC HEOXOMO
       IF ( FLAG .EQ. 0 ) GO TO 13
       FLAG = 0
       CALL APF PAK ( 1, IDKOD, FCAR )
       SIM(IS) = IDKOD
       IS = IS + 1
C
13     SIM(IS) = -KAR(IK)
       IS = IS + 1
       GO TO 3
C   OPAOTKA EHTKATOPA
7      CONTINUE
       IF ( FLAG .EQ. 1 ) GO TO 14
C  EPB BXO: HAAO EHTKATOPA
       FLAG = 1
       IC = 1
       FCAR(1) = 11
       FCAR(2) = 11
       FCAR(3) = 11
       FCAR(4) = 11
       GO TO 15
C  HOPPOBAT HH KCOK EHTKATOPA ( > 4 )
14     CONTINUE
       IF ( IC .GT. 4 ) GO TO 3
C ACAT CMBO
15     FCAR(IC) = KAR(IK)
       IC =IC + 1
       GO TO 3
C======>  OT POE, HE KOHE  TO EHTKATOPA ? /01.02.86/
30      CONTINUE
         IF ( FLAG .EQ. 0 ) GO TO 3
         FLAG = 0
         CALL APF PAK (1, IDKOD, FCAR)
         SIM(IS) = IDKOD
         IS = IS + 1
         GO TO 3
C----------------------------------------------------------------------
C   KOHOBKA OEO KA  ********************************************
C----------------------------------------------------------------------
3      CONTINUE
       IK = IK + 1
       IF ( IK .LE. K72 ) GO TO 2
       IF ( FLAG .EQ. 0 ) GO TO 16
C  B KOHE BTOKHEM FCAR
       FLAG = 0
       CALL APF PAK ( 1, IDKOD, FCAR )
       SIM(IS) = IDKOD
       IS = IS + 1
C  KOHAEM
16     KSIM = IS - 1
       IF ( KSIM .LT. 0 ) KSIM = 0
C  EPEEM K A-KOD
       CALL APF TRT ( 2, K72, KAR, KAR )
       CALL APF TRT ( 2,  80, ER, ER )
C!!!-------------------------------------------------------------------
       IF ( KSIM. GT. 100 ) WRITE ( NW6,17) KSIM
17     FORMAT(' ***** CO B APFTEM; KSIM=',I10 )
C!!!-------------------------------------------------------------------
       RETURN
       END
