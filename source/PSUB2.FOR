       SUBROUTINE PSUB2( NEL, URMAS, STMAS, DGMAS, INTMAS )
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)------------
C   OPOPAMMA: PSUB2( NEL, URMAS, STMAS, DGMAS, INTMAS )
C   -------------
C   HAHAEHE:  / OOBATE  MOEPOBAH
C   ----------   AKOHOB PEPOBAH "PETOPA BOEH"
C                ( MAKPOMOE # TA 40 )
C               O BEHAM, EPEABAEMM OOBATEEM 
C               BEHA, PACTAHHM B MAKPOMOE # 40
C               ( B POEK HA OOPH CCTEM OTCETA),
C               OPEETC PABE HAPEH PEPOBAH
C               B TO E CCTEME OTCETA.
C   METO:     BCEHE O AAHHM OPMAM,
C   -----       HTEPPOBAH - METO TPAE;
C
C              OOBATE BBOT EPE AAPAT "PSUB" :
C
C   PSUB 2 < KE URD00 KI ISDZAD URQ00 KS BETA SZAD   XAF
C
C
C      KTI  TI1 ISZAD_1  TI2 ISZAD_2 .....
C                        I         I
C                        I<---*--->I
C
C      KTS  TS1 S_1      TS2    S_2  ...... >;
C                        I         I
C                        I         I
C                        I<---*--->I
C
C
C    E:
C          -*-  BA HAEH, OCBAE OH TOK OPEEEH
C               COOTBETCTBE HKOHAHO ABCMOCT -->
C               OHA AAETC KAK KCOHO-HEHA HK;
C
C       KTI  - KO-BO TOEK  OPEEEH ABCMOCT ISZAD OT "TN";
C
C       KTS  - KO-BO TOEK  OPEEEH ABCMOCT SZAD  OT "TN";
C
C
C  == HAAO OCAH KCPETC : ISZAD -> URMAS(10)
C                                      SZAD  -> URMAS(11 + "2"*KTI )
C  ==
C !!! BHMAHE -->  FM MOHTOP HAEH "KTI"  "KTS"    B O      !!
C                                                      ------------
C
C  APAMETP:   NEL - HOMEP EMEHTA,  KOTOPOO PSUB PAOTAET;
C  ---------    URMAS - MACCB AHHX OOBATE:
C               *****
C       COBO        HAEHE
C      1               8 - KO-BO APAMETPOB B CCKE URMAS
C      2               KE         HAEHE
C      3               URD00      HAEHE
C      4               KI         HAEHE
C      5               ISDZAD     HAEHE  -->  P KTI = 0
C      6               URQ00      HAEHE
C      7               KS         HAEHE
C      8               BETA       HAEHE
C      9               SZAD       HAEHE  -->  P KTS = 0
C      10              XAF        HAEHE
C  - - - - - - -- - - - - - - - - - - - - - - - - - - - - -
C      11        KTI      KO-BO TOEK  OCAH ISDZAD=>(T) ( *2 )
C
C OT 12 O 11+"2"*KTI     TOK KCO. HEHOO AAH IZDZAD ->(T)
C
C 12+"2"*KTI     KTS      KO-BO TOEK  OCAH SZAD =>(T) ( *2 )
C
C OT 13+"2"*KTI
C O 12+"2"*KTI+"2"*KTS   TOK OPEEEH --> SZAD=>(T)
C
C
C  --> EC KTI = 0 -->  BCE OPMAHO TO E, HO B URMAS(11) <-> KTS
C
C              STMAS - MACCB AHHX, EPEABAEMX B PSUB:
C              *****
C      COBO           OOHAEHE   -   HAEHE
C      1               TN - BPEM N - O AA PACETA;
C      2               H0 - A HTEPPOBAH;
C- TN+H0*** TN ***
C   I           I
C   Y           Y
C   13         3       ISQ0 - TOK CTATOPA Q OC OOPHA;
C   14         4       ISD0 - TOK CTATOPA D OC OOPHA;
C   15         5       USQ0 - HAPEHE CTATOPA Q OC OOPHA;
C   16         6       USD0 - HAPEHE CTATOPA D OC OOPHA;
C   17         7       IRQ0 - TOK POTOPA Q OC OOPHA;
C   18         8       IRD0 - TOK POTOPA D OC OOPHA;
C   19         9       OMEG0 - OOPHA ACTOTA;
C   20        10       OMEGA - OBA CKOPOCT POTOPA;
C   21        11       GAMMA - O ME CTATOP.  POTOP. AA "A";
C   22        12       S - CKOEHE;
C------------------------
C   14 *--* 22 - TO E  T = TN+H0;
C   23, 24, 25 -  P E  E P B;
C
C------------------------------------------------------
C
C
C          DGMAS  -  MACCB BECEHHX HAEHE HAPEH
C          *****                        PABEH B Q_D O.
C
C   COBO        OOHAEHE - HAEHE:
C   1          UYQ0    - P. HAP. O Q OC O. CCTEM;
C   2          UYD0    - P. HAP. O D OC O. CCTEM;
C   3          UYMOD   - MO BEKTOPA P. HAPEH;
C   4          ISD_A.- AAHH TOK CTATOPA O OC Q;
C   5          S_A.  - AAHHOE CKOEHE;
C -----------------------------------------------------
C
C
C              INTMAS - MACCB  PEAA HTEPATOPOB,
C              ******  ( 5-T COB );
C            EPBE BA HA. XPAHTC B TOKN/TOKN1;
C
C  PSUB2 --->  BCET:
C
C  UYD0 = [ URD00 - KI*INT(ISD0-ISDZAD) ]* (KE+1) - KE* XAF* IRD0;
C
C
C  UYQ0 = [URQ00 - KS *S - BETA*INT(S-SZAD) ]*(KE+1) - KE* XAF* IRQ0;
C
C  E:  INT - HTEPA;
C
C   OPOPAMM:   KMAS02;
C   -------------
C
C   PMEAHE:
C   ----------
C
CZZZ-------------------------------------------------------------------
       DIMENSION URMAS(*), STMAS(*), DGMAS(*), INTMAS(*)
C
       REAL INTMAS, INTI, INTS, INT, KE, ISDZAD, KI, KS, KMAS02
C
       REAL ISQ0, ISD0, IRQ0, IRD0, INTSUM
C
C  BCTPOEHH HTEPATOP--->
C
       INT( INTSUM, XN1, XN ) = INTSUM + H0 *(XN1 + XN )/ 2.0
C
       TN = STMAS(1)
       H0 = STMAS(2)
       TN1 = TN + H0
C######################################################################
C-->  OPEEEHE ISDZAD   SZAD O TA. HK. ABC.
C
       ISDZAD = URMAS(5)
       SZAD =   URMAS(9)
C-->  CKOKO APAMETPOB B PSUB-->
       KPAR = IFIX( URMAS(1) )
       IF ( KPAR .LE. 9 ) GO TO 1
C-->  KO-BO TOEK  ISDZAD--> KTI
       KTI = IFIX( URMAS(11) )
       IF ( KTI .LE. 0 ) GO TO 2
C-->  TO-TO ECT, HAEM ..
       ISDZAD = KMAS02(TN1, URMAS(11) )
2      CONTINUE
       IF ( KPAR .LE. (11+KTI) ) GO TO 1
C-->  TO-TO ECT   SZAD, HAEM...
       KTS = IFIX( URMAS(12+KTI) )
       IF ( KTS .LE. 0 ) GO TO 1
       SZAD = KMAS02( TN1, URMAS(12+KTI) )
1      CONTINUE
C######################################################################
       DGMAS(4) = ISDZAD
       DGMAS(5) = SZAD
C
C--> HTEPA
       INTI = INTMAS(1)
       INTS = INTMAS(2)
C-->  HOB. HA.
       DIN = STMAS(4) - ISDZAD
       DIN1 = STMAS(14) - ISDZAD
C
       INTMAS(1) = INT( INTI, DIN1, DIN )
C
       DSN = STMAS(12) - SZAD
       DSN1 = STMAS(22) - SZAD
C
       INTMAS(2) = INT( INTS, DSN1, DSN )
C
       INTI = INTMAS(1)
C
       INTS = INTMAS(2)
C----------------------------------------------------------------------
C-->  P.  TN+H0  MOMEHTA BPEMEH;
C
      UYD0=(URMAS(3)-URMAS(4)*INTI)*(URMAS(2)+1.)-URMAS(2)*STMAS(18)*
     *                                             URMAS(10)
C
      UYQ0=(URMAS(6)-URMAS(7)*STMAS(22)-URMAS(8)*INTS)*(URMAS(2)+1.)-
     =      URMAS(2)*STMAS(17) * URMAS(10)
C----------------------------------------------------------------------
       DGMAS(1) = UYQ0
C
       DGMAS(2) = UYD0
C
       DGMAS(3) = SQRT( UYQ0**2 + UYD0**2 )
C
       RETURN
       END
