         SUBROUTINE DM0022 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                         MSWALL, RMSWAL, ADRMSW )
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)------------
C   OPOPAMMA:  DM0022 ( MSW, RMSW, YALL, JALL, LOGYTR
C  -------------             TOKN, TOKN1, VALLN, VALLN1, KOD,
C                              MSWALL, RMSWAL, ADRMSW )
C
C   HAHAEHE:    B ABCMOCT OT HAEH AA ZAPROS [MASPRT(28)]:
C   -----------    BOHET CEE HK:
C
C                  A) ZAPROS = 1
C                     ----------
C                  OPMPOBAHE BKAOB B YALL MATP POBOMOCTE 
C                  JALL - BEKTOP CTOHKOB TOKA HAEH APAMETPOB
C                  KBBAEHTHX  G - J BETBE  MOE EMEHTA E
C
C                      P KODMUM = 1 --> BCEA H1  H2 BPATC
C                                         COACHO MU APAMETP, A HE
C                                         O TEKM H1  H2
C
C
C
C                   MAKPOMOE M-AHOO AOBOO BATE
C                   C MAHTHO HE CBAHHM OMOTKAM.
C                   ***************************************************
C                  T # 502 --> 2-X  AH BPA. AOB BATE;
C                  T # 503 --> 3-X  AH BPA. AOB BATE;
C                  T # 504 --> 4-X  AH BPA. AOB BATE;
C                  T # 505 --> 5-T AH BPA. AOB BATE;
C                  T # 506 --> 6-T AH BPA. AOB BATE;
C                  T # 507 --> 7-M AH BPA. AOB BATE;
C                  T # 508 --> 8-M AH BPA. AOB BATE;
C                  T # 512 --> 2-X  AH H.  AOB BATE;
C                  T # 513 --> 3-X  AH H.  AOB BATE;
C                  T # 514 --> 4-X  AH H.  AOB BATE;
C                  T # 515 --> 5-T AH H.  AOB BATE;
C                  T # 516 --> 6-T AH H.  AOB BATE;
C                  T # 517 --> 7-M AH H.  AOB BATE;
C                  T # 518 --> 8-M AH H.  AOB BATE;
C
C
C
C                  EMEHT OCBAETC:
C            ?? T 5??  #H1 #H2 ... #K1 #K2...
C                        M  P  R  J  MT  TL
C                      MAS < L0 L1 ....LN >
C                      MAS < T1 Y1 ....   > ;
C
C           E   M   -CO A BATE;
C                 P   -CO AP OCOB BATE;
C                 R   -AKTBHOE COPOTBEHE OMOTK,(OM);
C                 J   -MOMEHT(B K*M)HEP BPA. ACT ( BPA. ),
C                      MACCA (B K) OBHO ACT (  H.  );
C                 MT  -MOMEHT TPEH HA BA (B H*M)( BPA. ),
C                      CA TPEH (B H) ( H. );
C                 TL  -EPO MEHEH HKTBHOCT A,
C                      TL = TAU (PA)  BPA. ,
C                      TL = TAU (B M )  H.  ;
C                 L0..-KOEHT APMOHECKOO PA, OCBAEO
C                      ABCMOCT HKTBHOCT A OT EPEMEEH:
C                      L(X)=L0+L1*COS(2*PI*X/TL)+L2*COS(4*PI*X/TL)...,
C                      E X - EPEMEEHE . O,
C                          X = XMEX * P;
C              T1 Y1..-TAHO AAHHA ABCMOCT MBH(T)  BPA.,
C                      TAHO AAHHA ABCMOCT FBH(T)  H.;
C
C
C
C@
C
C               *** BOMOH TEPAOHHE TOHEH ***:
C                   P BOEH FITER [ MASPRT(65) ] --->
C                   HAEH "TOK"_ - POHO BHM METOOM -
C                   HE BCTC, A BPATC  MACCBA TOKN1;
C               ***
C                  B) ZAPROS = 2
C                     ----------
C                  BCEHE HAEH TOKOB B BETBX B T(N+1) MOMEHT
C                  BPEMEH   CXO  G  J APAMETPOB  HAEH
C                  OBX HAPEH HA EMEHTE PACTAHHX  T(N+1)
C                     AC (KCA) TX HAEH B "TOK T(N+1)";
C                 - P TOM KOHTPOPETC "PACXOEHE" ME
C                   HAEHM, OEHHM O BHO CXEME (POHO) 
C                   OPEEEHHM CXO  BCEHHX HAEH VALLN1;
C                   KOHTPO BEETC O HE PEBEH EITER[MASPRT(67)]
C                   OTHOCTEHO OPEHOCT. B HE AOPTHOM CAE
C                   B "MAXITR" ACBAETC MAX_OPEHOCT 
C                   B "NLITER" KCPETC HOMEP EMEHTA.....
C                   APAMETP "KOD" = 1;
C
C
C                  C) ZAPROS = 3
C                     **********
C                     HE OEPBAETC ( PEEPB );
C
C                  D) ZAPROS = 4
C                     **********
C                     HE OEPBAETC;
C
C   METO:         CKPETA PABHEH COCTOH MOE AHHOO
C   -----          TA HA OCHOBE METOA HEPA BO:
C                  Y(N+1) = Y(N) + H1*F(N+1) + H2*F(N).
C
C   APAMETP:     MSW, RMSW - PABEE COBO COCTOH MAKPOMOE
C   ---------      ( "OTPEOK" MACCB MSWALL -> C.M. / GETMSW );
C                  YALL - MATPA P0BOMOCT AHAPEMO E;
C                  JALL - BEKTOP CTOHKOB TOKA AHAPEMO E;
C                  VALLN - BEKTOP OBX HAPEH AHAPEMO E:
C                          B T = TN;
C                  VALLN1- BEKTOP OBX HAPEH AHAPEMO E:
C                          B T = TN + H0;
C                  TOKN    TOKN1  -  HAEH "TOKOB" P T :=
C                                     TN    TN + H0;
C                                   PAMEPHOCT CM. MASPRT(46)=NNTOK;
C                  LOGYTR - BEKTOP PHAKOB K.. OB:
C                  COETC B MAKPOMOEX C PHAKOM TA = 5;
C                  PAMEPHOC MACCBOB P "ALL" OPEETC:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKA_PAMEPHOCT ---> NSYS = MASPRT(26)
C                  KOD - APAMETP OPATHO CB C MOHTOPOM DM....
C                   ( =1 P OO OK. OPEHOCT );
C
C
C
C   OPOPAMM:  1. COMMON PROF1, PROF2, PROF3;
C   ------------      DEPOST, KMAS02;
C
C
C   PMEAHE:  1.CTPKTP MSW COBA MAKPOMOE AHHOO TA CM. HE
C   ----------   2. P ZAPROS ^=   1  2 - COOEHE  XO;
C                3. P FTEST=-1 EAT OT. H. EPE PRINT5;
C
C               "OCTOHHA" ACT MSW TOB # 502...518;
C                ----------------------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I PHAKI KO I KO. IAP.   IPE I
C  I EME I TA   I /    I TA   I ECT I BB. IHA.   IE I
C  I HTA   I MOE I PACETAI MOE I BO   I HA I"TOKN" IPB I
C  I       I        I DM.....I       .I OBI EH.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I  7    I 8 I
C  +-------+--------+--------+--------+------+------+-------+---+
C
C  +------------------------------------------------------------+
C  I  OKEH  H1  H2 .... K1  K2 .....                 I
C  I               M COB: OT 9 O ( 9 + M -1 )                 I
C  +------------------------------------------------------------+
C
C
C                       RMSW T # 502...518
C                      **********************
C
C  +-----+-----+-----+-----+------+------+-------+---------+-----+--->
C  I     I     I     I     I      I      I       I         I     I
C  I  M  I  P  I  R  I  J  I  MT  I  TL  I PEEPBI PEEPB  I W0  I
C  I     I     I     I     I      I      I       I         I     I
C  +-----+-----+-----+-----+------+------+-------+---------+-----+--->
C  I  1  I  2  I  3  I  4  I  5   I   6  I   7   I    8    I  9  I
C  +-----+-----+-----+-----+------+------+-------+---------+-----+--->
C  I D1  I D1+1I D1+2I D1+3I D1+4 I D1+5 I  D1+6 I  D1+7   I D1+8I
C  +-----+-----+-----+-----+------+------+-------+---------+-----+--->
C  +D1=9+2*M
C  +DR1=1
C
C
C  +--------+--------+--------+--------+---------+----------+----------+
C  I        I  D L   I        I        I         I  NGARM,  I   NT,    I
C  I   L    I  ----- I   J0   I G(N+1) I J(N+1)  I L0,L1... I T1,Y1... I
C  I        I  D GAM I        I        I         I          I          I
C  I M COB I M COB I M COB I M COB I M COB  INMAS1 COBINMAS2 COBI
C  +--------+--------+--------+--------+---------+---------------------+
C  I DR2+M  I DR3+M  I DR4+M  I DR5+M  I DR6+M   I DR7+NMAS1I DR8+NMAS2I
C  +--------+--------+--------+--------+---------+----------+----------+
C  ID2..D3-1ID3..D4-1ID4..D5-1ID5..D6-1ID6...D7-1I D7..D8-1 I D8+NMAS2 I
C  +--------+--------+--------+--------+---------+----------+----------+
C  +D2=D1+9 +D3      +D4      +D5      +D6       +D7        +D8
C  +DR2=10  +DR3     +DR4     +DR5     +DR6      +DR7       +DR8
C
C   D@ -HOMEPA OE MSW_ALL MACCBA;
C   DR@-HOMEPA OE  R_MSW  MACCBA;
C
C                           DR1  DR2  DR3  DR4  DR5  DR6  DR7    DR8
C    2-X  AHOO -->  1    10   12   14   16   18   20   20+NMAS1
C    3-X  AHOO -->  1    10   13   16   19   22   25   25+NMAS1
C    4-X  AHOO -->  1    10   14   18   22   26   30   30+NMAS1
C    5-T AHOO -->  1    10   15   20   25   30   35   35+NMAS1
C    6-T AHOO -->  1    10   16   22   28   34   40   40+NMAS1
C    7-M AHOO -->  1    10   17   24   31   38   45   45+NMAS1
C    8-M AHOO -->  1    10   18   26   34   42   50   50+NMAS1
C
C
C
C                           D1   D2   D3   D4   D5   D6   D7     D8
C    2-X  AHOO -->  13   22   24   26   28   30   32   32+NMAS1
C    3-X  AHOO -->  15   24   27   30   33   36   39   39+NMAS1
C    4-X  AHOO -->  17   26   30   34   38   42   46   46+NMAS1
C    5-T AHOO -->  19   28   33   38   43   48   53   53+NMAS1
C    6-T AHOO -->  21   30   36   42   48   54   60   60+NMAS1
C    7-M AHOO -->  23   32   39   46   53   60   67   67+NMAS1
C    8-M AHOO -->  25   34   42   50   58   66   74   74+NMAS1
C
C
C     B MACCBE TOKN  TOKN1 COEPTC:
C
C    OT 1 O M   - HAEH TOKOB A OMOTOK;
C
C       M+1      -  HAEHE GAMMA -> O OOEH POTOPA;
C
C       M+2      -  HAEHE OMEGA -> OBA ACTOTA BPAEH POTOPA
C
C       M+3      -  HAEHE MFT - . MA. MOMEHTA;
C
C       M+4      -  HAEHE M_BHE(T) - BHEH HAPOH MOMEHT;
C
C  OPM:
C  ********
C   HKT A) ( E AA ):
C            O AHHM  TOKN  VALLN:
C
C   GAMEL(N) = GAM(N) * P ------> (  TOKN )
C
C   L(N) = F ( GAMEL(N) )
C
C   D L(N)
C   ------- = F ( GAMEL(N) )
C   D GAMEL
C
C            -1                          D L(N)
C   J0 = L(N)  *[ U(N)-(R + OMEG(N)* P *-------  ) * TOK(N) ] ->(B MSW)
C                                        D GAMEL
C
C   MFT(N) =  TOKN
C
C   MBH(N) =  TOKN
C
C   W0 = ( MFT(N) - MBH(N) - SIGN(OMEG(N) ) * MT ) / J ------->( B MSW )
C
C   TOK(N+1)(BH) = TOK(N) + H0 * J0 ----->( B TOKN1 )
C
C   OMEG(N+1)(BH) = OMEG(N) + H0 * W0 --->( B TOKN1 )
C
C   GAM(N+1) (BH) = GAM(N) + H2 * OMEG(N) + H1 * OMEG(N+1)->(B TOKN1)
C
C--------------------------------------------------------------------
C   HKT A) ( P AE ):
C   O AHHM  TOKN1, MSW  TOKN:
C
C   GAMEL(N+1) = GAM(N+1) * P
C
C   L(N+1) = F ( GAMEL(N+1) ) --------> ( B MSW )
C
C   D L(N+1)
C   -------- = F ( GAMEL(N+1) ) ------> ( B MSW )
C   D GAMEL
C
C   MFTN1 = F( GAM(N+1),TOKN1 )
C                                             D L(N+1)
C   Z1 = [ L(N+1) + H1 * ( R + OMEG(N+1)* P * -------- ) ] ** (-1)
C                                             D GAMEL
C   G(N+1) = H1 * Z1 ----------------------------------> ( B MSW )
C
C   J(N+1) = Z1 * [ TOK(N) + H2 * J0 ] * L(N+1) -------> ( B MSW )
C
C--------------------------------------------------------------------
C   HKT B) -->  PACET TOKN1  KOHTPO:
C   O AHHM  TOKN1, MSW, VALLN1:
C
C   TOKX = G(N+1) * UL(N+1) + J(N+1);  UL--> VALLN1(*) - VALLN1(*);
C
C   MFTX = F( GAM(N+1), TOKX )
C
C   OMEGX = OMEG(N)+H2*W0+H1*[MFTX+MBH(N+1)-SIGN(OMEG(N+1)*MT]/J
C
C   GAMX  = GAM(N) + H2 * OMEG(N) + H1 * OMEGX
C
C   OCK  EPS:= [MAX] -> ABS(TOKX - TOKN1)/MAX(TOKX,TOKN1)
C
C   P  EPS > MAXITR --> KCA CTA: NLITER, NSITER,...
C                         KOD = 1
C                         *******
C
C   KCA B TOKN1 HAEH TOKX, .....
C
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         DIMENSION MSWALL(*), RMSWAL(*)
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( NNTOK,  MASPRT(46) )
         EQUIVALENCE ( FTEST,  MASPRT(60) )
         EQUIVALENCE ( NSYS,   MASPRT(26) )
         EQUIVALENCE ( NDALL,  MASPRT(23) )
         EQUIVALENCE ( NWTRE,  MASPRT(14) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( MU,     MASPRT(31) )
         EQUIVALENCE ( H1OLD,  MASPRT(32) )
         EQUIVALENCE ( H2OLD,  MASPRT(33) )
         EQUIVALENCE ( FITER,  MASPRT(65) )
         EQUIVALENCE ( EITER,  MASPRT(67) )
         EQUIVALENCE ( NLITER, MASPRT(79) )
         EQUIVALENCE ( MAXITR, MASPRT(80) )
         EQUIVALENCE ( NSITER, MASPRT(88) )
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         EQUIVALENCE ( KODMUM, MASPRT(114) )
         INTEGER D1 , D2 , D3 , D4 , D5 , D6 , D7
         INTEGER FITER,  ZAPROS, TIP
         INTEGER ADRMSW
         INTEGER FTEST
         REAL MAXITR,MFTN,MBHN,MFTX,MBHX,MU,MFTN1,LN,LN1,J,MT,J0,KMAS02
         DIMENSION UL(8), TOKX(8)
C--------------------------------------------------------------------
       PI=3.1415927
       TIP = MSW(2)
       NTIP = TIP - 501
       IF ( NTIP .GT. 10 ) NTIP = NTIP - 10
       IF ( NTIP .GE. 1 .AND. NTIP .LE. 7 ) GO TO 10
       GO TO 9999
10     CONTINUE
C--------------------------------------------------------------------
C   BEH, ABCE OT KOHKPETHO MOE:
       M = NTIP + 1
       D1   = 9 + 2 * M
C 1) PAMEPHOCT PA. MACCBOB  KALL :
       KALL = M
C 2) BCOM. KAATE-> CMEEHE B MSW  COOTB. MACCBOB
C    ( HA "1" MEHE COOTB. D2,D3,....):
       ILN  = D1 + 8
       IDLN = ILN  + M
       IJ0  = IDLN + M
       IGN1 = IJ0  + M
       IJN1 = IGN1 + M
       ILGR = IJN1 + M + 1
       IMBHT= ILGR + MSW(ILGR) + 1
C 3) KOECTBO APMOHK B PECTABEH -  L(GAMMA):
       NGARM = MSW(ILGR) - 1
C 4) CMEEHE B TOKN/TOKN1 HA "MEXAHECKE" EPEMEHHE:
       IGAM  = M
       IOMEG = M + 1
       IMFT  = M + 2
       IMBH  = M + 3
C--->  BBEEM OCTOHHE APAMETP.
       P  = RMSW( D1 + 1)
       R  = RMSW( D1 + 2)
       J  = RMSW( D1 + 3)
       MT = RMSW( D1 + 4)
       TL = RMSW( D1 + 5)
C----------------------------------------------------------------------
C--->  BOP H1   H2 --->
       H1 = H1OLD
       H2 = H2OLD
       IF ( KODMUM .EQ. 0 )  GO TO 30
       H1 = H0 * ( 1.0 - MU )
       H2 = H0 * MU
30     CONTINUE
C----------------------------------------------------------------------
C-->  KA- HA TOK...
       ITOK = MSW(7)
       ITOK1 = ITOK - 1
C--->  BOP PEMA APOCA..
       GO TO( 100, 200), ZAPROS
C===> HAE OKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHTOP #', I4, ' APOC OCBAH OOEH
     = ***'/ ' *** ZAPROS = ', I5, ' - HOPPETC ***')
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C---- ZAPROS = 1 ------------------------------------------------------
100    CONTINUE
C-->  AEHE HAPEH:
       DO 110 I=1,KALL
       NN = MSW( 8 + I )
       NK = MSW( 8 + M + I )
       VN = 0.0
       IF ( NN .NE. 0 ) VN = VALLN(NN)
       VK = 0.0
       IF ( NK .NE. 0 ) VK = VALLN(NK)
       UL(I) = VN - VK
110    CONTINUE
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C-->  HE POCT  TEPA ?
       IF ( FITER .EQ. 1 ) GO TO 175
C--------------------------------------------------------------------
C-->  HKT A) --- HAAO -----(E AA)
C--------------------------------------------------------------------
       GAMN = TOKN(ITOK+IGAM)
       OMEGN = TOKN(ITOK+IOMEG)
C----------------------------------------------------------------------
C--->  OPEEEM HAEHE HKTBHOCT  EE POBOHO   T = TN
C----------------------------------------------------------------------
          DO 150  I = 1, KALL
          LN  = RMSW ( ILGR + 1 )
          DLN = 0.0
          GAMEL = GAMN * P - FLOAT( I - 1 ) * TL / FLOAT( M )
             C1 = 2. * PI * GAMEL / TL
             DO 130 I1 = 1, NGARM
             AI1 = FLOAT( I1 )
             LN  = LN  + RMSW( ILGR + I1 +1 ) * COS( AI1 * C1 )
             C2  = AI1 * 2. * PI / TL
             DLN = DLN - RMSW( ILGR + I1 +1 ) * SIN( AI1 * C1 ) * C2
130          CONTINUE
C-->  PACET J0:
         J0 = ( UL(I) - ( R + OMEGN* P * DLN ) * TOKN(ITOK1 + I) ) / LN
         RMSW ( IJ0 + I ) = J0
150      CONTINUE
C--------------------------------------------------------------------
C-->  MFT_N    MBH_N
C--------------------------------------------------------------------
         MFTN = TOKN( ITOK + IMFT )
         MBHN = TOKN( ITOK + IMBH )
C--------------------------------------------------------------------
C-->   W0----> MEX. XAP-KA..
       W0 = ( MFTN - MBHN - SIGN(1.,OMEGN) * MT ) / J
       RMSW ( ILN ) = W0
C--------------------------------------------------------------------
C--->  POHO "BHX" HAEH
       DO 170 I=1,KALL
       TOKN1(ITOK1 + I) = TOKN(ITOK1+I) + H0 * RMSW( IJ0+I )
170    CONTINUE
       TOKN1(ITOK + IOMEG ) = OMEGN + H0 * W0
       TOKN1(ITOK + IGAM ) = GAMN  + H2 * OMEGN + H1 * OMEGN1
C**********************************************************************
C-->  HKT A) C AOM....
175    CONTINUE
C**********************************************************************
C  -->  "BHE"   "TEPAOHHE" GAMN1  OMEGN1
       OMEGN1 = TOKN1( ITOK + IOMEG )
       GAMN1  = TOKN1( ITOK + IGAM  )
C----------------------------------------------------------------------
C--->  OPEEEM HAEHE HKTBHOCT  EE POBOHO   T = TN+1
C----------------------------------------------------------------------
          DO 190  I = 1, KALL
          LN1  = RMSW ( ILGR + 1 )
          DLN1 = 0.0
          GAMEL = GAMN1 * P - FLOAT( I - 1 ) * TL / FLOAT( M )
             C1 = 2. * PI * GAMEL / TL
             DO 180 I1 = 1, NGARM
             AI1 = FLOAT( I1 )
             LN1 = LN1 + RMSW( ILGR + I1 +1 ) * COS( AI1 * C1 )
             C2  = AI1 * 2. * PI / TL
             DLN1= DLN1- RMSW( ILGR + I1 +1 ) * SIN( AI1 * C1 ) * C2
180          CONTINUE
         RMSW ( ILN + I ) = LN1
         RMSW ( IDLN + I ) = DLN1
190      CONTINUE
C--------------------------------------------------------------------
C**** EPECET MFT  HAEH GAMN1  TOKN1
C     PACET MFTN1  AC EO B TOKN1:
C--------------------------------------------------------------------
         MFTN1 = 0.0
         DO 192 I = 1 , M
         MFTN1 = MFTN1 + TOKN1( ITOK1 + I )**2 * RMSW( IDLN + I )
192      CONTINUE
         MFTN1 = 0.5 * P * MFTN1
         TOKN1(ITOK + IMFT ) = MFTN1
C--------------------------------------------------------------------
C--> O  AHHM POHOA  HAXOM  G(N+1)  ACBAEM EO B MSW.
C--> O  AHHM POHOA  HAXOM  J(N+1)  ACBAEM EO B MSW.
C--------------------------------------------------------------------
         DO 195 I = 1 , M
         Z1=1./( RMSW(ILN+I) + H1 * ( OMEGN1 * P * RMSW(IDLN+I) + R ) )
         RMSW( IGN1 + I ) = H1 * Z1
         RMSW(IJN1 + I)=(TOKN(ITOK1+I)+H2*RMSW(IJ0+I))*Z1*RMSW(ILN+I)
195      CONTINUE
C--------------------------------------------------------------------
C   G(N+1)    J(N+1)  OPEEEH....
C---  BKABAEM ----------------------------------------------------
       DO 197 I = 1 , M
       NN = 8 + I
       NK = 8 + M + I
       IG = IGN1 + I
       IJ = IJN1 + I
       CALL DEPOST( MSW( NN ), MSW( NK ), RMSW( IG ),RMSW( IJ ) ,
     =              YALL  ,JALL )
197    CONTINUE
       RETURN
C----------------------------------------------------------------------
C----------------------------------------------------------------------
C---- ZAPROS = 2 ------------------------------------------------------
200    CONTINUE
C-->  AEHE HAPEH-->  HOBOE
       DO 201 I=1,KALL
       NN = MSW( I + 8 )
       NK = MSW( 8 + M + I )
       VN = 0.0
       IF ( NN .NE. 0 ) VN = VALLN1(NN)
       VK = 0.0
       IF ( NK .NE. 0 ) VK = VALLN1(NK)
       UL(I) = VN - VK
201    CONTINUE
C--------------------------------------------------------------------
C-->  HAEM TOK  O  VALLN1...
C--------------------------------------------------------------------
       DO 202 I=1,KALL
       TOKX(I) = RMSW( IJN1 + I ) + RMSW( IGN1 + I ) * UL( I )
202    CONTINUE
C--------------------------------------------------------------------
C--->  MFT    MBH ...
C  -->  "BHE"  TEP. HAEH  TN1 ( PECKAAHE) -->
       GAMN1 = TOKN1(ITOK + IGAM)
       OMEGN1 = TOKN1(ITOK + IOMEG)
C--------------------------------------------------------------------
C--->   HAEH  GAMMA  OMEGA  B TN  TOEK -->
C--------------------------------------------------------------------
       GAMN  = TOKN(ITOK+IGAM)
       OMEGN = TOKN(ITOK+IOMEG)
C--------------------------------------------------------------------
C     PACET MFTX
C--------------------------------------------------------------------
         MFTX  = 0.0
         DO 203 I = 1 , M
         MFTX = MFTX + TOKX( I )**2 * RMSW( IDLN + I )
203      CONTINUE
         MFTX = 0.5 * P * MFTX
C--------------------------------------------------------------------
C  MBHX-->  C ETOM TOKX, GAMN1, OMEGN1
C--------------------------------------------------------------------
       TN1 = TN + H0
       MBHX = KMAS02( TN1 , RMSW( IMBHT ) )
C--------------------------------------------------------------------
       W0  = RMSW( D1 + 8 )
       W01 = ( MFTX - MBHX - SIGN(1.,OMEGN1) * MT ) / J
C--->  ####  BOHEHE  HEBHOO  AA ( TA KOPPEK )::-->
       OMEGX = OMEGN + H1*W01 + H2*W0
       GAMX = GAMN + H1*OMEGN1 + H2*OMEGN
C----------------------------------------------------------------------
C----------------------------------------------------------------------
C-->  OEHKA OPEHOCT...
       EPSX = 0.0
       NSM = 0
       DO 204 I=1,KALL
       X1 = ABS( TOKN1(ITOK1+I) )
       X2 = ABS( TOKX(I) )
C++++
       IF ( X1 .LE. 0.0010  .OR.  X2 .LE. 0.0010 )  GO TO 2040
       XZ = AMAX1( X1, X2 )
       EPS = ABS( X1 - X2 ) / XZ
       GO TO 2041
2040   EPS = ABS( X1 - X2 )
2041   CONTINUE
C+++++
       IF ( EPS .LT. EPSX ) GO TO 204
C-->  KCPEM  B MOE...
       EPSX = EPS
       NSM = I
204    CONTINUE
C-->   MEXAHK....
C----------------------------------------------------------------------
       X1 = ABS( GAMN1 )
       X2 = ABS( GAMX )
C++++
       IF ( X1 .LE. 1.E-05  .OR.  X2 .LE. 1.E-05 )  GO TO 2050
       XZ = AMAX1( X1, X2 )
       EPS = ABS( X1 - X2 ) / XZ
       GO TO 2051
2050   EPS = ABS( X1 - X2 )
2051   CONTINUE
C+++++
       IF ( EPS .LT. EPSX ) GO TO 205
C-->  KCPEM..
       EPSX = EPS
       NSM = IGAM + 1
205    CONTINUE
C----------------------------------------------------------------------
       X1 = ABS( OMEGN1 )
       X2 = ABS( OMEGX )
C++++
       IF ( X1 .LE. 0.001   .OR.  X2 .LE. 0.001  )  GO TO 2060
       XZ = AMAX1( X1, X2 )
       EPS = ABS( X1 - X2 ) / XZ
       GO TO 2061
2060   EPS = ABS( X1 - X2 )
2061   CONTINUE
C+++++
       IF ( EPS .LT. EPSX ) GO TO 206
C-->  KCPEM..
       EPSX = EPS
       NSM = IOMEG + 1
206    CONTINUE
C--->  EPEAC TOKOB  B   TOKN1...
       DO 207 I=1,KALL
       TOKN1(ITOK1+I) = TOKX(I)
207    CONTINUE
       TOKN1(ITOK+ IGAM) = GAMX
       TOKN1(ITOK+ IOMEG) = OMEGX
       TOKN1(ITOK+ IMFT ) = MFTX
       TOKN1(ITOK+ IMBH ) = MBHX
C--->  ECT  "OA" OKA  ????
       KOD = 0
       IF ( EPSX .LT. EITER ) RETURN
       KOD = 1
C-->  OKA ECT, HE HHO  EE KCPOBAT....
       IF ( EPSX .LT. MAXITR ) RETURN
       MAXITR = EPSX
       NLITER = MSW(1)
       NSITER = NSM
       RETURN
C######################################################################
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** O. CO B DM0022 - APOC HA OCBAHE O
     =O TA ***'/
     =    ' *** EMEHT # ', I10, ' T MOE # ', I10, ' ***'//)
         CALL SUBERR(0)
         RETURN
         END
