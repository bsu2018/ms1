        SUBROUTINE FM0022(BA0T, KNOTT, PAR0T, RMSW, LM )
CXXX----KOMEKC "MS1" --> BEPC 1.1  (OT   OKTP 1987 .)-----------
C   OPOPAMMA: FM0022(BA0T, KNOTT, PAR-T, RMSW, LM )
C   -------------
C   HAHAEHE:  HACTPOKA MAKPOMOEE HEHX HAMECKX BEHEB:
C   ----------
C    +-----+-----------------------------------+---------------------+
C    I     I                                   I    EPEATOHA     I
C    I T I       HAMEHOBAHE BEHA          I                     I
C    I     I                                   I       HK       I
C    I-----I-----------------------------------I---------------------I
C    I     I   POOPOHAHO-HTEPPEE   I    TAU1*S + 1       I
C    I 314 I         (  - PETOP )        I   -------------     I
C    I     I                                   I      TAU2*S         I
C    I-----I-----------------------------------I---------------------I
C    I     I POOPOHAHO-EPEHPEE  I    TAU1*S + 1       I
C    I 315 I         (  - PETOP )        I   -------------     I
C    I     I                                   I    TAU2*S + 1       I
C    I-----I-----------------------------------I---------------------I
C    I     I                                   I    1 - TAU*S        I
C    I 316 I       AOBPAATE               I   -------------     I
C    I     I                                   I    1 + TAU*S        I
C    I-----I-----------------------------------I---------------------I
C    I     I                                   I       W**2          I
C    I 317 I       KOEATEHOE              I  -----------------  I
C    I     I                                   I  S**2+2*E*W*S+W**2  I
C    +-----+-----------------------------------+---------------------+
C              *******************************************************
C                PHAK TIP # 4 -> O. MAKPOMOE.
C                ( DM0026, LM0007 )
C                      OPMPET "EPEMEHH" ACT RMSW OCAH
C                              T 314:==> 7
C                      HA:  T 315:==> 7
C                              T 316:==> 7
C                              T 317:==>11
C
C----------------------------------------------------------------------
C              EMEHT OCBATC:
C
C       # T 314  0   #  #CM  TAU1  TAU2  UMAX U0 T0
C       # T 315  0   #  #CM  TAU1  TAU2  UMAX
C       # T 316  0   #  #CM  TAU   UMAX
C       # T 317  0   #  #CM   W    E     UMAX
C
C      E
C          # ,#CM - HOMEP EMEHTA  HOMEP TOKA EMEHTA ,
C                     COEMOO B KAECTBE BXOHOO CHAA;
C          TAU,TAU1,
C              TAU2 - OCTOHHE BPEMEH;
C              W    - ACTOTA KOEAH;
C              E    - KOEHT EMPOBAH;
C              UMAX - MAKCMAH BXOHO CHA.
C              U0, T0 -  U0   0   
C----------------------------------------------------------------------
C
C   METO:         PAMETKA OE RMSW O MOE
C   -----
C
C   APAMETP:     BA0T, KNOTT, PAR0T - "OTPEK" HOPMAOHHX
C  ----------      MACCOBOB BA0, KNOT, PAR0 ( CM. INPUT0  GETMSW );
C                  RMSW - "EPEMEHHA" ACT MSW ( "OTPEOK" MSWALL );
C                  LM - HA "EPEMEHHO" ACT RMSW P FGMSW = 0;
C                  LM - HA BCEO MSW OCAH      P FGMSW = 1;
C
C   OPOPAMM:  1.COMMON PROF1
C   ------------
C
C   PMEAHE:    1. KOHTPO B MHMAHOM O"EME;
C   -----------    2. BCE HE OPEEEME O RMSW AHTC;
C                  3. HE PBOTC OPMAT RMSW:
C
C
C----------------------------------------------------------------------
C
C              OPMAT RMSW T # 314,315:
C              --------------------------
C+-----------I--------------I------I-----------------------------------
C  # COBA   I    # COBA B I KTO  I
C OT HAAA  I    OTPEKE   IOPE.I
C BCEO MSW  I    RMSW B    I      I       OOHAEHE - HAEHE
C OCAH   I    FM0022    I      I
C------------I--------------I------I-----------------------------------
C     9      I     0        I      I HOMEP A ( BCEA 0 )
C----------------------------------------------------------------------
C    10      I     1        I  DM  I  FQ - A HOBE HA. BCEH
C            I              I      I   (  CHXPO. MAKPO. P.TIP # 4 )
C    11      I     2        I  FM  I  UMAX - MAKCM. BXOHO CHA.
C            I              I      I
C    12      I     3        I  FM  I  #  - HOMEP EMEHTA;
C    13      I     4        I  FM  I  #CM  - HOMEP TOKA EMEHTA #1;
C    14      I     5        I  LM  I  ATOKM  - AP B TOKN/N1 HAEH
C            I              I      I           TOKA HOMEP #CM
C            I              I      I           EMEHTA #;
C    15      I     6        I  FM  I  TAU1 - OCTOHHA BPEMEH;
C    16      I     7        I  FM  I  TAU2 - OCTOHHA BPEMEH;
C    17      I     8        I  FM  I  U0   -  ;
C    18      I     9        I  FM  I  T0   -     ;
C----------------------------------------------------------------------
C
C  OA HA MSW --> LM<BC> = 18
C
C  HA EPEMEH. ACT --> LM<RMSW> = 9
C
C----------------------------------------------------------------------
C
C
C              OPMAT RMSW T # 316:
C              ----------------------
C+-----------I--------------I------I-----------------------------------
C  # COBA   I    # COBA B I KTO  I
C OT HAAA  I    OTPEKE   IOPE.I
C BCEO MSW  I    RMSW B    I      I       OOHAEHE - HAEHE
C OCAH   I    FM0022    I      I
C------------I--------------I------I-----------------------------------
C     9      I     0        I      I HOMEP A ( BCEA 0 )
C----------------------------------------------------------------------
C    10      I     1        I  DM  I  FQ - A HOBE HA. BCEH
C            I              I      I   (  CHXPO. MAKPO. P.TIP # 4 )
C    11      I     2        I  FM  I  UMAX - MAKC. BXOHO CHA;
C            I              I      I
C    12      I     3        I  FM  I  #  - HOMEP EMEHTA;
C    13      I     4        I  FM  I  #CM  - HOMEP TOKA EMEHTA #1;
C    14      I     5        I  LM  I  ATOKM  - AP B TOKN/N1 HAEH
C            I              I      I           TOKA HOMEP #CM
C            I              I      I           EMEHTA #;
C    15      I     6        I  FM  I  TAU  - OCTOHHA BPEMEH;
C    16      I     7        I  FM  I          PEEPB
C----------------------------------------------------------------------
C
C  OA HA MSW --> LM<BC> = 16
C
C  HA EPEMEH. ACT --> LM<RMSW> = 7
C
C----------------------------------------------------------------------
C
C
C                    OPMAT RMSW T # 317:
C                    ----------------------
C+-----------I--------------I------I-----------------------------------
C  # COBA   I    # COBA B I KTO  I
C OT HAAA  I    OTPEKE   IOPE.I
C BCEO MSW  I    RMSW B    I      I       OOHAEHE - HAEHE
C OCAH   I    FM0022    I      I
C------------I--------------I------I-----------------------------------
C     9      I     0        I      I HOMEP A ( BCEA 0 )
C----------------------------------------------------------------------
C    10      I     1        I  DM  I  FQ - A HOBE HA. BCEH
C            I              I      I   (  CHXPO. MAKPO. P.TIP # 4 )
C    11      I     2        I  FM  I  UMAX - MAKC. BXOHOE HAPEHE;
C            I              I      I
C    12      I     3        I  FM  I  #  - HOMEP EMEHTA;
C    13      I     4        I  FM  I  #CM  - HOMEP TOKA EMEHTA #1;
C    14      I     5        I  LM  I  ATOKM  - AP B TOKN/N1 HAEH
C            I              I      I           TOKA HOMEP #CM
C            I              I      I           EMEHTA #;
C    15      I     6        I  FM  I   W   - ACTOTA KOEAH ();
C    16      I     7        I  FM  I   E   - KOEHT EMPOBAH;
C    17      I     8        I  DM  I  TN   - BPEM P T=TN
C    18      I     9        I  DM  I  TN-1 - BPEM P T=TN-1
C    19      I    10        I  DM  I  YN   - BXOHO CHA P T=TN
C    20      I    11        I  DM  I  YN-1 - BXOHO CHA P T=TN-1
C----------------------------------------------------------------------
C
C  OA HA MSW --> LM<BC> = 20
C
C  HA EPEMEH. ACT --> LM<RMSW> = 11
C
CZZZ-------------------------------------------------------------------
       COMMON /PROF1/ MASPRT(200)
       DIMENSION BA0T(*), KNOTT(*), PAR0T(*), RMSW(*)
       EQUIVALENCE( NWTR, MASPRT(13) )
       EQUIVALENCE( NWTRE, MASPRT(14) )
       EQUIVALENCE( FGMSW, MASPRT(87) )
       EQUIVALENCE ( RN  ,   N  )
       INTEGER  TIP, BA0T, FGMSW
       NEL = BA0T(1)
       TIP = BA0T(2)
       NTIP= TIP - 313
       IF ( NTIP .GE. 1 .AND. NTIP .LE. 4 ) GO TO 1
C!!!-------------------------------------------------------------------
       WRITE(NWTRE, 501 ) NEL, TIP
501    FORMAT(/' *** O. CO B FM0022 --> HOMEP TA HE HA ***'/
     =  ' *** HOMEP EMEHTA ', I5, ' HOMEP TA ', I5, ' ***'/)
C!!!-------------------------------------------------------------------
       CALL SUBERR(TIP)
C######################################################################
1      CONTINUE
       GO TO (100,100,200,300),NTIP
C----------------------------------------------------------------------
C---> POOPOHAHO-HTEPPEE    BEHO ( T  # 314 )
C---> POOPOHAHO-EPEHPEE BEHO ( T  # 315 )
C----------------------------------------------------------------------
100   CONTINUE
       IF ( FGMSW .EQ. 0 ) GO TO 1001
C----------------------------------------------------------------------
C-->  TOHT LM <O >
       LM = 18
       RETURN
C######################################################################
1001   CONTINUE
C-->  PHT  TO MOHO COPMPOBAT..
       LM = 9
       DO 2 I=1,LM
2      RMSW(I) = 0.0
C----------------------------------------------------------------------
C---> AOMHM AHHE  ------------------------------------------------
       NELBX = IFIX( PAR0T(1) )
       IF( NELBX .GT. NEL ) GO TO 9999
       N = NELBX
       RMSW(3) = RN
       N = IFIX( PAR0T(2) )
       RMSW(4) = RN
       RMSW(6) = PAR0T(3)
       RMSW(7) = PAR0T(4)
       RMSW(2) = PAR0T(5)
       RMSW(8) = PAR0T(6)
       RMSW(9) = PAR0T(7)
C----------------------------------------------------------------------
C---> POBEPM, PABHO  BBEEH AHHE?
       IF( PAR0T(3) .GT. 0. .AND. PAR0T(4) .GT. 0. ) RETURN
C!!!-------------------------------------------------------------------
       WRITE(NWTRE, 505 ) NEL, TIP
505    FORMAT(/' *** OKA B FM0022 -->HEPABHO AAH OCTOHHE BP
     =EMEH ***'/' ***  EMEHT ', I5, ' HOMEP TA ', I5,' ***'/
     =           ' *** BCEH PEKPAATC              ***')
C!!!-------------------------------------------------------------------
       CALL SUBERR(TIP)
C----------------------------------------------------------------------
       RETURN
C######################################################################
C----------------------------------------------------------------------
C---> AOBPAATE ( T  # 316 )
C----------------------------------------------------------------------
200   CONTINUE
       IF ( FGMSW .EQ. 0 ) GO TO 2001
C----------------------------------------------------------------------
C-->  TOHT LM <O >
       LM = 16
       RETURN
C######################################################################
2001   CONTINUE
C-->  PHT  TO MOHO COPMPOBAT..
       LM = 7
       DO 3 I=1,LM
3      RMSW(I) = 0.0
C----------------------------------------------------------------------
C---> AOMHM AHHE  ------------------------------------------------
       NELBX = IFIX( PAR0T(1) )
       IF( NELBX .GT. NEL ) GO TO 9999
       N = NELBX
       RMSW(3) = RN
       N = IFIX( PAR0T(2) )
       RMSW(4) = RN
       RMSW(6) = PAR0T(3)
       RMSW(2) = PAR0T(4)
C----------------------------------------------------------------------
C---> POBEPM, PABHO  BBEEH AHHE?
       IF( PAR0T(3) .GT. 0. ) RETURN
C!!!-------------------------------------------------------------------
       WRITE(NWTRE, 501 ) NEL, TIP
       CALL SUBERR(TIP)
C!!!-------------------------------------------------------------------
C----------------------------------------------------------------------
       RETURN
C######################################################################
C----------------------------------------------------------------------
C---> KOEATEHOE   BEHO ( T  # 317 )
C----------------------------------------------------------------------
300   CONTINUE
       IF ( FGMSW .EQ. 0 ) GO TO 3001
C----------------------------------------------------------------------
C-->  TOHT LM <O >
       LM = 20
       RETURN
C######################################################################
3001   CONTINUE
C-->  PHT  TO MOHO COPMPOBAT..
       LM = 11
       DO 4 I=1,LM
4      RMSW(I) = 0.0
C----------------------------------------------------------------------
C---> AOMHM AHHE  ------------------------------------------------
       NELBX = IFIX( PAR0T(1) )
       IF( NELBX .GT. NEL ) GO TO 9999
       N = NELBX
       RMSW(3) = RN
       N = IFIX( PAR0T(2) )
       RMSW(4) = RN
       RMSW(6) = PAR0T(3)
       RMSW(7) = PAR0T(4)
       RMSW(2) = PAR0T(5)
C----------------------------------------------------------------------
C---> POBEPM, PABHO  BBEEH AHHE?
       IF( PAR0T(3) .GT. 0. .AND.
     =     PAR0T(4) .GE. 0. .AND.  PAR0T(4) .LT. 1.) RETURN
C!!!-------------------------------------------------------------------
       WRITE(NWTRE, 502 ) NEL, TIP
502    FORMAT(/' *** OKA B FM0022 -->HEPABHO AAH AHHE ***'/
     =         ' ***  EMEHT ', I5, ' HOMEP TA ', I5,' ***'/
     =         ' *** BCEH PEKPAATC              ***')
       CALL SUBERR(TIP)
C!!!-------------------------------------------------------------------
       RETURN
C######################################################################
9999   CONTINUE
C!!!-------------------------------------------------------------------
       WRITE(NWTRE, 504 ) NEL, TIP,NELBX
504    FORMAT(/' *** OKA B FM0022 -->HEPABHO AAH BXOHE AHH
     =E   ***'/' *** HA BXO EMEHTA ', I5, ' HOMEP TA ', I5,' ***',
     =         ' *** OAETC TOK EMEHTA, MEEO O OPKOB
     =HOMEP ( # ' ,I3,' )  *** ')
C!!!-------------------------------------------------------------------
       CALL SUBERR(TIP)
C######################################################################
       RETURN
       END
