         SUBROUTINE DM0004 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                         MSWALL, RMSWAL, ADRMSW )
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)------------
C   OPOPAMMA:  DM0004 ( MSW, RMSW, YALL, JALL, LOGYTR,
C   ------------             TOKN, TOKN1, VALLN, VALLN1, KOD,
C                              MSWALL, RMSWAL, ADRMSW )
C
C   HAHAEHE:    B ABCMOCT OT HAEH AA ZAPROS [MASPRT(28)]:
C   -----------    BOHET CEE HK:
C
C                  A) ZAPROS = 1
C                     ----------
C                  OPMPOBAHE BKAOB B YALL MATP POBOMOCTE 
C                  JALL - BEKTOP CTOHKOB TOKA HAEH APAMETPOB
C                  KBBAEHTHX  G - J BETBE  MOE EMEHTOB E
C                  TA # 4 [ CTOHK OCTOHHOO TOKA ]
C                  TA # 5 [ CTOHK OCTOHHOO HAPEH ]
C                  ********************************************
C                  B) ZAPROS = 2
C                     ----------
C                  BCEHE HAEH TOKOB B BETBX B T(N+1) MOMEHT
C                  BPEMEH   CXO  G  J APAMETPOB  HAEH
C                  OBX HAPEH HA EMEHTE PACTAHHX  T(N+1)
C                     AC (KCA) TX HAEH B "TOK T(N+1)";
C
C                  C) ZAPROS = 3
C                     **********
C                     HE OEPBAETC ( PEEPB );
C
C                  D) ZAPROS = 3
C                     **********
C                     HE OEPBAETC;
C
C   METO:         CKPETA PABHEH COCTOH MOE AHHOO
C   -----          TA HA OCHOBE METOA HEPA BO:
C                  Y(N+1) = Y(N) + H1*F(N+1) + H2*F(N).
C
C   APAMETP:     MSW, RMSW - PABEE COBO COCTOH MAKPOMOE
C   ---------      ( "OTPEOK" MACCB MSWALL -> C.M. / GETMSW );
C                  YALL - MATPA P0BOMOCT AHAPEMO E;
C                  JALL - BEKTOP CTOHKOB TOKA AHAPEMO E;
C                  VALLN- BEKTOP OBX HAPEH AHAPEMO E:
C                         B T = TN;
C                  VALLN1- BEKTOP OBX HAPEH AHAPEMO E:
C                          B T = TN + H0;
C                  TOKN   TOKN1 - BEKTOPA "TOKOB" EPEMEHHX COCTOH
C                                  MOE EMEHTA B TN  TN+H0;
C                                  PAMEPHOCT CM. MASPRT(46)=NNTOK;
C                  LOGYTR - BEKTOP PHAKOB K.. OB:
C                  COETC B MAKPOMOEX C PHAKOM TA = 5;
C                  PAMEPHOC MACCBOB P "ALL" OPEETC:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKA_PAMEPHOCT ---> NSYS = MASPRT(26)
C                  KOD - APAMETP OPATHO CB C MOHTOPOM DM....
C                   ( COETC  MAKPOMOEE "EAHX" KE)
C
C
C
C   OPOPAMM:  1. COMMON PROF1, PROF2, PROF3,
C   ------------             DEPOST;
C
C   PMEAHE:  1.CTPKTP MSW COBA MAKPOMOE AHHOO TA CM. HE
C   ----------   2. P ZAPROS ^=  1    2 - COOEHE  XO;
C
C
C               "OCTOHHA" ACT MSW TA # 4    # 5:
C                ---------------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I P.  I KO I KO. IAP.   IPE I
C  I EME I TA   I /    I TA   I ECT I BB. IHA.  IE I
C  I HTA   I MOE I PACETAI MOE I BO   I HA I"TOKN" IPB I
C  I       I        I DM.....I        I OBI EH.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I   7   I 8 I
C  +-------+--------+--------+--------+------+------+-------+---+
C
C
C
C                  RMSW TA # 4 [ CTOHK OCTOHHOO TOKA ]
C                  -------------------------------------------
C
C                SPM
C +-----+-----++------+
C IHOM. I HOM.II HA.I
C IA IA II   J  I
C I "K" I "M" II      I
C +-----+-----++------+
C I 9   I 10  II  11  I
C +-----------++------+
C
C
C             RMSW TA # 5 [ CTOHK OCTOHHOO HAPEH ]
C             ------------------------------------------------
C
C                   SPM
C +-----+-----++--------+------+
C IHOM. I HOM.II HA.  I HA.I
C IA IA II  1/R   I  E/R I
C I "K" I "M" II        I      I
C +-----+-----++--------+------+
C I 9   I 10  II  11    I  12  I
C +-----------++--------+------+
C
C
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION MSWALL(*), RMSWAL(*)
         INTEGER ADRMSW
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( NDALL,  MASPRT(23) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( FKOM,   MASPRT(34) )
         EQUIVALENCE ( TXG,    MASPRT(35) )
         EQUIVALENCE ( NTXG,   MASPRT(36) )
         EQUIVALENCE ( EPSKOM, MASPRT(39) )
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         INTEGER FKOM, ZAPROS, TIP
         REAL JALL,  JE
C===>    BCTPOEHHA HK OCBAH BXMEPHX MACCBOB:
         ID(I,J) = NDALL * (J-1)  +  I
C---->    OKEH:
         K = MSW(9)
         M = MSW(10)
C--->  KOHTPO TA
         TIP = MSW(2)
         IF ( TIP .NE. 4  .AND.  TIP .NE. 5 ) GO TO  9999
C---> BOP PEMA:
         GO TO ( 667, 666                 ), ZAPROS
C===> HAE OKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHTOP #', I4, ' APOC OCBAH OOEH
     = ***'/ ' *** ZAPROS = ', I5, ' - HOPPETC ***')
         RETURN
667      CONTINUE
C-----------ZAPROS = 1-------------------------------------------------
C--->  TO A T?
         IF ( TIP .EQ. 5 ) GO TO 5
C######################################################################
C---> CTOHK OCTOHHOO TOKA ( T #4 )
C--->  BCEHE G - J APAMETPOB  X AC A MSW:
         GE = 0.0
         JE = RMSW(11)
C--->   OEMEHTH BKA:
C======================================================================
         KOD = 0
C--->
         CALL DEPOST( K, M, GE, JE, YALL, JALL )
C--->
         RETURN
C######################################################################
C---> CTOHK OCTOHHOO HAPEH ( T #5 )
5      CONTINUE
C--->  BCEHE G - J APAMETPOB  X AC A MSW:
         GE = RMSW(11)
         JE = RMSW(12)
C--->   OEMEHTH BKA:
C======================================================================
         KOD = 0
C--->
         CALL DEPOST( K, M, GE, JE, YALL, JALL )
C--->
         RETURN
C======================================================================
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
666      CONTINUE
C--->  TO A T?
         IF ( TIP .EQ. 5 ) GO TO 15
C######################################################################
C---> CTOHK OCTOHHOO TOKA ( T #4 )
         TOKT = RMSW(11)
         ITOK = MSW(7)
         TOKN1( ITOK ) = TOKT
         KOD = 0
       RETURN
C######################################################################
C---> CTOHK OCTOHHOO HAPEH ( T #5 )
15     CONTINUE
C--->  OPEEEM TOK:   ZAPROS =  1
         GE = RMSW(11)
         JE = RMSW(12)
C--->  HOB TOK:
         VK = 0.0
         IF ( K .NE. 0 ) VK = VALLN1(K)
         VM = 0.0
         IF ( M .NE. 0 ) VM = VALLN1(M)
         UE = VK - VM
         TOKT = GE * UE  + JE
C---> EPEAC TOKOB
         ITOK = MSW(7)
         TOKN1( ITOK ) = TOKT
         KOD = 0
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** O. CO B DM0004 - APOC HA OCBAHE O
     =O TA ***'/
     =    ' *** EMEHT # ', I10, ' T MOE # ', I10, ' ***'//)
         CALL SUBERR(0)
         END
