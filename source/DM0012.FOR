         SUBROUTINE DM0012 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                       MSWALL, RMSWAL, ADRMSW )
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)------------
C   OPOPAMMA:  DM0012 ( MSW, RMSW, YALL, JALL, LOGYTR
C  -------------             TOKN, TOKN1, VALLN, VALLN1, KOD,
C                            MSWALL, RMSWAL, ADRMSW )
C
C   HAHAEHE:    B ABCMOCT OT HAEH AA ZAPROS [MASPRT(28)]:
C   -----------    BOHET CEE HK:
C
C                  A) ZAPROS = 1
C                     ----------
C                  OPMPOBAHE BKAOB B YALL MATP POBOMOCTE 
C                  JALL - BEKTOP CTOHKOB TOKA HAEH APAMETPOB
C                  KBBAEHTHX  G - J BETBE  MOE EMEHTA E
C                  TA # 71, # 72  720 [ HEHEHE R    L  ]
C                  ********************************************
C
C                   B.A.X     - AAETC CAH-PAOEHEM
C                               EPE MACCB MAS < I1 1 .... >
C                                ( CM. / FM0007 );
C                  EMEHT OCBAETC:
C                  --------------------
C            ?? T 71[72]    K  M
C
C                   MAS < I1 U1 ...... >  -  # 71  BOT_AMEP. X-KA
C                   MAS < I1 1 ...... >; -  # 72  BEEP_AMEP. X-KA
C                   MAS < I1 L1.... >; -  # 720 -> L_ OT TOKA;
C
C               *** BOMOH TEPAOHHE TOHEH ***:
C                   P BOEH FITER [ MASPRT(65) ] --->
C                   HAEH "TOK"_ - POHO BHM METOOM -
C                   HE BCTC, A BPATC  MACCBA TOKN1;
C               ***
C              ===  RN -> KOHTPO O AEH HAPEH;
C                   RN -> KOHTPO O PECKAAHHOM  TOHEHHOM
C                            HAEH TOKA;
C              ===
C                  B) ZAPROS = 2
C                     ----------
C                  BCEHE HAEH TOKOB B BETBX B T(N+1) MOMEHT
C                  BPEMEH   CXO  G  J APAMETPOB  HAEH
C                  OBX HAPEH HA EMEHTE PACTAHHX  T(N+1)
C                     AC (KCA) TX HAEH B "TOK T(N+1)";
C                 - P TOM KOHTPOPETC "PACXOEHE" ME
C                   HAEHM, OEHHM O BHO CXEME (POHO) 
C                   OPEEEHHM CXO  BCEHHX HAEH VALLN1;
C                   KOHTPO BEETC O HE PEBEH EITER[MASPRT(67)]
C                   OTHOCTEHO OPEHOCT. B HE AOPTHOM CAE
C                   B "MAXITR" ACBAETC MAX_OPEHOCT 
C                   B "NLITER" KCPETC HOMEP EMEHTA.....
C                   APAMETP "KOD" = 1;
C
C
C                  C) ZAPROS = 3
C                     **********
C                     HE OEPBAETC ( PEEPB );
C
C                  D) ZAPROS = 4
C                     **********
C                     HE OEPBAETC;
C
C   METO:         CKPETA PABHEH COCTOH MOE AHHOO
C   -----          TA HA OCHOBE METOA HEPA BO:
C                  Y(N+1) = Y(N) + H1*F(N+1) + H2*F(N).
C
C   APAMETP:     MSW, RMSW - PABEE COBO COCTOH MAKPOMOE
C   ---------      ( "OTPEOK" MACCB MSWALL -> C.M. / GETMSW );
C                  YALL - MATPA P0BOMOCT AHAPEMO E;
C                  JALL - BEKTOP CTOHKOB TOKA AHAPEMO E;
C                  VALLN - BEKTOP OBX HAPEH AHAPEMO E:
C                          B T = TN;
C                  VALLN1- BEKTOP OBX HAPEH AHAPEMO E:
C                          B T = TN + H0;
C                  TOKN    TOKN1  -  HAEH "TOKOB" P T :=
C                                     TN    TN + H0;
C                                   PAMEPHOCT CM. MASPRT(46)=NNTOK;
C                  LOGYTR - BEKTOP PHAKOB K.. OB:
C                  COETC B MAKPOMOEX C PHAKOM TA = 5;
C                  PAMEPHOC MACCBOB P "ALL" OPEETC:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKA_PAMEPHOCT ---> NSYS = MASPRT(26)
C                  KOD - APAMETP OPATHO CB C MOHTOPOM DM....
C                   ( =1 P OO OK. OPEHOCT );
C                 MSWALL( (RMSWAL ) - BEC CCOK MSW_ALL,
C                 ADRMSW - APEC TEK. COAB MSW ( RMSW );
C
C
C
C
C   OPOPAMM:  1. COMMON PROF1, PROF2, PROF3;
C   ------------      DEPOST, SEVAL0
C
C   PMEAHE:  1.CTPKTP MSW COBA MAKPOMOE AHHOO TA CM. HE
C   ----------   2. P ZAPROS ^=   1  2 - COOEHE  XO;
C
C
C               "OCTOHHA" ACT MSW TA # 71    # 72, # 720:
C                ------------------------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I PHAKI KO I KO. IAP.   IPE I
C  I EME I TA   I /    I TA   I ECT I BB. IHA.   IE I
C  I HTA   I MOE I PACETAI MOE I BO   I HA I"TOKN" IPB I
C  I       I        I DM.....I       .I OBI EH.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I  7    I 8 I
C  +-------+--------+--------+--------+------+------+-------+---+
C
C
C                  RMSW TA # 71, #72    #720 [ HEHEHE R  L ]:
C                  --------------------------------------------------
C                                                        LM=<EPEMEHHA>
C                                                          =+1<VAR>
C                                                  (OT KO-AB TOEK BAX)
C                    SPM
C+--+---+-----+----+-----------------------+
CI  I   I  G  I  J I  XY_MAS               I
CI KI M I     I    I MACCB TOEK BAX.     I    MACB "B", "C", "D" -->
CI  I   I     I    I N,(X,Y).."B","C","D"  I    CAH PAOEHE BAX:
C+--+---+-----+----+-----------------------+
CI9 I 10I  11 I 12 I 13 ...12+(5*N+1)      I
C+--+---+-----+----+-----------------------+
C
C   N -> KOECTBO TOEK BAX.
C
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         DIMENSION MSWALL(*), RMSWAL(*)
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
         INTEGER ADRMSW
         REAL JALL, JNEL, MAXITR
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( NNTOK,  MASPRT(46) )
         EQUIVALENCE ( NSYS,   MASPRT(26) )
         EQUIVALENCE ( NWTRE,  MASPRT(14) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( FITER,  MASPRT(65) )
         EQUIVALENCE ( EITER,  MASPRT(67) )
         EQUIVALENCE ( NLITER, MASPRT(79) )
         EQUIVALENCE ( MAXITR, MASPRT(80) )
         EQUIVALENCE ( NSITER, MASPRT(88) )
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         INTEGER FITER, TIP, ZAPROS
C-->    HO POBOHO.......
         DATA EK00/ 1E-9/
C**********************************************************************
C-->  KAATE HA TOK
       ITOK = MSW(7)
C-->   OKEH..
       K = MSW(9)
       M = MSW(10)
       TIP = MSW(2)
C-->
       IF ( TIP .EQ. 71  .OR. TIP .EQ. 72  .OR. TIP .EQ.720) GO TO 9900
       GO TO 9999
9900   CONTINUE
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C--->  BOP PEMA APOCA..
       GO TO( 100, 200), ZAPROS
C===> HAE OKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHTOP #', I4, ' APOC OCBAH OOEH
     = ***'/ ' *** ZAPROS = ', I5, ' - HOPPETC ***')
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C---- ZAPROS = 1 ------------------------------------------------------
100    CONTINUE
C-->  TO A MOE..?
       IF ( TIP .EQ. 72 ) GO TO 150
       IF ( TIP .EQ. 720 ) GO TO 160
C--- HEH. PECTOP, ZAPROS = 1 ++++++++++++++++++++++++++++++++++++++
C-->  OKPECHOCT OPEEEH TOK_A
       TOK = TOKN(ITOK)
C-->  HO MOET T TO TEP. TO..
       IF ( FITER .EQ. 1 ) TOK = TOKN1( ITOK )
C-->  HAEHE O BAX..
       KODFUN = 1
       FUN = SEVAL0( KODFUN, TOK, RMSW(13) )
       KODFUN = 2
       DFUN = SEVAL0( KODFUN, TOK, RMSW(13) )
C!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
       IF ( DFUN .EQ. 0.0 ) WRITE(NWTRE,101) MSW(1), TIP, TN, TOK
       IF ( DFUN .EQ. 0.0 ) DFUN = EK00
101    FORMAT(/' *** EMEHT # ', I5, ' T # ', I3, ' - 0-',
     = ' POBOHA ***'/
     = ' *** BPEM ', G12.5, ' HAEHE TOKA ', G12.5, ' OTKA',
     = ' KOPPEK ***'/)
102    FORMAT(/' *** EMEHT # ', I5, ' T # ', I3, ' - 0-',
     = ' . HKTBHOCT ***'/
     = ' *** BPEM ', G12.5, ' HAEHE TOKA ', G12.5, ' OTKA',
     = ' KOPPEK ***'/)
C!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
C--->  G-J ..
       G = 1.0 / DFUN
       JNEL = TOK - FUN * G
C-->  KCPOBAT
       RMSW(11) = G
       RMSW(12) = JNEL
C-->  BOT
       CALL DEPOST( K, M, G, JNEL, YALL, JALL )
       KOD = 0
       RETURN
C######################################################################
150    CONTINUE
C-->  "LN", ZAPROS=1
C-->  "CTAP" TOK..
       TOK = TOKN(ITOK)
       IF ( FITER .EQ. 1 ) GO TO 151
C-->  OPE. AP-P B "N" TOKE..
       KODFUN = 2
       DFUN = SEVAL0( KODFUN, TOK, RMSW(13) )
       IF ( DFUN .EQ. 0.0 ) WRITE(NWTR,101) MSW(1), TIP, TN, TOK
       IF ( DFUN .EQ. 0.0 ) DFUN = EK00
C-->  CTAPOE AEHE...
       VK = 0.0
       VM = 0.0
       IF ( K .NE. 0 ) VK = VALLN(K)
       IF ( M .NE. 0 ) VM = VALLN(M)
       UL = VK - VM
C-->  CTOHK O CTAPOM TOK..JNEL...
       JNEL = TOK
       IF ( H2 .NE. 0.0 ) JNEL = JNEL + H2*UL/DFUN
       RMSW(12) = JNEL
C--> YTOK --> POHO..
       YTOK = TOK + H0 * UL/ DFUN
       TOKN1(ITOK) = YTOK
C-->  CTAT G  BOT...
151    CONTINUE
       YTOK = TOKN1( ITOK )
       JNEL = RMSW(12)
C-->  O YTOK   HAEM G..
       KODFUN = 2
       DFUNX = SEVAL0(KODFUN, YTOK, RMSW(13) )
       IF ( DFUNX .EQ. 0.0 ) WRITE(NWTRE, 101) MSW(1), TIP, TN, YTOK
       IF ( DFUNX .EQ. 0.0 ) DFUNX = EK00
       G = H1 / DFUNX
       RMSW(11) = G
C-- TA EO...
       CALL DEPOST(K, M, G, JNEL, YALL, JALL )
       KOD = 0
       RETURN
C######################################################################
160    CONTINUE
C-->  "LN", ZAPROS=1,  L_EP.
C-->  "CTAP" TOK..
       TOK = TOKN(ITOK)
       IF ( FITER .EQ. 1 ) GO TO 161
C-->  OPE. AP-P B "N" TOKE..
       KODFUN = 1
       DFUN = SEVAL0( KODFUN, TOK, RMSW(13) )
       IF ( DFUN .EQ. 0.0 ) WRITE(NWTR,102) MSW(1), TIP, TN, TOK
       IF ( DFUN .EQ. 0.0 ) DFUN = EK00
C-->  CTAPOE AEHE...
       VK = 0.0
       VM = 0.0
       IF ( K .NE. 0 ) VK = VALLN(K)
       IF ( M .NE. 0 ) VM = VALLN(M)
       UL = VK - VM
C-->  CTOHK O CTAPOM TOK..JNEL...
       JNEL = TOK
       IF ( H2 .NE. 0.0 ) JNEL = JNEL + H2*UL/DFUN
       RMSW(12) = JNEL
C--> YTOK --> POHO..
       YTOK = TOK + H0 * UL/ DFUN
       TOKN1(ITOK) = YTOK
C-->  CTAT G  BOT...
161    CONTINUE
       YTOK = TOKN1( ITOK )
       JNEL = RMSW(12)
C-->  O YTOK   HAEM G..
       KODFUN = 1
       DFUNX = SEVAL0(KODFUN, YTOK, RMSW(13) )
       IF ( DFUNX .EQ. 0.0 ) WRITE(NWTRE, 102) MSW(1), TIP, TN, YTOK
       IF ( DFUNX .EQ. 0.0 ) DFUNX = EK00
       G = H1 / DFUNX
       RMSW(11) = G
C-- TA EO...
       CALL DEPOST(K, M, G, JNEL, YALL, JALL )
       KOD = 0
       RETURN
C######################################################################
C######################################################################
C######################################################################
200    CONTINUE
C--> ZAPROS = 2
C-->  HOBOE AEHE..
       VK = 0.0
       VM = 0.0
       IF ( K .NE. 0 ) VK = VALLN1(K)
       IF ( M .NE. 0 ) VM = VALLN1(M)
       UL = VK - VM
C-->  TOK..
       TOKX = RMSW(11) * UL  +  RMSW(12)
C--> MOE ???
       IF ( TIP  .EQ. 72  .OR. TIP .EQ. 720    ) GO TO 250
C--->  "RN" ....
C-->  "HOB" TOK
       TOKN1(ITOK) = TOKX
C-->  "BOCTAHOBM" P..
       KODFUN = 1
       URX = SEVAL0( KODFUN, TOKX, RMSW(13) )
C-->  OEHM OPEHOCT..
       X1 = ABS( UL )
       X2 = ABS( URX )
       IF ( X1 .LE. ZEROCP  .OR.  X2 .LE. ZEROCP ) GO TO 201
       XZ = AMAX1( X1, X2 )
       EPS = ABS( X1-X2) / XZ
       GO TO 202
201    EPS = ABS( X1 - X2 )
202    CONTINUE
C-->  OCTMO TO..?
       KOD = 0
       IF ( EPS .LT. EITER ) RETURN
C                            *******
C-->  OKA..
       KOD = 1
       IF ( EPS .LT. MAXITR ) RETURN
C                             ******
       MAXITR = EPS
       NLITER = MSW(1)
       NSITER = 1
       RETURN
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
250    CONTINUE
C==> ZAPROS = ",  "LN"...        L_.  TO E CAMOE.....
C-->  PECKAAHH TOK ..
       X1 = ABS( TOKN1( ITOK ) )
C-->  OEHH TOK..
       X2 = ABS( TOKX )
C-->  AOMHM OEHH..
       TOKN1(ITOK) = TOKX
C-->  OPEM...
       IF ( X1 .LE. ZEROCP  .OR.  X2 .LE. ZEROCP ) GO TO 251
       XZ = AMAX1(X1, X2 )
       EPS = ABS(X1-X2) / XZ
       GO TO 252
251    EPS = ABS( X1 - X2 )
252    CONTINUE
       KOD = 0
       IF ( EPS .LT. EITER ) RETURN
C                            *******
       KOD = 1
       IF ( EPS .LT. MAXITR ) RETURN
C                             ******
       MAXITR = EPS
       NLITER = MSW(1)
       NSITER = 1
       RETURN
C######################################################################
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** O. CO B DM0012 - APOC HA OCBAHE O
     =O TA ***'/
     =    ' *** EMEHT # ', I10, ' T MOE # ', I10, ' ***'//)
         CALL SUBERR(0)
         END
