         SUBROUTINE DM0015 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                         MSWALL, RMSWAL, ADRMSW )
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)------------
C   OPOPAMMA:  DM0015 ( MSW, RMSW, YALL, JALL, LOGYTR,
C   -------------            TOKN, TOKN1, VALLN, VALLN1, KOD,
C                              MSWALL, RMSWAL, ADRMSW )
C
C   HAHAEHE:    MOHTOP MOE "BOTE" [ MO. #50, .T # 6 ]
C   -----------    ****************************************************
C                   *** HE -3_0 --> PEOPAOBATE ACTOT*********
C
C                      O PABM HAPEHM, OAEMM 
C              MOEE EMEHTOB, X BPAATBAX --> #40(PETOP
C              BOEH), #13("MEPTE" HAPEH), #63( 3-X
C              AHA ..C. )  T.. ( B TOKN/TOKN1 -> EPBE TP
C              HAEH -> TO HAEHE HAPEH PEPOBAH ),
C             OPMPET CHA "C" HA 18-T BEHTE PEOPAOBATE
C             ACTOT; OPAHET BPAOTK CHAOB "APET/PAPEEHE"
C              "AHOHX"  "KATOHX" P BEHTE B KAO 
C             A;
C
C
C              ===  AMT PAB. CHAOB OPAHBATC O
C                   EYYV   EYYI -->  CM. SEQMAX
C              ===
C
C
C######################################################################
C    PACPEEEHE HAPEH PABEH O AAM  AHOHO-KATOHM
C                       P    A M:
C
C                      HAPEHE PABEH( MSW_PETOPA):
C                      -----------------------------------------
C
C     KATOHA PA:                         AHOHA PA:
C
C   BEHT. 01, 02, 03 -->"-"EYYA         BEHT. 04, 05, 06 --> "+"EYYA
C   BEHT. 07, 08, 09 -->"-"EYYB         BEHT. 10, 11, 12 --> "+"EYYB
C   BEHT. 13, 14, 15 -->"-"EYYC         BEHT. 16, 17, 18 --> "+"EYYC
C
C  E EYYA, EYYB, EYYC - CHA  TOKN/N1 EMEHTA "#" PABEH,
C                         EPBE TP HAEH; ( AA A, B, C );
C
C
C        PACPEEEHE OOPHX HAPEH:
C        ---------------------------------
C BEHT A "A":       BEHT A "B":       BEHT A "C":
C  !!! KATOHE !!!        !!! KATOHE !!!        !!! KATOHE !!!
C -----------------       ----------------        -----------------
C 03     --> "+"V(KXB)    02     --> "+"V(KXC)    01     --> "+"V(KXA)
C 09     --> "+"V(KXB)    08     --> "+"V(KXC)    07     --> "+"V(KXA)
C 15     --> "+"V(KXB)    14     --> "+"V(KXC)    13     --> "+"V(KXA)
C   "+" AA "B"              "+" AA "C"               "+" AA "A"
C ( E KXB )               ( E KXC )            ( E KXA )
C T.E.-120 P. OT "A"    T.E.-120 P. OT "B"    T.E.-120 P. OT "C"
C
C BEHT A "A":       BEHT A "B":       BEHT A "C":
C !!! AHOHE !!!          !!! AHOHE !!!        !!! AHOHE !!!
C -----------------       ----------------        -----------------
C     06 --> "-"V(KXB)        05 --> "-"V(KXC)        04 --> "-"V(KXA)
C     12 --> "-"V(KXB)        11 --> "-"V(KXC)        10 --> "-"V(KXA)
C     18 --> "-"V(KXB)        17 --> "-"V(KXC)        16 --> "-"V(KXA)
C   "-" AA "B"              "-" AA "C"               "-" AA "A"
C ( E KXB )               ( E KXC )            ( E KXA )
C T.E. +60 P. OT "A"    T.E. +60 P. OT "B"    T.E. +60 P. OT "C"
C
C######################################################################
C----------------------------------------------------------------------
C   "CXEMA" PEOPAOBATE:
C BEHT:1  2  3   4  5  6  7  8  9  10  11 12  13  14  15  16  17  18
C AA:   C  B  A   C  B  A  C  B  A   C   B  A   C   B   A   C   B   A
C PA:  KATO     AHO     KATO     AHO       KATO        AHO
C BXO:    AA   A            AA  B               AA   C
C B TOKN: 7  8  9  10  11 12 13 14 15  16 17 18   19 20 21   22 23 24
C "C"  25 26 27   28 29 30 31 32 33  34 35 36   37 38 39   40 41 42
C----------------------------------------------------------------------
C
C              EMEHT OCBAETC:
C
C    3 T 50  KA KB KC KRA KRB KRC
C    T_BK  DTCIU #_TA_PETOPA_BOEH<EHEPATOP
C                                                PABEO
C                                                HAPEH>;
C
C            KXA  KXB  KXC   EYYV   EYYI;
C     E:
C     ***
C              KA, KB, KC  -  TAEO 3-X AHOO HAPEH;
C              KRA, KRB, KRC -  POTOPHO OMOTK . MAH ->
C                              BXOHOE HAPEHE PEOPAOBATE
C                              ACTOT;
C
C              O BPEMEH T_BK ->  KRA, KRB, KRC -> AKOPOEH
C                 **************    ( MOEPTC "EAHM" KEM );
C
C
C              DTCIU - TEHOCT MCA "C" ->
C                      MC EHEPPTC COACHO CPABHEH
C                      HAP. OOPHOO -> BPAEMOO  MACCBA
C                      TOKN/TOKN1 EMEHTA #_._PE._BO.
C                      ( TP EPBE COBA )  HAPEH TAH
C                      PEOPAOBATE, T.E. HA AX KA, KB, KC;
C                      ( CM. DM0015 )
C              #_.BO. - MOE OPEEEH HAPEH PABEH:
C                         ( T #40, T # 63, T # 13 );
C                         ###############################
C
C                      KXA, KXB, KXC -  "OOPHO" CCTEM
C                                      HAPEH AA: "A", "B", "C";
C
C   EYYV - OPAHEHE AMT P. CHAA B BPMTEHOM PEME.
C   EYYI - OPAHEHE AMT P. CHAA B HBEPTOPHOM    PEME.
C
C
C === BBOHE HAEH: I1, I2, I3, I4, I5, I6, - TOK BHE. BBOOB,
C                        IV1, IV2, ..., IV18,    - TOK BEHTE,
C                        CIU1, CIU2, ..., CIU18 - "C" HA BEHTE;
C
C
C                    OCBAHE BEHTE EPE / DM00B9, KE -
C                      "B PH"( HEOCPECTBEHHO B POPAMME );
C
C                  B ABCMOCT OT HAEH AA ZAPROS [MASPRT(28)]:
C
C                  BOHET CEE HK:
C
C                  A) ZAPROS = 1
C                     ----------
C                 -  OPMPOBAHE BKAOB B YALL MATP POBOMOCTE
C                   HAEH "POBOMOCT" AKPTX BEHTE ( GVENT6 )
C                   [ B AHHO BEPC KOMEKCA ];
C                  - OPMPOBAHE BEKTOPA K.. OB "LOGYTR"
C                     HEHTHX OB --> COETC
C                     /  GETLOG --> OCECTBT "EMEHTAPH" BKA;
C
C                  1A) ZAPROS = 10
C                      ------------
C                      OPMPOBAHE "TEHEBO" CCTEM PABHEH
C                       ( OEMEHTH BKA )
C
C                  B) ZAPROS = 20
C                     ------------
C                  BCEHE HAEH TOKOB B BETBX B T(N+1) MOMEHT
C                  BPEMEH. P TOM TOK OTKPTX BEHTE:( K  M )
C                  <TOKN1>:= <VALLN1[K]> - <VALLN1[M]>;
C                   TOK AKPTX BEHTE = 0.0;
C                  AC TX TOKOB B MACCB TOKN1;
C                   !!! BOHT O MOKA PEEH VALLN1 !!!
C
C                  C) ZAPROS = 3
C                     -----------
C                      O OPEEEHHM TOKAM BEHTHX "E"
C                      OPMPET CHA "PAPEEHE/APET" CX  TX
C                      CXO  HAPEH PABEH  OOPHX
C                      HAPEH (  KA, KB, KC ) -->
C                      OPEEET MOMEHT "ECTECTBEHHO" KOMMTA
C                      BEHTE ( CM. / MCIU50 ); HA OCHOBE TOO
C                     OBOTC AHA HA BOMOH CMEH COCTOH
C                     BEHT [ OTKPT <==> AKPT ]:
C                     P TOM: FKOM = 0 - COCTOHE HE MEHOC;
C                               FKOM = 1 - HA TEKEM AE COCTOHE
C                                         OHO "O" MEHTC B
C                                         B T = TX MOMEHT BPEMEH;
C                                         PEAHO B POPAMME OPEE-
C                                         ETC HX - A BOMOHO
C                                         KOMMTA, ATEM TX=TN+HX;
C                                         P HX < HXMIN [MASPRT(62)]
C                                         PHMAETC HX = HXMIN;
C                                         COCTOHE HX=0.0 BBAET
C                                         EAT COOEH;
C                                         POBEEH COTBETCTBE
C                                         MEHEH B MASPRT:
C                                          FKOM <== "1"
C                                         HXG = MIN( HX, HXG )
C                                         TXG = TN + HXG
C   !!! OT 01.08.86  !!!
C              ET: ICLOSE - MO TOKA "AKPT" BEHT;
C                    UOPEN  - MO HAPEH "OTKPT" BEHT;
C
C
C                  D) ZAPROS = 4
C                     **********
C                   - P TX_G  [MASPRT(35)] .EQ. TX_BEHT   -
C                      KCPETC CMEHA COCTOH BEHT APAMETPOM
C                      KD;
C                     PABEHCTBO POBEPETC C TO. O "EPSKOM".
C
C   METO:         PAHOBHOCT BOHOBOO AOPTMA  OPMPOBAH
C   -----          MACCBA LOGYTR --> EE / GETLOG;
C
C                  "TEHEBA" CCTEMA OPMPETC "MACTAPOBAHHA"
C                   TAK, TO: V[X] - V[Y] = <TOK    X-Y   BETB>;
C                   , OTMEEHHE B LOGYTR(*) = 0 - "AOBE"
C                    KAO HEHTHO P OTKPTX BEHTE;
C
C   APAMETP:     MSW, RMSW - PABEE COBO COCTOH MAKPOMOE
C   ---------      ( "OTPEOK" MACCB MSWALL -> C.M. / GETMSW );
C                  YALL - MATPA P0BOMOCT AHAPEMO E;
C                  JALL - BEKTOP CTOHKOB TOKA AHAPEMO E;
C                  VALLN - BEKTOP OBX HAPEH AHAPEMO E:
C                          P  T  =  TN;
C                  VALLN1- BEKTOP OBX HAPEH AHAPEMO E:
C                          P  TN + H0;
C                  TOKN   TOKN1 - HAEHE EPEMEHHX "COCTOH"
C                                  MOE P TN    TN + H0;
C                          ( PAMEPHOCT -> CM. MASPRT(46) = NNTOK )
C                  LOGYTR - BEKTOP PHAKOB K.. OB:
C                  COETC B MAKPOMOEX C PHAKOM TA = 6;
C                  PAMEPHOC MACCBOB P "ALL" OPEETC:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKA_PAMEPHOCT ---> NSYS = MASPRT(26)
C                  KOD - APAMETP OPATHO CB C MOHTOPOM DM....
C
C
C
C
C   OPOPAMM:  1. COMMON PROF1, PROF2, PROF3;
C   ------------   2.          SEQCIU, DM00B9, SEQMAX;
C                              -------
C   PMEAHE:  1.CTPKTP MSW COBA MAKPOMOE AHHOO TA CM. HE
C   ----------   2. P ZAPROS ^=1, 10,20,3,4 - BAA COOEH  XO
C                3. P FTEST = 1 -> EAT HA WTRE AKTA CMEH COCTOH
C                4. C 3.10.86 --> KCA CXA+CXK  SUQCIU.
C
C              OPMAT MSW # TA 50 [ BOTE, HE ]:
C              -------------------------------------------
C               "OCTOHHA" ACT
C               ******************
C
C  +-------+--------+--------+--------+------+------+--------+----+
C  I HOMEP I HOMEP  I HOMEP  I  P. I KO I KO. I AP.   I PE I
C  I EME I TA   I /    I TA   I ECT I BB. I HA.  I E I
C  I HTA   I MOE I PACETAI (PE.) I BO   I HA I "TOKN" I PB I
C  I       I        I DM.....I       .I OBI EH.I "TOKN1"I    I
C  +-------+--------+--------+--------+------+------+--------+----+
C  I  1    I   2    I   3    I    4   I   5  I  6   I   7    I 8  I
C  +-------+--------+--------+--------+------+------+--------+----+
C
C
C              EPEMEHHA ACT MSW:
C              *********************
C
C  COBO     COBO     OOHAEH  OECKOE HAEHE
C  OT        OT
C  HAAA    EPEMEH.
C  MSW       ACT
C
C  9,10,11    -        KA, KB, KC, - HOMEPA OB A "TAH"
C  12,13,14   -        KRA< KRB, KRC - HOMEPA OB BXOHOO
C                                      HAPEH HE-3_0
C-- -- - - - - --- - - - - - - - -
C   15         1       [F] NPB - HOMEP EMEHTA, OCTABEO
C                                HAPEHE PABEH;
C  16          2       [L] ANPB - APEC B MSW_ALL NPB EMEHTA;
C  17          3       [L] AUYP - APEC B TOKN/N1 NPB EMEHTA;
C  18          4       [F] TBKL - BPEM BK. HE;
C  19          5       [F] DTCIU - T. MCA "C"
C 20, 21     6, 7      [F] EYYV,  EYYI - OPAHEH OB.
C  22         8             "HX"  KE K.. OB;
C 23<->25    9<->11  [F]     HOMEPA "OOPHX" OB;
C 26<->29    12<->15          PEEPB;
C
C 30<->39    16<->25      MSWV1  -  COBO PABEH 1-M BEHTEM
C 40<->49    26<->35      MSWV2  -  COBO PABEH 2-M BEHTEM
C .....................................................................
C 200<->209   186<->195   MSWV18 -  COBO PABEH 18-M BEHTEM
C**********************************************************************
C
C   LM OA = 209 COB, LM_OK. = 195
C
C       OPMAT MSWV_EHT  DM00B9:
C       -------------------------------
C
C      COBO                   HAEHE
C
C      1       KD - KO COCTOH: =0 - AKPT, =1 - OTKPT;
C      2       HX - A OT TN, BOMOHOE BPEM EPEKEH;
C
C ( B [*] HOMEPA MSW_VEHT  / "MCIU50" )
C
C  [1] 3       TS - BPEM CTAPTA MCA( "E" KOMMTA );
C  [2] 4       TK - BPEM HA MCA( "E" KOMMTA );
C  [3] 5       CX - KO PAPEEH/APETA "C":
C                   =0 - C APEEHO OABAT HA BEHT,
C                   =1 - C PAPEEHO OABAT HA BEHT;
C [4] 6        TX - BPEM, C KOTOPOO ECTBET KO "CX";
C
C
C [5] 7        MCIU - KO MCA --->
C                     MCIU   = 00  --> "C" HET B [TN, TN+H0];
C                                       HXCIU = 0.0;
C                     MCIU   = 01  --> B [TN, TN+H0] -> EPEH POHT
C                                   MCA "C", HXCIU = HTEPBA OT
C                                      TN O EPEHEO POHTA "C";
C                     MCIU   = 10 -->  B [TN, TN+H0] -> AH POHT
C                                   MCA "C", HXCIU = HTEPBA
C                                      OT TN O AHEO POHTA MCA;
C                     MCIU   = 11 -->  B [TN, TN+H0] "C" BKEH,
C                                      COCTOHE HE MEH, HXCIU=0.0;
C
C
C [6] 8        HXCIU - A OT TN, O OEPEHOO POHTA "C";
C (---)
C     9              - A KD COCTOH
C    10              - PEEPB
C********************************************************************
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         REAL JALL
       DIMENSION MSWALL(*), RMSWAL(*), EYYN(3), EYYN1(3)
       INTEGER ADRMSW
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
         EQUIVALENCE ( MASPRT(62), HXMIN )
         EQUIVALENCE ( MASPRT(14), NWTRE )
         EQUIVALENCE ( MASPRT(59), GVENT6 )
         EQUIVALENCE ( MASPRT(94), DTMCIU )
         EQUIVALENCE ( MASPRT(60), FTEST )
         EQUIVALENCE ( MASPRT(57), OPEN6 )
         INTEGER FTEST, OPEN6
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( NDALL,  MASPRT(23) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( FKOM,   MASPRT(34) )
         EQUIVALENCE ( TXG,    MASPRT(35) )
         EQUIVALENCE ( HXG,    MASPRT(61) )
         EQUIVALENCE ( NTXG,   MASPRT(36) )
         EQUIVALENCE ( EPSKOM, MASPRT(39) )
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         INTEGER FKOM, ZAPROS
         EQUIVALENCE ( ICLOSE, MASPRT(77) )
         EQUIVALENCE ( UOPEN,  MASPRT(78) )
         REAL ICLOSE
C----------------------------------------------------------------------
       DIMENSION TOKXN(2), TOKXN1(2),  THELP(18), VHN(6), VHN1(6)
       DIMENSION KVENT(18), MVENT(18), UYN(18), UYN1(18),
     =           UON(18), UON1(18),                   TNK(3), TN1K(3),
     =           TNA(3), TN1A(3)
       INTEGER AUYP, CXA, CXK
       REAL                          IKN, IKN1, IAN, IAN1
C -->  AHOHE  ( HAAO BEHT ):
       DATA KVENT
     = /12,12,12, 11,10,09, 13,13,13, 11,10,09, 14,14,14, 11,10,09/
C--> KATOHE  ( KOH BEHTE ):
       DATA MVENT
     = /11,10,09, 12,12,12, 11,10,09, 13,13,13, 11,10,09, 14,14,14/
C
C----------------------------------------------------------------------
       KOD = 0
C--->  KOHTPO TA
         IF ( MSW(2) .NE. 50 ) GO TO 9999
       TBKL = RMSW(18)
       TN1 = TN + H0
C---> BOP PEMA:
         IF ( ZAPROS .EQ. 1 )   GO TO 100
         IF ( ZAPROS .EQ. 10 )  GO TO 200
         IF ( ZAPROS .EQ. 20 )  GO TO 300
         IF ( ZAPROS .EQ. 3 )   GO TO 400
         IF ( ZAPROS .EQ. 4 )   GO TO 500
C===> HAE OKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHTOP #', I4, ' APOC OCBAH OOEH
     = ***'/ ' *** ZAPROS = ', I5, ' - HOPPETC ***')
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** O. CO B DM0015 - APOC HA OCBAHE O
     =O TA ***'/
     =    ' *** EMEHT # ', I10, ' T MOE # ', I10, ' ***'//)
         CALL SUBERR(0)
667      CONTINUE
C---------------Z A P R O S = 1----------------------------------------
C
100    CONTINUE
       IF ( TN1 .GE. TBKL ) GO TO 101
C-->  MAKET K.. OB KRA-KRB, KRB-KRC ====>
       KRA = MSW(12)
       KRB = MSW(13)
       KRC = MSW(14)
C-->  CPOC HX_KE
       RMSW(22) = H0
C-->  KRA<->KRB:
       CALL GETLOG_(KRA, KRB, LOGYTR )
C-->  KRB<->KRC:
       CALL GETLOG_(KRB, KRC, LOGYTR )
       RETURN
C----------------------------------------------------------------------
101    CONTINUE
C-> ZAPROS = 1 -->  PAOTAET "HE" -->  OCE. BOB MOHTOPA BEHE
C-->  B COOTBETCTB C MACCBAM RMSW<50>, UYN, UYN1, UON, UON1
C
666    CONTINUE
       NEL = MSW(1)
       DO 102 NV = 1,18
C-->  APEC RMSW<50> BEHT-->
       INV = (NV-1) * 10 + 30
C-->   OKEH-->
       K1 = KVENT(NV)
       M1 = MVENT(NV)
       K = MSW(K1)
       M = MSW(M1)
C-->  HOMEP O. BEHT
       NPEL = NEL*10000+NV
C-->  MOHTOPHOE OCBAHE-->
       CALL DM00B9(K, M, NPEL, MSW(INV), RMSW(INV), YALL, JALL, LOGYTR,
     =            TOKXN, TOKXN1, VALLN, VALLN1, KOD, UON(NV), UON1(NV),
     =            UYN(NV), UYN1(NV), DTCIU )
C- - - - - -
102    CONTINUE
C**********************************************************************
       RETURN
C**********************************************************************
C**********************************************************************
C**********************************************************************
200    CONTINUE
C-->  ZAPROS = 10  -->  TEHEBA CCTEMA-->
       IF ( TN1 .GE. TBKL ) GO TO 201
C-->   K.. OB--->
       KRA = MSW(12)
       KRB = MSW(13)
       KRC = MSW(14)
C---
       G = 1.0
C---
       IF ( KRA .EQ. 0 ) GO TO 290
       IF ( LOGYTR(KRA) .EQ. -1 ) KRA = 0
290    CONTINUE
       IF ( KRB .EQ. 0 ) GO TO 291
       IF ( LOGYTR(KRB) .EQ. -1 ) KRB = 0
291    CONTINUE
C-->  "BKA"  KA KRA<->KRB--->
       CALL DEPOST( KRA, KRB, G, 0.0, YALL, JALL )
C
       IF ( KRC .EQ. 0 ) GO TO 292
       IF ( LOGYTR(KRC) .EQ. -1 ) KRC = 0
292    CONTINUE
       CALL DEPOST( KRB, KRC, G, 0.0, YALL, JALL )
C----------------------------------------------------------------------
       RETURN
201    CONTINUE
C-->  ZAPROS=10-> TO TO   ZAPROS=1
       GO TO 666
C######################################################################
C######################################################################
C######################################################################
300    CONTINUE
C-->  ZAPROS=20 -->  TOK BEHTE  KE OPEEEM...>
       IF ( TN1 .GE. TBKL ) GO TO 301
C-->  K-->
       KRA = MSW(12)
       KRB = MSW(13)
       KRC = MSW(14)
C-->> KRA-KRB
       IF ( KRA .EQ. 0 ) GO TO 390
       IF ( LOGYTR(KRA) .EQ. -1 ) KRA = 0
390    CONTINUE
       IF ( KRB .EQ. 0 ) GO TO 391
       IF ( LOGYTR(KRB) .EQ. -1 ) KRB = 0
391    CONTINUE
       TA = 0.0
       IF ( KRA .NE. 0 ) TA = VALLN1(KRA)
       TB = 0.0
       IF ( KRB .NE. 0 ) TB = VALLN1(KRB)
       TOKABR = TA - TB
C-->  KRB-KRC
       IF ( KRC .EQ. 0 ) GO TO 392
       IF ( LOGYTR(KRC) .EQ. -1 ) KRC = 0
392    CONTINUE
       TC = 0.0
       IF ( KRC .NE. 0 ) TC = VALLN1(KRC)
       TOKBCR = TB - TC
C-->  AC A TOKN1...
       ITOK = MSW(7)
C
       TOKN1( ITOK + 3 ) =  -TOKABR
       TOKN1( ITOK + 5 ) =  +TOKBCR
       TOKN1( ITOK + 4 ) =   TOKABR - TOKBCR
C-->  OCTAHE -> PABH 0.0
       TOKN1( ITOK ) = 0.0
       TOKN1( ITOK + 1 ) = 0.0
       TOKN1( ITOK + 2 ) = 0.0
C----------------------------------------------------------------------
       RETURN
C**********************************************************************
301    CONTINUE
C--> ZAPROS = 20  -> TOK BEHTE B TOKN/N1-->
C      ITOKNV --> (ITOK-1) + 6 + NV = ITOK+5+NV
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
       ITOK = MSW(7)
       NEL = MSW(1)
       DO 302 NV = 1,18
C-->  APEC RMSW<50> BEHT-->
       INV = (NV-1) * 10 + 30
C-->   OKEH-->
       K1 = KVENT(NV)
       M1 = MVENT(NV)
       K = MSW(K1)
       M = MSW(M1)
C-->  HOMEP O. BEHT
       NPEL = NEL*10000+NV
C-->  MOHTOPHOE OCBAHE-->
       CALL DM00B9(K, M, NPEL, MSW(INV), RMSW(INV), YALL, JALL, LOGYTR,
     =            TOKXN, TOKXN1, VALLN, VALLN1, KOD, UON(NV), UON1(NV),
     =            UYN(NV), UYN1(NV), DTCIU )
C- - - - - -
C-->  PACTABT OPE. HAEH TOKOB-->
       ITOKNV = ITOK + 5 + NV
       TOKN1(ITOKNV) = TOKXN1(1)
       THELP(NV) = TOKXN1(1)
302    CONTINUE
C-->  "TOOBE" TOK-->
C-->  TOK BXOHX OB --> KA, KB, KC-->
C--> HOMEP BEHT NV  O HOMEP P L-->
C    NV = (L-1)*6 + J, J-> HOMEP BEHT B PE(B AE)
       TKA = 0.0
       TKB = 0.0
       TKC = 0.0
C-->  O AHO-->
       DO 303 L=1,3
C-->  AA "A", BEHT J = 6  3:
       NV6 = (L-1)*6 + 6
       NV3 = (L-1)*6 + 3
       TKA = TKA + ( THELP(NV6) - THELP(NV3) )
C-->  AA "B", BEHT J = 5  2:
       NV5 = (L-1)*6 + 5
       NV2 = (L-1)*6 + 2
       TKB = TKB + ( THELP(NV5) - THELP(NV2) )
C-->  AA "C", BEHT J = 4, 1
       NV4 = (L-1)*6 + 4
       NV1 = (L-1)*6 + 1
       TKC = TKC + ( THELP(NV4) - THELP(NV1) )
303    CONTINUE
C-->  X KCPEM
       TOKN1(ITOK) = TKA
       TOKN1(ITOK+1) = TKB
       TOKN1(ITOK+2) = TKC
C-->  TOK BXOA EPOPAOBATE ACTOT-->
C-->  CMMPOBAHE O PAM..
       TK1 = THELP(1)  + THELP(2)  + THELP(3)
       TK2 = THELP(7)  + THELP(8)  + THELP(9)
       TK3 = THELP(13) + THELP(14) + THELP(15)
C-->  AHOHX..
       TA1 = THELP(4)   + THELP(5)  + THELP(6)
       TA2 = THELP(10)  + THELP(11) + THELP(12)
       TA3 = THELP(16)  + THELP(17) + THELP(18)
C-->  CMAPHE BX. TOK-->
       TOKN1( ITOK + 3 ) = TA1 - TK1
       TOKN1( ITOK + 4 ) = TA2 - TK2
       TOKN1( ITOK + 5 ) = TA3 - TK3
C-->  TOK E, A "C" EE HE OPEEEH....
       RETURN
C######################################################################
C######################################################################
C######################################################################
C######################################################################
400    CONTINUE
C-->  ZAPROS=3  ->  AHA BOMOHOO COCTOH/EPEKEH
       IF ( TN1 .GE. TBKL ) GO TO  401
C-->  K BKATC TOKO P:
       IF ( TN .LT. TBKL  .AND.  TBKL .LE. TN1 ) GO TO 402
C-->  HAE H EO HE MEHETC
       RETURN
402    CONTINUE
C-->  A O BOMOHO KOMMTA
       HX = TBKL - TN
C-->  EO KCPEM
       IF ( HX .LT. HXMIN ) HX = HXMIN
       RMSW(22) =  HX
       HXG = AMIN1( HX, HXG )
       TXG = TN + HXG
       FKOM = 1
       RETURN
C----------------------------------------------------------------------
401    CONTINUE
C-->  ZAPROS=3 -  TOK OPEEEH, HAEM AHOHE  KATOHE TOK B
C                 AAX BEHTE  BCHEH CX, TX
C
       ITOK1 = MSW(7) - 1 + 6
C**********************************************************************
       TNK(1)  = TOKN (ITOK1+01) + TOKN (ITOK1+02) + TOKN (ITOK1+03)
       TN1K(1) = TOKN1(ITOK1+01) + TOKN1(ITOK1+02) + TOKN1(ITOK1+03)
       TNK(2)  = TOKN (ITOK1+07) + TOKN (ITOK1+08) + TOKN (ITOK1+09)
       TN1K(2) = TOKN1(ITOK1+07) + TOKN1(ITOK1+08) + TOKN1(ITOK1+09)
       TNK(3)  = TOKN (ITOK1+13) + TOKN (ITOK1+14) + TOKN (ITOK1+15)
       TN1K(3) = TOKN1(ITOK1+13) + TOKN1(ITOK1+14) + TOKN1(ITOK1+15)
C--
       TNA(1)  = TOKN (ITOK1+04) + TOKN (ITOK1+05) + TOKN (ITOK1+06)
       TN1A(1) = TOKN1(ITOK1+04) + TOKN1(ITOK1+05) + TOKN1(ITOK1+06)
       TNA(2)  = TOKN (ITOK1+10) + TOKN (ITOK1+11) + TOKN (ITOK1+12)
       TN1A(2) = TOKN1(ITOK1+10) + TOKN1(ITOK1+11) + TOKN1(ITOK1+12)
       TNA(3)  = TOKN (ITOK1+16) + TOKN (ITOK1+17) + TOKN (ITOK1+18)
       TN1A(3) = TOKN1(ITOK1+16) + TOKN1(ITOK1+17) + TOKN1(ITOK1+18)
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C-->  CXOHE HAPEH PABEH...
C  B TOKN/N1  HAXOTC O APEC AUYP = MSW(17)
C
       AUYP = MSW(17)
C--->
       EYYN (1) = TOKN (AUYP     )
       EYYN1(1) = TOKN1(AUYP     )
       EYYN (2) = TOKN (AUYP + 1 )
       EYYN1(2) = TOKN1(AUYP + 1 )
       EYYN (3) = TOKN (AUYP + 2 )
       EYYN1(3) = TOKN1(AUYP + 2 )
C
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C  OPAHEH COACHO "PEMA".......
       EYYV = RMSW(20)
       EYYI = RMSW(21)
       CALL SEQMAX( EYYN (1), TN K(1),  TN A(1),  EYYV,  EYYI )
       CALL SEQMAX( EYYN (2), TN K(2),  TN A(2),  EYYV,  EYYI )
       CALL SEQMAX( EYYN (3), TN K(3),  TN A(3),  EYYV,  EYYI )
C-->   TN1
       CALL SEQMAX( EYYN1(1), TN1K(1),  TN1A(1),  EYYV,  EYYI )
       CALL SEQMAX( EYYN1(2), TN1K(2),  TN1A(2),  EYYV,  EYYI )
       CALL SEQMAX( EYYN1(3), TN1K(3),  TN1A(3),  EYYV,  EYYI )
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C
C-->  UYN/N1  - HAP. PABEH BEHT
C-->  UON/N1  - OOPHE HAP.
C     EYYN/N1 - HAP. PABEH PEOPAOBATE;
C  VHN / N1 - "CTHHE" HAPEH HA AX OOPHO CCTEM
C              KXA, KXB, KXC             B TN/TN+H0
C
       DO 403 I=1,3
C-->  HOMEP A:
       K = MSW(I+22)
       VKN = 0.0
       VKN1 = 0.0
       IF ( K .EQ. 0 ) GO TO 404
       VKN  =  VALLN( K )
       VKN1 = VALLN1( K )
404    CONTINUE
       VHN(I)   = VKN
       VHN1(I)  = VKN1
403    CONTINUE
C######################################################################
C    PACPEEEHE HAPEH PABEH O AAM  AHOHO-KATOHM
C                       P    A M:
C
C                      HAPEHE PABEH( MSW_PETOPA):
C                      -----------------------------------------
C
C     KATOHA PA:                         AHOHA PA:
C
C   BEHT. 01, 02, 03 -->"-"EYYA         BEHT. 04, 05, 06 --> "+"EYYA
C   BEHT. 07, 08, 09 -->"-"EYYB         BEHT. 10, 11, 12 --> "+"EYYB
C   BEHT. 13, 14, 15 -->"-"EYYC         BEHT. 16, 17, 18 --> "+"EYYC
C
C  E EYYA, EYYB, EYYC - CHA  TOKN/N1 EMEHTA "#" PABEH,
C                         EPBE TP HAEH; ( AA A, B, C );
C
C
C        PACPEEEHE OOPHX HAPEH:
C        ---------------------------------
C BEHT A "A":       BEHT A "B":       BEHT A "C":
C  !!! KATOHE !!!        !!! KATOHE !!!        !!! KATOHE !!!
C -----------------       ----------------        -----------------
C 03     --> "+"V(KXB)    02     --> "+"V(KXC)    01     --> "+"V(KXA)
C 09     --> "+"V(KXB)    08     --> "+"V(KXC)    07     --> "+"V(KXA)
C 15     --> "+"V(KXB)    14     --> "+"V(KXC)    13     --> "+"V(KXA)
C   "+" AA "B"              "+" AA "C"               "+" AA "A"
C ( E KXB )               ( E KXC )            ( E KXA )
C T.E.-120 P. OT "A"    T.E.-120 P. OT "B"    T.E.-120 P. OT "C"
C
C BEHT A "A":       BEHT A "B":       BEHT A "C":
C !!! AHOHE !!!          !!! AHOHE !!!        !!! AHOHE !!!
C -----------------       ----------------        -----------------
C     06 --> "-"V(KXB)        05 --> "-"V(KXC)        04 --> "-"V(KXA)
C     12 --> "-"V(KXB)        11 --> "-"V(KXC)        10 --> "-"V(KXA)
C     18 --> "-"V(KXB)        17 --> "-"V(KXC)        16 --> "-"V(KXA)
C   "-" AA "B"              "-" AA "C"               "-" AA "A"
C ( E KXB )               ( E KXC )            ( E KXA )
C T.E. +60 P. OT "A"    T.E. +60 P. OT "B"    T.E. +60 P. OT "C"
C
C**********************************************************************
C-->  HAPEH PABEH*******
C******* TN BPEM *****************************************************
C   K A T O  H A     P    A:
       UYN(01) = -EYYN(1)
       UYN(02) = -EYYN(1)
       UYN(03) = -EYYN(1)
       UYN(07) = -EYYN(2)
       UYN(08) = -EYYN(2)
       UYN(09) = -EYYN(2)
       UYN(13) = -EYYN(3)
       UYN(14) = -EYYN(3)
       UYN(15) = -EYYN(3)
C   A H O  H A     P    A:
       UYN(04) = +EYYN(1)
       UYN(05) = +EYYN(1)
       UYN(06) = +EYYN(1)
       UYN(10) = +EYYN(2)
       UYN(11) = +EYYN(2)
       UYN(12) = +EYYN(2)
       UYN(16) = +EYYN(3)
       UYN(17) = +EYYN(3)
       UYN(18) = +EYYN(3)
C----------------------------------------------------------------------
C******* TN + H0 BPEM *************************************************
C   K A T O  H A     P    A:
       UYN1(01) = -EYYN1(1)
       UYN1(02) = -EYYN1(1)
       UYN1(03) = -EYYN1(1)
       UYN1(07) = -EYYN1(2)
       UYN1(08) = -EYYN1(2)
       UYN1(09) = -EYYN1(2)
       UYN1(13) = -EYYN1(3)
       UYN1(14) = -EYYN1(3)
       UYN1(15) = -EYYN1(3)
C   A H O  H A     P    A:
       UYN1(04) = +EYYN1(1)
       UYN1(05) = +EYYN1(1)
       UYN1(06) = +EYYN1(1)
       UYN1(10) = +EYYN1(2)
       UYN1(11) = +EYYN1(2)
       UYN1(12) = +EYYN1(2)
       UYN1(16) = +EYYN1(3)
       UYN1(17) = +EYYN1(3)
       UYN1(18) = +EYYN1(3)
C----------------------------------------------------------------------
C***** O  O P H  E   H A  P   E H  :
C********TN BPEM: ****************************************************
C-->  AA   "A"-> [ 3,9,15 - KATO "+ B" ], [6,12,18 - AHO "- B" ]
       UON(03) = +VHN(2)
       UON(06) = -VHN(2)
       UON(09) = +VHN(2)
       UON(12) = -VHN(2)
       UON(15) = +VHN(2)
       UON(18) = -VHN(2)
C--> AA "B"-> [ 2,8,14 KATO "+ C" ], [ 5,11,17 - AHO "-C" ]
       UON(02) = +VHN(3)
       UON(05) = -VHN(3)
       UON(08) = +VHN(3)
       UON(11) = -VHN(3)
       UON(14) = +VHN(3)
       UON(17) = -VHN(3)
C-->  AA "C"-> [ 1,7,13 - KATO "+ A" ], [ 4,10,16 - AHO "-A" ]
       UON(01) = +VHN(1)
       UON(04) = -VHN(1)
       UON(07) = +VHN(1)
       UON(10) = -VHN(1)
       UON(13) = +VHN(1)
       UON(16) = -VHN(1)
C----------------------------------------------------------------------
C********TN+H0  BPEM: *************************************************
C-->  AA   "A":
       UON1(03) = +VHN1(2)
       UON1(06) = -VHN1(2)
       UON1(09) = +VHN1(2)
       UON1(12) = -VHN1(2)
       UON1(15) = +VHN1(2)
       UON1(18) = -VHN1(2)
C--> AA "B")
       UON1(02) = +VHN1(3)
       UON1(05) = -VHN1(3)
       UON1(08) = +VHN1(3)
       UON1(11) = -VHN1(3)
       UON1(14) = +VHN1(3)
       UON1(17) = -VHN1(3)
C-->  AA "C"
       UON1(01) = +VHN1(1)
       UON1(04) = -VHN1(1)
       UON1(07) = +VHN1(1)
       UON1(10) = -VHN1(1)
       UON1(13) = +VHN1(1)
       UON1(16) = -VHN1(1)
C----------------------------------------------------------------------
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C --->   KAO P CBOE CX < AHOHOE>, CX <KATOHOE>  TX:
C-->
       DO 405 LG=1,3
C-->  LG -> HOMEP P, J-> HOMEP B PE
C  NV = (L-3)*6 + J  -->"ACOTH" APEC...
       IKN  = TNK (LG)
       IKN1 = TN1K(LG)
       IAN  = TNA (LG)
       IAN1 = TN1A(LG)
C----------------------------------------------------------------------
C   "LG" KATO-AHO P:
C----------------------------------------------------------------------
C   CTAPE CXA, CXK...
C  1 KATO,  4 - AHO..
       JK = 1
       JA = 4
       NVK = ( LG-1)*6 + JK
       NVA = ( LG-1)*6 + JA
       INVK = (NVK-1)*10+30
       INVA = (NVA-1)*10+30
       CXK = MSW(INVK + 4)
       CXA = MSW(INVA + 4)
C----------------------------------------------------------------------
       CALL SEQCIU( TXK, TXA, CXK, CXA, IKN, IKN1, IAN, IAN1,
     =  IFXK,  IFXA,         EYYN(LG), EYYN1(LG)  )
C----------------------------------------------------------------------
440    CONTINUE
C-->  CMEHA CX  TX B MSW<50> (1,2,3 -> KATO, 4,5,6 -> AHO ):
       DO 441 J = 1,3
       NV = (LG-1)*6 + J
C-->  AP. HAAA MSW<50> KATOHX BEHTE B PE
       INV = ( NV-1) * 10 + 30
       MSW(INV+4) = CXK
       IF ( IFXK  .EQ. 1 )  RMSW(INV+5) = TXK
441    CONTINUE
C
       DO 442 J=4,6
       NV = (LG-1)*6 + J
C-->  AP. HAAA MSW<50>      AHOHX BEHTE B PE
       INV = ( NV-1) * 10 + 30
       MSW(INV+4) =  CXA
       IF ( IFXA  .EQ. 1 )  RMSW(INV+5) = TXA
442    CONTINUE
C----------------------------------------------------------------------
450    CONTINUE
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
405    CONTINUE
C######################################################################
C######################################################################
C-->  BOHM ZAPROS=3   BEHTE***********************************
       NEL = MSW(1)
       ITOK = MSW(7)
       DTCIU = RMSW(19)
       DO 451 NV = 1,18
       INV = (NV-1) * 10 + 30
       K1 = KVENT(NV)
       M1 = MVENT(NV)
       K = MSW(K1)
       M = MSW(M1)
       NPEL = NEL*10000 + NV
C-->  PACTABM TOKXN/N1
       ITOKNV = ITOK+5 + NV
       TOKXN(1) =  TOKN ( ITOKNV )
       TOKXN1(1) = TOKN1( ITOKNV )
C-->  BCE OPEEEHO...
C-->  MOHTOPHOE OCBAHE-->
       CALL DM00B9(K, M, NPEL, MSW(INV), RMSW(INV), YALL, JALL, LOGYTR,
     =            TOKXN, TOKXN1, VALLN, VALLN1, KOD, UON(NV), UON1(NV),
     =            UYN(NV), UYN1(NV), DTCIU )
C- - - - - -
C-->  PMEM CHA "C"-->
       ICIUNV = ITOK + 5 + 18 + NV
       TOKN1(ICIUNV) = TOKXN1(2)
451    CONTINUE
C-->  APOC ...
       RETURN
C----------------------------------------------------------------------
C######################################################################
500    CONTINUE
C-->  ZAPROS=4,  KE A COCTOHEM CET HE HHO
       IF ( TN1 .LT. TBKL ) RETURN
C-->   BEHTE  -->  AHAOHO ZAPROS=1-->
       GO TO 666
C$$$$$$DEBUG           INIT
       END
