         SUBROUTINE DM0006 ( MSW, RMSW, YALL, JALL, LOGYTR,
     *                       TOKN, TOKN1, VALLN, VALLN1, KOD,
     *                         MSWALL, RMSWAL, ADRMSW )
CXXX----KOMEKC "MS1" --> BEPC 1.0  (OT EKAP 1986 .)------------
C   OPOPAMMA:  DM0006 ( MSW, RMSW, YALL, JALL, LOGYTR,
C   -------------            TOKN, TOKN1, VALLN, VALLN1, KOD,
C                              MSWALL, RMSWAL, ADRMSW )
C   HAHAEHE:    MOHTOP MOE R_L OA [ MOE # 80, .T # 5 ]
C   -----------    ***************************************************
C
C                  B ABCMOCT OT HAEH AA ZAPROS [MASPRT(28)]:
C                  BOHET CEE HK:
C
C                  A) ZAPROS = 1
C                     ----------
C                  OPMPOBAHE BKAOB B YALL MATP POBOMOCTE 
C                  JALL - BEKTOP CTOHKOB TOKA HAEH APAMETPOB
C                  KBBAEHTHX  G - J BETBE  MOE EMEHTA E
C                           TA # 80 [ RL _ O ];
C                           ***********************
C                  B) ZAPROS = 2
C                     ----------
C                  BCEHE HAEH TOKOB B BETBX B T(N+1) MOMEHT
C                  BPEMEH   CXO  G  J APAMETPOB  HAEH
C                  OBX HAPEH HA EMEHTE PACTAHHX  T(N+1)
C                     AC (KCA) TX HAEH B "TOK T(N+1)";
C                    ( E "AAPATA" LOGYTR )
C
C                  C) ZAPROS = 3
C                     -----------
C                     OBOTC AHA HA BOMOH CMEH COCTOH
C                     OA [ OTKPT <==> AKPT ]:
C                     P TOM: FKOM = 0 - COCTOHE HE MEHOC;
C                               FCOM = 1 - HA TEKEM AE COCTOHE
C                                         OHO "O" MEHTC B
C                                         B T = TX MOMEHT BPEMEH;
C                                         PEAHO B POPAMME OPEE-
C                                         ETC HX - A BOMOHO
C                                         KOMMTA, ATEM TX=TN+HX;
C                                         P HX < HXMIN [MASPRT(62)]
C                                         PHMAETC HX = HXMIN;
C                                         COCTOHE HX=0.0 BBAET
C                                         EAT COOEH;
C                                         POBEEH COTBETCTBE
C                                         MEHEH B MASPRT:
C                                          FKOM <== "1"
C                                         HXG = MIN( HX, HXG )
C                                         TXG = TN + HXG
C
C              ET: ICLOSE - MO TOKA "AKPT" BEHT;
C                    UOPEN  - MO HAPEH "OTKPT" BEHT;
C                             T HAEH TBATC KAK  P
C                             CMEHE COCTOH EMEHTA, TAK  P
C                            OPEEEH BOMOHX BPEMEH EPEKEH;
C
C
C
C                  D) ZAPROS = 4
C                     **********
C                   - P TX_G  [MASPRT(35)] .EQ. TX[RMSW(19)] -
C                      KCPETC CMEHA COCTOH "OA" APAMETPOM
C                      KD [MSW(18)];
C                     PABEHCTBO POBEPETC C TO. O "EPSKOM".
C
C   METO:         CKPETA PABHEH COCTOH MOE AHHOO
C   -----          TA HA OCHOBE METOA HEPA BO:
C                  Y(N+1) = Y(N) + H1*F(N+1) + H2*F(N).
C
C   APAMETP:     MSW, RMSW - PABEE COBO COCTOH MAKPOMOE
C   ---------      ( "OTPEOK" MACCB MSWALL -> C.M. / GETMSW );
C                  YALL - MATPA P0BOMOCT AHAPEMO E;
C                  JALL - BEKTOP CTOHKOB TOKA AHAPEMO E;
C                  VALLN - BEKTOP OBX HAPEH AHAPEMO E:
C                          P  T  =  TN;
C                  VALLN1- BEKTOP OBX HAPEH AHAPEMO E:
C                          P  TN + H0;
C                  TOKN   TOKN1 - HAEHE EPEMEHHX "COCTOH"
C                                  MOE P TN    TN + H0;
C                          ( PAMEPHOCT -> CM. MASPRT(46) = NNTOK )
C                  LOGYTR - BEKTOP PHAKOB K.. OB:
C                  COETC B MAKPOMOEX C PHAKOM TA = 6;
C                  PAMEPHOC MACCBOB P "ALL" OPEETC:
C                   MAX_DIMENSION ---> NDALL = MASPRT(23)
C                   TEKA_PAMEPHOCT ---> NSYS = MASPRT(26)
C                  KOD - APAMETP OPATHO CB C MOHTOPOM DM....
C
C
C
C
C   OPOPAMM:  1. COMMON PROF1, PROF2, PROF3;
C   ------------   2. SEQSOS
C
C   PMEAHE:  1.CTPKTP MSW COBA MAKPOMOE AHHOO TA CM. HE
C   ----------   2. P ZAPROS ^=  1, 2, 3, 4 - BAA COOEH  XO
C                3. P FTEST >=1 -> EAT HA WTRE AKTA CMEH COCTOH
C                4. OCKAETC AAHE L[0]  L[@] = 0.0;
C
C
C               "OCTOHHA" ACT MSW TA # 80:
C                --------------------------------
C
C  +-------+--------+--------+--------+------+------+-------+---+
C  I HOMEP I HOMEP  I HOMEP  I PHAKI KO I KO. IAP.   IPE I
C  I EME I TA   I /    I TA   I ECT I BB. IHA.  IE I
C  I HTA   I MOE I PACETAI MOE I BO   I HA I"TOKN" IPB I
C  I       I        I DM.....I        I OBI EH.I"TOKN1"I   I
C  +-------+--------+--------+--------+------+------+-------+---+
C  I  1    I   2    I   3    I    4   I   5  I  6   I   7   I 8 I
C  +-------+--------+--------+--------+------+------+-------+---+
C
C
C
C                  RMSW TA # 80 [ RL _ O ]
C                  --------------------------------
C
C
C
C                    SPM                      SRAB
C +----+---++---+---+---+--++----+---+-------+------+--------+--------+
C I- I-II R I L I R I L II G I J I A  I TEK .I BPEM  I PEEPB I
C IE  IE II 0 I 0 I @ I @ II R I R I  KD   I COCT.I EPEK.I        I
C I"K" I"M"II   I   I   I   II L I L I       I "KD" I "TX"[*]I        I
C +----+---++---+---+---+---++---+---+-------+------+--------+--------+
C I 9  I 10II 11I 12I 13I 14II 15I 16I   17  I  18  I   19   I   20   I
C +----+---++---+---+---+---++---+---+-------+------+--------+--------+
C
C  0 - O OTKPT (KD=1); @ - O AKPT (KD=0);
C [*] - XPAHTC HAEHE PEAHO BOHEHHOO AA HX ==> TX = TN + HX
C A KD - PAPEEHE HA CMEH COCTOH;
C
CZZZ-------------------------------------------------------------------
         COMMON /PROF1/ MASPRT(200)
         COMMON /PROF2/ MACTAB(800)
         COMMON /PROF3/ FUNTAB(50)
         DIMENSION MSW(*), RMSW(*), YALL(*), JALL(*), LOGYTR(*)
         DIMENSION VALLN(*), RMASPT(1), VALLN1(*), TOKN(*), TOKN1(*)
         REAL JALL, JRL, L, IRLT, IRLN
         EQUIVALENCE ( MASPRT(1), RMASPT(1) )
               DIMENSION MSWALL(*), RMSWAL(*)
               INTEGER ADRMSW
         EQUIVALENCE ( MASPRT(62), HXMIN )
         EQUIVALENCE ( MASPRT(14), NWTRE )
         EQUIVALENCE ( MASPRT(60), FTEST )
         INTEGER FTEST
         EQUIVALENCE ( ZAPROS, MASPRT(28) )
         EQUIVALENCE ( HXG,    MASPRT(61) )
         EQUIVALENCE ( NDALL,  MASPRT(23) )
         EQUIVALENCE ( TN,     MASPRT(29) )
         EQUIVALENCE ( H0,     MASPRT(30) )
         EQUIVALENCE ( H1,     MASPRT(32) )
         EQUIVALENCE ( H2,     MASPRT(33) )
         EQUIVALENCE ( FKOM,   MASPRT(34) )
         EQUIVALENCE ( TXG,    MASPRT(35) )
         EQUIVALENCE ( NTXG,   MASPRT(36) )
         EQUIVALENCE ( EPSKOM, MASPRT(39) )
         EQUIVALENCE ( ZEROCP, MASPRT(50) )
         EQUIVALENCE ( ICLOSE, MASPRT(77) )
         EQUIVALENCE ( UOPEN,  MASPRT(78) )
         REAL ICLOSE
         INTEGER FKOM, ZAPROS
C===>    BCTPOEHHA HK OCBAH BXMEPHX MACCBOB:
         ID(I,J) = NDALL * (J-1)  +  I
C---->    OKEH:
         K = MSW(9)
         M = MSW(10)
C--->  KOHTPO TA
         IF ( MSW(2) .NE. 80 ) GO TO 9999
C---> BOP PEMA:
         GO TO ( 667, 666, 600, 500       ), ZAPROS
C===> HAE OKA
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9997) MSW(3), ZAPROS
9997     FORMAT( ' *** DM MOHTOP #', I4, ' APOC OCBAH OOEH
     = ***'/ ' *** ZAPROS = ', I5, ' - HOPPETC ***')
         RETURN
667      CONTINUE
C---------------Z A P R O S = 1----------------------------------------
C---> "CPOC" HAEH HX - BOMOHOO BPEMEH EPEKEH.....
         RMSW(19) =      H0
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
         MSW(17) = 0
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C===> TO A COCTOHE ? (KD=0 -- AKPT, KD=1 -- OTKPT)?
         IF (  MSW(18) .EQ. 1 ) GO TO 698
C===> O AKPT==> KD=0 <======
         R = RMSW(13)
         L = RMSW(14)
         GO TO 555
698      CONTINUE
C===> O OTKPT ==> KD=1 <======
         R = RMSW(11)
         L = RMSW(12)
555      CONTINUE
C---> TEEP BCE EHO....
C====> PACET GRL   JRL     OPM MEHEH:= MOHO L = 0.0
         GRL = H1 / ( L + H1 * R )
C--->   TOK HA N - OM  AE
         ITOK = MSW(7)
         TOK  = TOKN( ITOK )
C--->
         JRL = (L*TOK) / (L+H1*R)
         IF ( H2 .EQ. 0.0 ) GO TO 668
C===>  HAPEHE HA N-OM AE.
         VK = 0.0
         IF ( K .NE. 0 ) VK = VALLN(K)
         VM = 0.0
         IF ( M .NE. 0 ) VM = VALLN(M)
         UN = VK - VM
C--->
         JRL = JRL + H2*( (UN-R*TOK)/(L+H1*R) )
668      CONTINUE
C===> AOMHT G  J APAMETP OA;
         RMSW(15) = GRL
         RMSW(16) = JRL
C--->
C--->   OEMEHTH BKA:
C---->
C======================================================================
         KOD = 0
C--->
         CALL DEPOST( K, M, GRL, JRL, YALL, JALL )
C--->
         RETURN
C======================================================================
C$$$$$$ZAPROS = 2$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
666      CONTINUE
C===> PACTAT TOK
         GRL = RMSW(15)
         JRL = RMSW(16)
         VK = 0.0
         IF ( K .NE. 0 ) VK = VALLN1(K)
         VM = 0.0
         IF ( M .NE. 0 ) VM = VALLN1(M)
         UT = VK - VM
C---> TOK B T(N+1) MOMEHT BPEMEH:
         IRLT = GRL * UT  + JRL
C===>        AC TOKOB
         ITOK = MSW(7)
         TOKN1( ITOK ) = IRLT
C********
         KOD = 0
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
600      CONTINUE
C---- Z A P R O S = 3 -----TOKN, TOKN1, VALLN, VALLN1 OPEEEH-------
C----OPEEM TEK.  PE. COCTOH (?)------------------------------
         ITOK = MSW(7)
C===>
         VK = 0.0
         IF ( K .NE. 0 ) VK = VALLN1(K)
         VM = 0.0
         IF ( M .NE. 0 ) VM = VALLN1(M)
         UT = VK - VM
         IRLT = TOKN1( ITOK )
C--> A PAHE O...
         VK = 0.0
         IF ( K .NE. 0 ) VK = VALLN(K)
         VM = 0.0
         IF ( M .NE. 0 ) VM = VALLN(M)
         UN = VK - VM
         IRLN = TOKN( ITOK )
C----AMEMC COCTOHM----------------------------------------------
C!!!-------------------------------------------------------------------
C      KD = MSW(18)
C      CALL SEQSOS( MSW(1), TN, KD, IRLN, UN )
C      MSW(18) = KD
C!!!-------------------------------------------------------------------
         KD = MSW(18)
         IF ( KD .EQ. 0 ) GO TO 601
C---> O OTKPT (KD=1), HE XOET  OH AKPTC?
C        IF (  UN .GE 0.0  .AND.  IRLN .GE. 0.0
C    =                     .AND.  IRLT .LT. 0.0  ) GO TO 602
CQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ
       IF (
     =                          IRLT .LE. -ICLOSE ) GO TO 602
CQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ
C---> HAE COCTOHE OA HE MEHOC....
         KOD = 0
         RETURN
602      CONTINUE
C--->  O #AKPC#  B TEEH BPEMEH OT TN O TN+H0....
C      KOA TO MOO CTC?
C !!! OPMA CPABEBA P  IRLN > (-ICLOSE) !!!
         HX =    + H0 * ( (-ICLOSE - IRLN ) /(IRLT-IRLN)  )
         IF ( HX .LT. HXMIN ) HX = HXMIN
C$$$$$$$$TX = TN + HX
C!!!-------------------------------------------------------------------
         IF (  HX .LE. 0.0 ) WRITE (NWTRE, 604 ) MSW(1), KD, TN, H0, HX
604     FORMAT(' *** EMEHT # ', I5, ' MOE "RL-O" ==> COMHEH ?'
     = , ' ***'/' *** KD = ', I2, ' TN = ', E12.5, ' H0 = ', E12.5,
     =   ' HX = ', E12.5, ' ***')
C!!!-------------------------------------------------------------------
         RMSW(19) = HX
C--->  EC TX .LT. TX_G  ==> TO B TX_G  <=== TX...
         HXG  =  AMIN1( HX, HXG )
C                ****************
         TXG = TN + HXG
C====>  OTMETT TO B "FKOM"....
         FKOM = 1
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
         MSW(17) = -1
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
         KOD = 0
         RETURN
C----------------------------------------------------------------------
601      CONTINUE
C===> O AKPT (KD=0), HE EAET  OH OTKPTC?....
C        IF ( UT .GT. 0.0 ) GO TO 603
CQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ
       IF ( UT .GT. UOPEN ) GO TO 603
CQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ
C===>  HET, HE BOEA, COCTOHE HE MEHETC...
         KOD = 0
         RETURN
603      CONTINUE
C===>   O B TEEH TN  <-->  TN+H0 OEH OTKPTC ...
C       KOA ??? +!!!!!!!  CPABEBO   UN < UOPEN !!!!!!!!
         HX =    + H0 * ( (UOPEN - UN) /(UT - UN)  )
         IF ( HX .LT. HXMIN ) HX = HXMIN
C$$$$$$$$TX = TN + HX
C!!!-------------------------------------------------------------------
        IF ( HX   .LE. 0.0 ) WRITE (NWTRE, 605 ) MSW(1), KD, TN, H0, HX
605     FORMAT(' *** EMEHT # ', I5, ' MOE "RL-O" ==> COMHEH ?'
     = , ' ***'/' *** KD = ', I2, ' TN = ', E12.5, ' H0 = ', E12.5,
     = ' HX = ', E12.5, ' ***')
C!!!-------------------------------------------------------------------
         RMSW(19) = HX
         HXG =  AMIN1( HX, HXG )
C               ****************
         TXG = TN + HXG
         FKOM = 1
         KOD = 0
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
         MSW(17) = -1
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
         RETURN
C----------------------------------------------------------------------
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
500      CONTINUE
         KOD = 0
C===> KCA CMEH COCTOH MOE.................ZAPROS = 4
C---->  HET  HEOXOMOCT POBECT CMEH COCTOH OA...?
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
        IF ( MSW(17) .NE. -1 ) RETURN
C@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
C       EC TXG   "PMEPHO" PABHO TX=MOE, TO CMEHA HHA!
         HX   = RMSW(19)
         EPST = ABS( HX   - HXG )
C----->   (TX - TXG) = [ (TN+HX) - (TN+HXG) ]
         IF ( EPST .GT. EPSKOM ) RETURN
C===> HAE CMEHM COCTOHE....
         KD = MSW(18)
         KD = KD + 1
         IF ( KD. EQ. 2 ) KD = 0
         MSW(18) = KD
C!!!-------------------------------------------------------------------
         IF ( FTEST .GE. 1 ) WRITE(NWTRE,501) MSW(1), KD, TN, TXG
501     FORMAT(' ***FTEST_1: B -TE #',I5, ' KD CTAO =',I2,
     =          ' TN = ', E12.5, ' TXG = ', E12.5, ' ***')
C!!!-------------------------------------------------------------------
         RETURN
C$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
9999     CONTINUE
         NWTRE = MASPRT(14)
         WRITE(NWTRE,9998) MSW(1), MSW(2)
9998     FORMAT( ' *** O. CO B DM0006 - APOC HA OCBAHE O
     =O TA ***'/
     =    ' *** EMEHT # ', I10, ' T MOE # ', I10, ' ***'//)
         CALL SUBERR(1)
         RETURN
         END
